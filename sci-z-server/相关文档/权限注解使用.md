# Sa-Token æƒé™æ³¨è§£ä½¿ç”¨è§„èŒƒ

> **æ–‡æ¡£è¯´æ˜**ï¼šæœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜ Sa-Token ä¸‰å¤§æƒé™æ³¨è§£çš„ä½¿ç”¨è§„èŒƒã€æƒé™ç å®šä¹‰è§„åˆ™åŠæœ€ä½³å®è·µã€‚

---

## ç›®å½•

- [ä¸€ã€ä¸‰å¤§æƒé™æ³¨è§£æ¦‚è§ˆ](#ä¸€ä¸‰å¤§æƒé™æ³¨è§£æ¦‚è§ˆ)
- [äºŒã€@SaCheckLogin - ç™»å½•æ£€æŸ¥](#äºŒsachecklogin---ç™»å½•æ£€æŸ¥)
- [ä¸‰ã€@SaCheckRole - è§’è‰²æ£€æŸ¥](#ä¸‰sacheckrole---è§’è‰²æ£€æŸ¥)
- [å››ã€@SaCheckPermission - æƒé™æ£€æŸ¥](#å››sacheckpermission---æƒé™æ£€æŸ¥)
- [äº”ã€æƒé™ç å®šä¹‰è§„èŒƒ](#äº”æƒé™ç å®šä¹‰è§„èŒƒ)
- [å…­ã€å¦‚ä½•æ·»åŠ æ–°çš„æƒé™ç ](#å…­å¦‚ä½•æ·»åŠ æ–°çš„æƒé™ç )
- [ä¸ƒã€å®Œæ•´ç¤ºä¾‹](#ä¸ƒå®Œæ•´ç¤ºä¾‹)
- [å…«ã€å¸¸è§é—®é¢˜](#å…«å¸¸è§é—®é¢˜)

---

## ä¸€ã€ä¸‰å¤§æƒé™æ³¨è§£æ¦‚è§ˆ

| æ³¨è§£                   | ç²’åº¦ | ä½¿ç”¨åœºæ™¯             | å®‰å…¨ç­‰çº§ |
| ---------------------- | ---- | -------------------- | -------- |
| **@SaCheckLogin**      | æœ€ç²— | åªè¦ç™»å½•å³å¯è®¿é—®     | âš ï¸ ä½    |
| **@SaCheckRole**       | ä¸­ç­‰ | éœ€è¦ç‰¹å®šè§’è‰²æ‰èƒ½è®¿é—® | âœ… ä¸­    |
| **@SaCheckPermission** | æœ€ç»† | éœ€è¦ç‰¹å®šæƒé™æ‰èƒ½è®¿é—® | âœ… é«˜    |

**é€‰æ‹©åŸåˆ™**ï¼š

- âœ… ä¼˜å…ˆä½¿ç”¨ `@SaCheckPermission`ï¼ˆæœ€çµæ´»ã€æœ€å®‰å…¨ï¼‰
- âœ… ç®€å•çš„è§’è‰²åˆ¤æ–­ä½¿ç”¨ `@SaCheckRole`
- âœ… åªéœ€è¦ç™»å½•çš„ä½¿ç”¨ `@SaCheckLogin`

---

## äºŒã€@SaCheckLogin - ç™»å½•æ£€æŸ¥

### 2.1 ä½œç”¨

æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œä¸æ£€æŸ¥è§’è‰²å’Œæƒé™ã€‚

### 2.2 ä½¿ç”¨åœºæ™¯

- âœ… ç”¨æˆ·æŸ¥çœ‹è‡ªå·±çš„ä¸ªäººä¿¡æ¯
- âœ… ç”¨æˆ·ä¿®æ”¹è‡ªå·±çš„å¯†ç 
- âœ… ç”¨æˆ·æŸ¥çœ‹è‡ªå·±åˆ›å»ºçš„å†…å®¹
- âŒ ä¸é€‚åˆç®¡ç†åŠŸèƒ½ï¼ˆéœ€è¦ä½¿ç”¨ `@SaCheckRole` æˆ– `@SaCheckPermission`ï¼‰

### 2.3 ä½¿ç”¨ç¤ºä¾‹

```java
@RestController
@RequestMapping("/api/user")
public class UserController {

    /**
     * è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯
     * åªéœ€è¦ç™»å½•å³å¯è®¿é—®
     */
    @GetMapping("/profile")
    @SaCheckLogin  // â† åªæ£€æŸ¥æ˜¯å¦ç™»å½•
    @Operation(summary = "è·å–ä¸ªäººä¿¡æ¯")
    public Result<UserProfileResp> getProfile() {
        Long userId = StpUtil.getLoginIdAsLong();
        UserProfileResp profile = userService.getProfile(userId);
        return Result.success(profile);
    }

    /**
     * ä¿®æ”¹å½“å‰ç”¨æˆ·å¯†ç 
     * åªéœ€è¦ç™»å½•å³å¯è®¿é—®
     */
    @PutMapping("/password")
    @SaCheckLogin
    @Operation(summary = "ä¿®æ”¹å¯†ç ")
    public Result<Void> updatePassword(@RequestBody PasswordUpdateReq req) {
        Long userId = StpUtil.getLoginIdAsLong();
        userService.updatePassword(userId, req);
        return Result.success(null);
    }
}
```

### 2.4 æ³¨æ„äº‹é¡¹

- âš ï¸ ä¸èƒ½ç”¨äºç®¡ç†åŠŸèƒ½ï¼ˆä»»ä½•ç™»å½•ç”¨æˆ·éƒ½èƒ½è®¿é—®ï¼‰
- âš ï¸ éœ€è¦åœ¨æ–¹æ³•å†…éƒ¨é¢å¤–åˆ¤æ–­ç”¨æˆ·æƒé™ï¼ˆå¦‚ç”¨æˆ·åªèƒ½æ“ä½œè‡ªå·±çš„æ•°æ®ï¼‰

---

## ä¸‰ã€@SaCheckRole - è§’è‰²æ£€æŸ¥

### 3.1 ä½œç”¨

æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æŒ‡å®šè§’è‰²ã€‚

### 3.2 ä½¿ç”¨åœºæ™¯

- âœ… ç®¡ç†å‘˜ä¸“å±åŠŸèƒ½
- âœ… æŒ‰è§’è‰²åˆ’åˆ†çš„åŠŸèƒ½æ¨¡å—
- âœ… éœ€è¦ç‰¹å®šèº«ä»½æ‰èƒ½è®¿é—®çš„åŠŸèƒ½

### 3.3 è§’è‰²ç¼–ç è§„èŒƒ

**é¡¹ç›®ä¸­çš„è§’è‰²ç¼–ç **ï¼ˆå®šä¹‰åœ¨ `sys_role` è¡¨ï¼‰ï¼š

| è§’è‰²ç¼–ç  | è§’è‰²åç§°   | è¯´æ˜         |
| -------- | ---------- | ------------ |
| `admin`  | ç³»ç»Ÿç®¡ç†å‘˜ | æ‹¥æœ‰æ‰€æœ‰æƒé™ |
| `user`   | æ™®é€šç”¨æˆ·   | åŸºç¡€åŠŸèƒ½æƒé™ |

**å¯æ‰©å±•çš„è§’è‰²**ï¼ˆæ ¹æ®ä¸šåŠ¡éœ€è¦æ·»åŠ ï¼‰ï¼š

```sql
-- ç¤ºä¾‹ï¼šæ·»åŠ æ•™å¸ˆè§’è‰²
INSERT INTO sys_role (role_name, role_code, description, industry_type, role_type, sort_order, status)
VALUES ('æ•™å¸ˆ', 'teacher', 'æ•™å¸ˆè§’è‰²', 'education', 'business', 3, 1);

-- ç¤ºä¾‹ï¼šæ·»åŠ å­¦ç”Ÿè§’è‰²
INSERT INTO sys_role (role_name, role_code, description, industry_type, role_type, sort_order, status)
VALUES ('å­¦ç”Ÿ', 'student', 'å­¦ç”Ÿè§’è‰²', 'education', 'business', 4, 1);
```

### 3.4 ä½¿ç”¨ç¤ºä¾‹

#### å•ä¸ªè§’è‰²æ£€æŸ¥

```java
@RestController
@RequestMapping("/api/admin")
public class AdminController {

    /**
     * æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·åˆ—è¡¨
     * åªæœ‰ç®¡ç†å‘˜æ‰èƒ½è®¿é—®
     */
    @GetMapping("/users")
    @SaCheckRole("admin")  // â† å¿…é¡»æ˜¯ admin è§’è‰²
    @Operation(summary = "æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·")
    public Result<List<UserResp>> getAllUsers() {
        List<UserResp> users = userService.listAll();
        return Result.success(users);
    }

    /**
     * ç³»ç»Ÿé…ç½®ç®¡ç†
     * åªæœ‰ç®¡ç†å‘˜æ‰èƒ½è®¿é—®
     */
    @PutMapping("/config")
    @SaCheckRole("admin")
    @Operation(summary = "ä¿®æ”¹ç³»ç»Ÿé…ç½®")
    public Result<Void> updateSystemConfig(@RequestBody SystemConfigReq req) {
        systemConfigService.update(req);
        return Result.success(null);
    }
}
```

#### å¤šä¸ªè§’è‰²æ£€æŸ¥ï¼ˆæ»¡è¶³å…¶ä¸€å³å¯ï¼‰

```java
@RestController
@RequestMapping("/api/project")
public class ProjectController {

    /**
     * å®¡æ‰¹é¡¹ç›®
     * ç®¡ç†å‘˜æˆ–æ•™å¸ˆè§’è‰²éƒ½å¯ä»¥å®¡æ‰¹
     */
    @PostMapping("/{id}/approve")
    @SaCheckRole(value = {"admin", "teacher"}, mode = SaMode.OR)  // â† ORæ¨¡å¼ï¼šæ»¡è¶³ä»»æ„ä¸€ä¸ªè§’è‰²å³å¯
    @Operation(summary = "å®¡æ‰¹é¡¹ç›®")
    public Result<Void> approveProject(@PathVariable Long id, @RequestBody ApproveReq req) {
        projectService.approve(id, req);
        return Result.success(null);
    }
}
```

#### å¤šä¸ªè§’è‰²æ£€æŸ¥ï¼ˆå¿…é¡»åŒæ—¶æ‹¥æœ‰ï¼‰

```java
@RestController
@RequestMapping("/api/sensitive")
public class SensitiveController {

    /**
     * æ•æ„Ÿæ“ä½œ
     * å¿…é¡»åŒæ—¶æ‹¥æœ‰ admin å’Œ auditor è§’è‰²
     */
    @PostMapping("/operation")
    @SaCheckRole(value = {"admin", "auditor"}, mode = SaMode.AND)  // â† ANDæ¨¡å¼ï¼šå¿…é¡»åŒæ—¶æ‹¥æœ‰
    @Operation(summary = "æ•æ„Ÿæ“ä½œ")
    public Result<Void> sensitiveOperation() {
        // ...
        return Result.success(null);
    }
}
```

### 3.5 æ³¨æ„äº‹é¡¹

- âš ï¸ è§’è‰²ç¼–ç å¿…é¡»ä¸æ•°æ®åº“ `sys_role` è¡¨ä¸­çš„ `role_code` å­—æ®µä¸€è‡´
- âš ï¸ è§’è‰²ç¼–ç åŒºåˆ†å¤§å°å†™
- âš ï¸ ä¸æ¨èåœ¨ä¸šåŠ¡æ¥å£ä¸Šä½¿ç”¨è§’è‰²æ£€æŸ¥ï¼Œæ¨èä½¿ç”¨ `@SaCheckPermission`ï¼ˆæ›´çµæ´»ï¼‰

---

## å››ã€@SaCheckPermission - æƒé™æ£€æŸ¥

### 4.1 ä½œç”¨

æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æŒ‡å®šæƒé™ç ï¼Œæ˜¯**æœ€æ¨è**çš„æƒé™æ§åˆ¶æ–¹å¼ã€‚

### 4.2 ä½¿ç”¨åœºæ™¯

- âœ… å¢åˆ æ”¹æŸ¥æ“ä½œï¼ˆCRUDï¼‰
- âœ… å¯¼å‡ºã€å¯¼å…¥åŠŸèƒ½
- âœ… å®¡æ‰¹ã€å®¡æ ¸åŠŸèƒ½
- âœ… æ‰€æœ‰éœ€è¦ç»†ç²’åº¦æƒé™æ§åˆ¶çš„åŠŸèƒ½

### 4.3 æƒé™ç å‘½åè§„èŒƒ

**æ ¼å¼**ï¼š`ç±»å‹:æ¨¡å—å:æ“ä½œ`

**ä¸‰ç§ç±»å‹**ï¼š

| ç±»å‹         | å‰ç¼€             | ç”¨é€”         | ç¤ºä¾‹                             |
| ------------ | ---------------- | ------------ | -------------------------------- |
| **èœå•æƒé™** | `menu:`          | æ§åˆ¶èœå•æ˜¾ç¤º | `menu:user:list`                 |
| **æŒ‰é’®æƒé™** | `button:`        | æ§åˆ¶æŒ‰é’®æ˜¾ç¤º | `button:user:delete`             |
| **API æƒé™** | `api:` æˆ– æ— å‰ç¼€ | æ§åˆ¶æ¥å£è®¿é—® | `user:create`, `api:user:create` |

**æ¨èçš„æƒé™ç æ ¼å¼**ï¼š

```
æ¨¡å—å:æ“ä½œ

ç¤ºä¾‹ï¼š
user:list       - æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨
user:create     - åˆ›å»ºç”¨æˆ·
user:update     - æ›´æ–°ç”¨æˆ·
user:delete     - åˆ é™¤ç”¨æˆ·
project:list    - æŸ¥çœ‹é¡¹ç›®åˆ—è¡¨
project:create  - åˆ›å»ºé¡¹ç›®
project:export  - å¯¼å‡ºé¡¹ç›®
declaration:approve - å®¡æ‰¹ç”³æŠ¥
report:accept   - éªŒæ”¶æŠ¥å‘Š
system:config   - ç³»ç»Ÿé…ç½®
```

### 4.4 é¡¹ç›®ä¸­å·²æœ‰çš„æƒé™ç 

**ä»æ•°æ®åº“ `init_permission_data.sql` ä¸­æå–çš„æƒé™ç **ï¼š

#### èœå•æƒé™ï¼ˆpermission_type = 1ï¼‰

```
menu:dashboard:view         - ä»ªè¡¨æ¿
menu:declaration:list       - ç”³æŠ¥ç®¡ç†
menu:declaration:list:sub   - ç”³æŠ¥åˆ—è¡¨
menu:declaration:create     - æ–°å»ºç”³æŠ¥
menu:project:list           - é¡¹ç›®ç®¡ç†
menu:project:list:sub       - é¡¹ç›®åˆ—è¡¨
menu:report:list            - éªŒæ”¶ç®¡ç†
menu:report:list:sub        - æŠ¥å‘Šç®¡ç†
menu:ai:chat                - AIåŠ©æ‰‹
menu:ai:chat:sub            - AIå¯¹è¯
menu:knowledge:list         - çŸ¥è¯†åº“
menu:user:profile           - ç”¨æˆ·ä¸­å¿ƒ
menu:user:profile:sub       - ä¸ªäººä¿¡æ¯
menu:user:security          - å®‰å…¨è®¾ç½®
menu:system:user            - ç³»ç»Ÿç®¡ç†
menu:system:user:sub        - ç”¨æˆ·ç®¡ç†
menu:system:role            - è§’è‰²æƒé™
menu:system:config          - ç³»ç»Ÿé…ç½®
menu:system:logs            - æ—¥å¿—ç®¡ç†
```

#### æŒ‰é’®æƒé™ï¼ˆpermission_type = 2ï¼‰

```
button:dashboard:create_declaration - ä»ªè¡¨æ¿-æ–°å»ºç”³æŠ¥
button:declaration:create           - ç”³æŠ¥-æ–°å»ºæŒ‰é’®
button:declaration:delete           - ç”³æŠ¥-åˆ é™¤æŒ‰é’®
button:project:edit                 - é¡¹ç›®-ç¼–è¾‘æŒ‰é’®
button:project:delete               - é¡¹ç›®-åˆ é™¤æŒ‰é’®
button:report:delete                - æŠ¥å‘Š-åˆ é™¤æŒ‰é’®
button:report:accept                - æŠ¥å‘Š-éªŒæ”¶æŒ‰é’®
button:user:create                  - ç”¨æˆ·-æ–°å»ºæŒ‰é’®
button:user:disable                 - ç”¨æˆ·-ç¦ç”¨æŒ‰é’®
button:user:delete                  - ç”¨æˆ·-åˆ é™¤æŒ‰é’®
button:role:create                  - è§’è‰²-æ–°å»ºæŒ‰é’®
button:role:edit                    - è§’è‰²-ç¼–è¾‘æŒ‰é’®
button:role:config                  - è§’è‰²-é…ç½®æƒé™æŒ‰é’®
button:role:delete                  - è§’è‰²-åˆ é™¤æŒ‰é’®
button:log:clear                    - æ—¥å¿—-æ¸…ç©ºæŒ‰é’®
button:log:export                   - æ—¥å¿—-å¯¼å‡ºæŒ‰é’®
```

#### API æƒé™ï¼ˆpermission_type = 3ï¼‰

**æ¨èæ ¼å¼**ï¼ˆéœ€è¦åœ¨æ•°æ®åº“ä¸­æ·»åŠ ï¼‰ï¼š

```
user:list       - æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨
user:create     - åˆ›å»ºç”¨æˆ·
user:update     - æ›´æ–°ç”¨æˆ·
user:delete     - åˆ é™¤ç”¨æˆ·
user:disable    - ç¦ç”¨ç”¨æˆ·

project:list    - æŸ¥çœ‹é¡¹ç›®åˆ—è¡¨
project:create  - åˆ›å»ºé¡¹ç›®
project:update  - æ›´æ–°é¡¹ç›®
project:delete  - åˆ é™¤é¡¹ç›®
project:export  - å¯¼å‡ºé¡¹ç›®

declaration:list    - æŸ¥çœ‹ç”³æŠ¥åˆ—è¡¨
declaration:create  - åˆ›å»ºç”³æŠ¥
declaration:update  - æ›´æ–°ç”³æŠ¥
declaration:delete  - åˆ é™¤ç”³æŠ¥
declaration:approve - å®¡æ‰¹ç”³æŠ¥

report:list    - æŸ¥çœ‹æŠ¥å‘Šåˆ—è¡¨
report:create  - åˆ›å»ºæŠ¥å‘Š
report:update  - æ›´æ–°æŠ¥å‘Š
report:delete  - åˆ é™¤æŠ¥å‘Š
report:accept  - éªŒæ”¶æŠ¥å‘Š

knowledge:list   - æŸ¥çœ‹çŸ¥è¯†åº“åˆ—è¡¨
knowledge:create - åˆ›å»ºçŸ¥è¯†åº“
knowledge:update - æ›´æ–°çŸ¥è¯†åº“
knowledge:delete - åˆ é™¤çŸ¥è¯†åº“

role:list    - æŸ¥çœ‹è§’è‰²åˆ—è¡¨
role:create  - åˆ›å»ºè§’è‰²
role:update  - æ›´æ–°è§’è‰²
role:delete  - åˆ é™¤è§’è‰²
role:config  - é…ç½®è§’è‰²æƒé™

system:config      - ç³»ç»Ÿé…ç½®
system:log:view    - æŸ¥çœ‹æ—¥å¿—
system:log:export  - å¯¼å‡ºæ—¥å¿—
system:log:clear   - æ¸…ç©ºæ—¥å¿—
```

### 4.5 ä½¿ç”¨ç¤ºä¾‹

#### å•ä¸ªæƒé™æ£€æŸ¥

```java
@RestController
@RequestMapping("/api/user")
public class UserController {

    /**
     * æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨
     * éœ€è¦ user:list æƒé™
     */
    @GetMapping("/list")
    @SaCheckPermission("user:list")  // â† æ£€æŸ¥æƒé™
    @Operation(summary = "æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨")
    public Result<List<UserResp>> listUsers() {
        List<UserResp> users = userService.list();
        return Result.success(users);
    }

    /**
     * åˆ›å»ºç”¨æˆ·
     * éœ€è¦ user:create æƒé™
     */
    @PostMapping("/create")
    @SaCheckPermission("user:create")
    @Operation(summary = "åˆ›å»ºç”¨æˆ·")
    public Result<UserResp> createUser(@Valid @RequestBody UserCreateReq req) {
        UserResp resp = userService.create(req);
        return Result.success(resp);
    }

    /**
     * æ›´æ–°ç”¨æˆ·
     * éœ€è¦ user:update æƒé™
     */
    @PutMapping("/{id}")
    @SaCheckPermission("user:update")
    @Operation(summary = "æ›´æ–°ç”¨æˆ·")
    public Result<UserResp> updateUser(@PathVariable Long id,
                                       @Valid @RequestBody UserUpdateReq req) {
        UserResp resp = userService.update(id, req);
        return Result.success(resp);
    }

    /**
     * åˆ é™¤ç”¨æˆ·
     * éœ€è¦ user:delete æƒé™
     */
    @DeleteMapping("/{id}")
    @SaCheckPermission("user:delete")
    @Operation(summary = "åˆ é™¤ç”¨æˆ·")
    public Result<Void> deleteUser(@PathVariable Long id) {
        userService.deleteById(id);
        return Result.success(null);
    }
}
```

#### å¤šä¸ªæƒé™æ£€æŸ¥ï¼ˆæ»¡è¶³å…¶ä¸€å³å¯ï¼‰

```java
@RestController
@RequestMapping("/api/declaration")
public class DeclarationController {

    /**
     * å¯¼å‡ºç”³æŠ¥æ•°æ®
     * éœ€è¦å¯¼å‡ºæƒé™æˆ–ç®¡ç†å‘˜æƒé™ï¼ˆæ»¡è¶³å…¶ä¸€å³å¯ï¼‰
     */
    @GetMapping("/export")
    @SaCheckPermission(value = {"declaration:export", "declaration:admin"}, mode = SaMode.OR)
    @Operation(summary = "å¯¼å‡ºç”³æŠ¥æ•°æ®")
    public Result<Void> exportDeclaration() {
        declarationService.export();
        return Result.success(null);
    }
}
```

#### å¤šä¸ªæƒé™æ£€æŸ¥ï¼ˆå¿…é¡»åŒæ—¶æ‹¥æœ‰ï¼‰

```java
@RestController
@RequestMapping("/api/sensitive")
public class SensitiveController {

    /**
     * æ‰¹é‡åˆ é™¤ç”¨æˆ·
     * å¿…é¡»åŒæ—¶æ‹¥æœ‰åˆ é™¤æƒé™å’Œæ‰¹é‡æ“ä½œæƒé™
     */
    @PostMapping("/batch-delete")
    @SaCheckPermission(value = {"user:delete", "user:batch"}, mode = SaMode.AND)
    @Operation(summary = "æ‰¹é‡åˆ é™¤ç”¨æˆ·")
    public Result<Void> batchDeleteUsers(@RequestBody List<Long> userIds) {
        userService.batchDelete(userIds);
        return Result.success(null);
    }
}
```

### 4.6 æ³¨æ„äº‹é¡¹

- âš ï¸ æƒé™ç å¿…é¡»ä¸æ•°æ®åº“ `sys_permission` è¡¨ä¸­çš„ `permission_code` å­—æ®µä¸€è‡´
- âš ï¸ æƒé™ç åŒºåˆ†å¤§å°å†™
- âš ï¸ å»ºè®®ä½¿ç”¨ `æ¨¡å—å:æ“ä½œ` çš„æ ¼å¼ï¼ˆä¸å¸¦ `api:` å‰ç¼€ï¼Œæ›´ç®€æ´ï¼‰

---

## äº”ã€æƒé™ç å®šä¹‰è§„èŒƒ

### 5.1 å‘½åè§„èŒƒ

**æ ¼å¼**ï¼š`[ç±»å‹:]æ¨¡å—å:æ“ä½œ[:å­æ“ä½œ]`

**ç±»å‹å‰ç¼€**ï¼ˆå¯é€‰ï¼‰ï¼š

- `menu:` - èœå•æƒé™
- `button:` - æŒ‰é’®æƒé™
- `api:` - API æƒé™ï¼ˆå¯çœç•¥ï¼‰

**æ¨¡å—å**ï¼š

- `user` - ç”¨æˆ·ç®¡ç†
- `role` - è§’è‰²ç®¡ç†
- `project` - é¡¹ç›®ç®¡ç†
- `declaration` - ç”³æŠ¥ç®¡ç†
- `report` - æŠ¥å‘Šç®¡ç†
- `knowledge` - çŸ¥è¯†åº“
- `system` - ç³»ç»Ÿç®¡ç†

**æ“ä½œ**ï¼š

- `list` - æŸ¥çœ‹åˆ—è¡¨
- `create` - åˆ›å»º
- `update` - æ›´æ–°
- `delete` - åˆ é™¤
- `export` - å¯¼å‡º
- `import` - å¯¼å…¥
- `approve` - å®¡æ‰¹
- `accept` - éªŒæ”¶
- `config` - é…ç½®
- `view` - æŸ¥çœ‹è¯¦æƒ…

### 5.2 æƒé™ç ç¤ºä¾‹

#### ç”¨æˆ·æ¨¡å—

```
user:list       - æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨
user:create     - åˆ›å»ºç”¨æˆ·
user:update     - æ›´æ–°ç”¨æˆ·ä¿¡æ¯
user:delete     - åˆ é™¤ç”¨æˆ·
user:disable    - ç¦ç”¨ç”¨æˆ·
user:reset      - é‡ç½®å¯†ç 
user:import     - å¯¼å…¥ç”¨æˆ·
user:export     - å¯¼å‡ºç”¨æˆ·
```

#### é¡¹ç›®æ¨¡å—

```
project:list       - æŸ¥çœ‹é¡¹ç›®åˆ—è¡¨
project:create     - åˆ›å»ºé¡¹ç›®
project:update     - æ›´æ–°é¡¹ç›®
project:delete     - åˆ é™¤é¡¹ç›®
project:approve    - å®¡æ‰¹é¡¹ç›®
project:export     - å¯¼å‡ºé¡¹ç›®
project:archive    - å½’æ¡£é¡¹ç›®
```

#### ç”³æŠ¥æ¨¡å—

```
declaration:list       - æŸ¥çœ‹ç”³æŠ¥åˆ—è¡¨
declaration:create     - åˆ›å»ºç”³æŠ¥
declaration:update     - æ›´æ–°ç”³æŠ¥
declaration:delete     - åˆ é™¤ç”³æŠ¥
declaration:approve    - å®¡æ‰¹ç”³æŠ¥
declaration:reject     - é©³å›ç”³æŠ¥
declaration:export     - å¯¼å‡ºç”³æŠ¥
```

#### ç³»ç»Ÿç®¡ç†æ¨¡å—

```
system:config          - ç³»ç»Ÿé…ç½®
system:log:view        - æŸ¥çœ‹æ—¥å¿—
system:log:export      - å¯¼å‡ºæ—¥å¿—
system:log:clear       - æ¸…ç©ºæ—¥å¿—
system:backup          - ç³»ç»Ÿå¤‡ä»½
system:restore         - ç³»ç»Ÿæ¢å¤
```

### 5.3 æƒé™ç ä¸æ¥å£çš„å¯¹åº”å…³ç³»

**ä¸€èˆ¬è§„åˆ™**ï¼š

```
GET    /api/user/list       â†’ user:list
POST   /api/user/create     â†’ user:create
PUT    /api/user/{id}       â†’ user:update
DELETE /api/user/{id}       â†’ user:delete
GET    /api/user/export     â†’ user:export
POST   /api/user/import     â†’ user:import
```

**ç‰¹æ®Šæƒ…å†µ**ï¼š

```
POST /api/project/{id}/approve  â†’ project:approve
POST /api/declaration/{id}/reject â†’ declaration:reject
PUT  /api/user/{id}/disable     â†’ user:disable
PUT  /api/user/{id}/reset-password â†’ user:reset
```

---

## å…­ã€å¦‚ä½•æ·»åŠ æ–°çš„æƒé™ç 

### 6.1 åœ¨æ•°æ®åº“ä¸­æ·»åŠ æƒé™

#### æ­¥éª¤ 1ï¼šåœ¨ `sys_permission` è¡¨ä¸­æ’å…¥æƒé™

```sql
-- ç¤ºä¾‹ï¼šæ·»åŠ ç”¨æˆ·å¯¼å‡ºæƒé™
INSERT INTO sys_permission (
    parent_id,
    permission_name,
    permission_code,
    permission_type,  -- 3=APIæƒé™
    industry_type,
    sort_order,
    status
)
VALUES (
    0,                    -- é¡¶çº§æƒé™
    'å¯¼å‡ºç”¨æˆ·',            -- æƒé™åç§°
    'user:export',        -- æƒé™ç¼–ç 
    3,                    -- APIæƒé™
    'education',          -- è¡Œä¸šç±»å‹
    1,                    -- æ’åº
    1                     -- å¯ç”¨
);
```

#### æ­¥éª¤ 2ï¼šå°†æƒé™ç»‘å®šåˆ°è§’è‰²

```sql
-- ç¤ºä¾‹ï¼šå°† user:export æƒé™ç»‘å®šåˆ° admin è§’è‰²
INSERT INTO sys_role_permission (role_id, permission_id, is_deleted, created_time)
VALUES (
    (SELECT id FROM sys_role WHERE role_code='admin' AND industry_type='education'),
    (SELECT id FROM sys_permission WHERE permission_code='user:export' AND industry_type='education'),
    0,
    CURRENT_TIMESTAMP
);
```

### 6.2 åœ¨ Controller ä¸­ä½¿ç”¨æ–°æƒé™

```java
@GetMapping("/export")
@SaCheckPermission("user:export")  // â† ä½¿ç”¨åˆšæ·»åŠ çš„æƒé™ç 
@Operation(summary = "å¯¼å‡ºç”¨æˆ·")
public Result<Void> exportUsers() {
    userService.export();
    return Result.success(null);
}
```

### 6.3 åˆ·æ–°æƒé™ç¼“å­˜

**æ–¹å¼ 1ï¼šé‡å¯é¡¹ç›®**ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

```bash
# é‡å¯åæƒé™ç¼“å­˜ä¼šè‡ªåŠ¨ä»æ•°æ®åº“é‡æ–°åŠ è½½
mvn spring-boot:run
```

**æ–¹å¼ 2ï¼šè°ƒç”¨åˆ·æ–°æ¥å£**ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

```java
// åœ¨ PermissionService ä¸­è°ƒç”¨
permissionService.refreshUserAuthCache(userId, industryType);
```

---

## ä¸ƒã€å®Œæ•´ç¤ºä¾‹

### 7.1 ç”¨æˆ·ç®¡ç† Controller

```java
@RestController
@RequestMapping("/api/user")
@Tag(name = "ç”¨æˆ·ç®¡ç†", description = "ç”¨æˆ·å¢åˆ æ”¹æŸ¥ã€æƒé™ç®¡ç†")
@RequiredArgsConstructor
public class UserController {

    private final UserService userService;

    /**
     * æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨
     * æƒé™ï¼šuser:list
     */
    @GetMapping("/list")
    @SaCheckPermission("user:list")
    @Operation(summary = "æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨", description = "åˆ†é¡µæŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨")
    public Result<List<UserResp>> listUsers(@Valid UserQueryReq req) {
        List<UserResp> users = userService.list(req);
        return Result.success(users);
    }

    /**
     * æŸ¥çœ‹ç”¨æˆ·è¯¦æƒ…
     * æƒé™ï¼šuser:list
     */
    @GetMapping("/{id}")
    @SaCheckPermission("user:list")
    @Operation(summary = "æŸ¥çœ‹ç”¨æˆ·è¯¦æƒ…")
    public Result<UserDetailResp> getUserDetail(@PathVariable Long id) {
        UserDetailResp detail = userService.getDetail(id);
        return Result.success(detail);
    }

    /**
     * åˆ›å»ºç”¨æˆ·
     * æƒé™ï¼šuser:create
     */
    @PostMapping("/create")
    @SaCheckPermission("user:create")
    @Operation(summary = "åˆ›å»ºç”¨æˆ·")
    public Result<UserResp> createUser(@Valid @RequestBody UserCreateReq req) {
        UserResp resp = userService.create(req);
        return Result.success(resp);
    }

    /**
     * æ›´æ–°ç”¨æˆ·
     * æƒé™ï¼šuser:update
     */
    @PutMapping("/{id}")
    @SaCheckPermission("user:update")
    @Operation(summary = "æ›´æ–°ç”¨æˆ·ä¿¡æ¯")
    public Result<UserResp> updateUser(@PathVariable Long id,
                                       @Valid @RequestBody UserUpdateReq req) {
        UserResp resp = userService.update(id, req);
        return Result.success(resp);
    }

    /**
     * åˆ é™¤ç”¨æˆ·
     * æƒé™ï¼šuser:delete
     */
    @DeleteMapping("/{id}")
    @SaCheckPermission("user:delete")
    @Operation(summary = "åˆ é™¤ç”¨æˆ·")
    public Result<Void> deleteUser(@PathVariable Long id) {
        userService.deleteById(id);
        return Result.success(null);
    }

    /**
     * ç¦ç”¨ç”¨æˆ·
     * æƒé™ï¼šuser:disable
     */
    @PutMapping("/{id}/disable")
    @SaCheckPermission("user:disable")
    @Operation(summary = "ç¦ç”¨ç”¨æˆ·")
    public Result<Void> disableUser(@PathVariable Long id) {
        userService.disable(id);
        return Result.success(null);
    }

    /**
     * å¯ç”¨ç”¨æˆ·
     * æƒé™ï¼šuser:disableï¼ˆå¤ç”¨ç¦ç”¨æƒé™ï¼‰
     */
    @PutMapping("/{id}/enable")
    @SaCheckPermission("user:disable")
    @Operation(summary = "å¯ç”¨ç”¨æˆ·")
    public Result<Void> enableUser(@PathVariable Long id) {
        userService.enable(id);
        return Result.success(null);
    }

    /**
     * é‡ç½®å¯†ç 
     * æƒé™ï¼šuser:reset
     */
    @PutMapping("/{id}/reset-password")
    @SaCheckPermission("user:reset")
    @Operation(summary = "é‡ç½®ç”¨æˆ·å¯†ç ")
    public Result<Void> resetPassword(@PathVariable Long id) {
        userService.resetPassword(id);
        return Result.success(null);
    }

    /**
     * å¯¼å‡ºç”¨æˆ·
     * æƒé™ï¼šuser:export
     */
    @GetMapping("/export")
    @SaCheckPermission("user:export")
    @Operation(summary = "å¯¼å‡ºç”¨æˆ·æ•°æ®")
    public Result<Void> exportUsers(@Valid UserQueryReq req) {
        userService.export(req);
        return Result.success(null);
    }

    /**
     * å¯¼å…¥ç”¨æˆ·
     * æƒé™ï¼šuser:import
     */
    @PostMapping("/import")
    @SaCheckPermission("user:import")
    @Operation(summary = "å¯¼å…¥ç”¨æˆ·æ•°æ®")
    public Result<Void> importUsers(@RequestParam("file") MultipartFile file) {
        userService.importUsers(file);
        return Result.success(null);
    }
}
```

### 7.2 é¡¹ç›®ç®¡ç† Controller

```java
@RestController
@RequestMapping("/api/project")
@Tag(name = "é¡¹ç›®ç®¡ç†", description = "é¡¹ç›®å¢åˆ æ”¹æŸ¥ã€å®¡æ‰¹")
@RequiredArgsConstructor
public class ProjectController {

    private final ProjectService projectService;

    /**
     * æŸ¥çœ‹é¡¹ç›®åˆ—è¡¨
     * åªéœ€è¦ç™»å½•å³å¯ï¼ˆç”¨æˆ·å¯ä»¥æŸ¥çœ‹è‡ªå·±çš„é¡¹ç›®ï¼‰
     */
    @GetMapping("/list")
    @SaCheckLogin
    @Operation(summary = "æŸ¥çœ‹é¡¹ç›®åˆ—è¡¨")
    public Result<List<ProjectResp>> listProjects(@Valid ProjectQueryReq req) {
        Long userId = StpUtil.getLoginIdAsLong();
        List<ProjectResp> projects = projectService.listByUser(userId, req);
        return Result.success(projects);
    }

    /**
     * æŸ¥çœ‹æ‰€æœ‰é¡¹ç›®ï¼ˆç®¡ç†å‘˜ï¼‰
     * æƒé™ï¼šproject:list
     */
    @GetMapping("/all")
    @SaCheckPermission("project:list")
    @Operation(summary = "æŸ¥çœ‹æ‰€æœ‰é¡¹ç›®")
    public Result<List<ProjectResp>> listAllProjects(@Valid ProjectQueryReq req) {
        List<ProjectResp> projects = projectService.listAll(req);
        return Result.success(projects);
    }

    /**
     * åˆ›å»ºé¡¹ç›®
     * æƒé™ï¼šproject:create
     */
    @PostMapping("/create")
    @SaCheckPermission("project:create")
    @Operation(summary = "åˆ›å»ºé¡¹ç›®")
    public Result<ProjectResp> createProject(@Valid @RequestBody ProjectCreateReq req) {
        ProjectResp resp = projectService.create(req);
        return Result.success(resp);
    }

    /**
     * æ›´æ–°é¡¹ç›®
     * æƒé™ï¼šproject:update
     */
    @PutMapping("/{id}")
    @SaCheckPermission("project:update")
    @Operation(summary = "æ›´æ–°é¡¹ç›®")
    public Result<ProjectResp> updateProject(@PathVariable Long id,
                                            @Valid @RequestBody ProjectUpdateReq req) {
        ProjectResp resp = projectService.update(id, req);
        return Result.success(resp);
    }

    /**
     * åˆ é™¤é¡¹ç›®
     * æƒé™ï¼šproject:delete
     */
    @DeleteMapping("/{id}")
    @SaCheckPermission("project:delete")
    @Operation(summary = "åˆ é™¤é¡¹ç›®")
    public Result<Void> deleteProject(@PathVariable Long id) {
        projectService.deleteById(id);
        return Result.success(null);
    }

    /**
     * å®¡æ‰¹é¡¹ç›®
     * æƒé™ï¼šproject:approve
     */
    @PostMapping("/{id}/approve")
    @SaCheckPermission("project:approve")
    @Operation(summary = "å®¡æ‰¹é¡¹ç›®")
    public Result<Void> approveProject(@PathVariable Long id,
                                      @Valid @RequestBody ApproveReq req) {
        projectService.approve(id, req);
        return Result.success(null);
    }

    /**
     * å¯¼å‡ºé¡¹ç›®
     * æƒé™ï¼šproject:export
     */
    @GetMapping("/export")
    @SaCheckPermission("project:export")
    @Operation(summary = "å¯¼å‡ºé¡¹ç›®æ•°æ®")
    public Result<Void> exportProjects(@Valid ProjectQueryReq req) {
        projectService.export(req);
        return Result.success(null);
    }
}
```

---

## å…«ã€å¸¸è§é—®é¢˜

### Q1ï¼šæ³¨è§£é‡Œçš„æƒé™ç ä»å“ªé‡Œæ¥ï¼Ÿ

**A1ï¼šä»æ•°æ®åº“ `sys_permission` è¡¨ä¸­å®šä¹‰**

1. åœ¨ `sys_permission` è¡¨ä¸­æ’å…¥æƒé™è®°å½•
2. å°†æƒé™ç»‘å®šåˆ°è§’è‰²ï¼ˆ`sys_role_permission` è¡¨ï¼‰
3. åœ¨ Controller ä¸­ä½¿ç”¨å¯¹åº”çš„ `permission_code`

### Q2ï¼šå¦‚ä½•åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰æŸä¸ªæƒé™ï¼Ÿ

**A2ï¼šä½¿ç”¨ `StpUtil` å·¥å…·ç±»**

```java
// åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰æƒé™
boolean hasPermission = StpUtil.hasPermission("user:delete");

// åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰è§’è‰²
boolean hasRole = StpUtil.hasRole("admin");

// è·å–å½“å‰ç”¨æˆ·çš„æ‰€æœ‰æƒé™
List<String> permissions = StpUtil.getPermissionList();

// è·å–å½“å‰ç”¨æˆ·çš„æ‰€æœ‰è§’è‰²
List<String> roles = StpUtil.getRoleList();
```

### Q3ï¼šæƒé™æ£€æŸ¥å¤±è´¥ä¼šè¿”å›ä»€ä¹ˆï¼Ÿ

**A3ï¼šä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè¿”å› 403 Forbidden**

```json
{
  "code": 403,
  "message": "æ— æƒé™ï¼šuser:delete"
}
```

**å¯ä»¥åœ¨å…¨å±€å¼‚å¸¸å¤„ç†å™¨ä¸­ç»Ÿä¸€å¤„ç†**ï¼š

```java
@RestControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(NotPermissionException.class)
    public Result<Void> handleNotPermissionException(NotPermissionException e) {
        return Result.fail(ResultCode.FORBIDDEN.getCode(),
                          "æ— æƒé™ï¼š" + e.getPermission());
    }

    @ExceptionHandler(NotRoleException.class)
    public Result<Void> handleNotRoleException(NotRoleException e) {
        return Result.fail(ResultCode.FORBIDDEN.getCode(),
                          "éœ€è¦è§’è‰²ï¼š" + e.getRole());
    }

    @ExceptionHandler(NotLoginException.class)
    public Result<Void> handleNotLoginException(NotLoginException e) {
        return Result.fail(ResultCode.UNAUTHORIZED.getCode(),
                          "æœªç™»å½•æˆ–ç™»å½•å·²è¿‡æœŸ");
    }
}
```

### Q4ï¼šå¯ä»¥åœ¨æ–¹æ³•å†…éƒ¨æ‰‹åŠ¨æ£€æŸ¥æƒé™å—ï¼Ÿ

**A4ï¼šå¯ä»¥ï¼Œä½¿ç”¨ `StpUtil` æ‰‹åŠ¨æ£€æŸ¥**

```java
@PostMapping("/sensitive")
@SaCheckLogin
public Result<Void> sensitiveOperation() {
    // æ‰‹åŠ¨æ£€æŸ¥æƒé™
    if (!StpUtil.hasPermission("sensitive:operation")) {
        throw new BusinessException(ResultCode.FORBIDDEN, "æ— æƒé™æ‰§è¡Œæ­¤æ“ä½œ");
    }

    // æ‰‹åŠ¨æ£€æŸ¥è§’è‰²
    if (!StpUtil.hasRole("admin")) {
        throw new BusinessException(ResultCode.FORBIDDEN, "éœ€è¦ç®¡ç†å‘˜è§’è‰²");
    }

    // æ‰§è¡Œä¸šåŠ¡é€»è¾‘
    service.doSensitiveOperation();
    return Result.success(null);
}
```

### Q5ï¼šå‰ç«¯å¦‚ä½•æ ¹æ®æƒé™æ§åˆ¶æŒ‰é’®æ˜¾ç¤ºï¼Ÿ

**A5ï¼šç™»å½•æ—¶è¿”å›ç”¨æˆ·çš„æƒé™åˆ—è¡¨ï¼Œå‰ç«¯æ ¹æ®æƒé™æ§åˆ¶ UI**

**åç«¯ï¼ˆç™»å½•æ¥å£ï¼‰**ï¼š

```java
@Override
public LoginResp login(...) {
    // ...
    var permissions = permissionService.findPermissionCodes(userId, industryType);
    var roles = permissionService.findRoleCodes(userId, industryType);

    loginResp.setPermissions(permissions);
    loginResp.setRoles(roles);

    return loginResp;
}
```

**å‰ç«¯ï¼ˆVue 3ï¼‰**ï¼š

```vue
<template>
  <div>
    <!-- æ ¹æ®æƒé™æ˜¾ç¤ºåˆ é™¤æŒ‰é’® -->
    <el-button v-if="hasPermission('user:delete')" @click="deleteUser">
      åˆ é™¤ç”¨æˆ·
    </el-button>

    <!-- æ ¹æ®è§’è‰²æ˜¾ç¤ºç®¡ç†å…¥å£ -->
    <el-menu-item v-if="hasRole('admin')"> ç³»ç»Ÿç®¡ç† </el-menu-item>
  </div>
</template>

<script setup>
import { useUserStore } from "@/stores/user";

const userStore = useUserStore();

function hasPermission(permission) {
  return (
    userStore.permissions.includes("*") ||
    userStore.permissions.includes(permission)
  );
}

function hasRole(role) {
  return userStore.roles.includes(role);
}
</script>
```

### Q6ï¼šæ€§èƒ½é—®é¢˜ï¼šæ¯æ¬¡è¯·æ±‚éƒ½æŸ¥è¯¢æ•°æ®åº“å—ï¼Ÿ

**A6ï¼šä¸ä¼šï¼Œæœ‰ç¼“å­˜æœºåˆ¶**

1. **CustomStpInterface** è°ƒç”¨ **PermissionService**
2. **PermissionService** å†…éƒ¨ä½¿ç”¨ **Redis ç¼“å­˜**ï¼ˆ30 åˆ†é’Ÿè¿‡æœŸï¼‰
3. ç¼“å­˜å‘½ä¸­ï¼šç›´æ¥è¿”å›
4. ç¼“å­˜æœªå‘½ä¸­ï¼šæŸ¥è¯¢æ•°æ®åº“ â†’ å†™å…¥ç¼“å­˜ â†’ è¿”å›

**ç¼“å­˜é”®æ ¼å¼**ï¼š

```
sciz:auth:perm:{userId}:{industryType}:roles
sciz:auth:perm:{userId}:{industryType}:permissions
```

---

## ä¹ã€æœ€ä½³å®è·µ

### 9.1 æƒé™ç è®¾è®¡åŸåˆ™

1. âœ… **ç®€æ´æ˜äº†**ï¼š`user:delete` ä¼˜äº `api:user:delete:operation`
2. âœ… **è¯­ä¹‰åŒ–**ï¼šä¸€çœ¼çœ‹å‡ºæ˜¯ä»€ä¹ˆæƒé™
3. âœ… **ç»Ÿä¸€æ ¼å¼**ï¼šå…¨éƒ¨ä½¿ç”¨ `æ¨¡å—å:æ“ä½œ` æ ¼å¼
4. âœ… **é¿å…é‡å¤**ï¼šä¸è¦ä¸ºåŒä¸€ä¸ªæ“ä½œå®šä¹‰å¤šä¸ªæƒé™ç 

### 9.2 æ³¨è§£ä½¿ç”¨åŸåˆ™

1. âœ… **æ‰€æœ‰é‡è¦æ¥å£éƒ½è¦åŠ æ³¨è§£**ï¼ˆå¢åˆ æ”¹æŸ¥ã€å¯¼å‡ºã€å®¡æ‰¹ç­‰ï¼‰
2. âœ… **ä¼˜å…ˆä½¿ç”¨ @SaCheckPermission**ï¼ˆæœ€çµæ´»ï¼‰
3. âœ… **å…¬å¼€æ¥å£ä¸åŠ æ³¨è§£**ï¼ˆloginã€registerï¼‰
4. âœ… **åªéœ€è¦ç™»å½•çš„æ¥å£ä½¿ç”¨ @SaCheckLogin**ï¼ˆæŸ¥çœ‹è‡ªå·±çš„èµ„æ–™ï¼‰

### 9.3 å‰åç«¯åŒé‡éªŒè¯

```
å‰ç«¯æ§åˆ¶ï¼ˆç”¨æˆ·ä½“éªŒï¼‰
    â†“
æ ¹æ®æƒé™æ˜¾ç¤º/éšè—åŠŸèƒ½
    â†“
åç«¯éªŒè¯ï¼ˆå®‰å…¨ä¿éšœï¼‰â­
    â†“
ä½¿ç”¨æ³¨è§£æ£€æŸ¥æƒé™
    â†“
ä¿è¯ç³»ç»Ÿå®‰å…¨ âœ…
```

### 9.4 æƒé™ç²’åº¦å»ºè®®

- âœ… **ç²—ç²’åº¦**ï¼šæŒ‰æ¨¡å—åˆ’åˆ†ï¼ˆé€‚åˆå°é¡¹ç›®ï¼‰

  ```
  user:manage    - ç”¨æˆ·ç®¡ç†ï¼ˆåŒ…å«å¢åˆ æ”¹æŸ¥ï¼‰
  project:manage - é¡¹ç›®ç®¡ç†ï¼ˆåŒ…å«å¢åˆ æ”¹æŸ¥ï¼‰
  ```

- âœ… **ç»†ç²’åº¦**ï¼šæŒ‰æ“ä½œåˆ’åˆ†ï¼ˆé€‚åˆå¤§é¡¹ç›®ï¼‰

  ```
  user:list      - æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨
  user:create    - åˆ›å»ºç”¨æˆ·
  user:update    - æ›´æ–°ç”¨æˆ·
  user:delete    - åˆ é™¤ç”¨æˆ·
  ```

- âœ… **è¶…ç»†ç²’åº¦**ï¼šæŒ‰å­—æ®µåˆ’åˆ†ï¼ˆé€‚åˆç‰¹æ®Šéœ€æ±‚ï¼‰
  ```
  user:view:email    - æŸ¥çœ‹ç”¨æˆ·é‚®ç®±
  user:view:phone    - æŸ¥çœ‹ç”¨æˆ·æ‰‹æœº
  user:edit:salary   - ç¼–è¾‘ç”¨æˆ·è–ªèµ„
  ```

---

## åã€æ€»ç»“

### ä¸‰å¤§æ³¨è§£å¯¹æ¯”

| æ³¨è§£                   | æ£€æŸ¥å†…å®¹       | å®‰å…¨ç­‰çº§ | æ¨èåº¦     |
| ---------------------- | -------------- | -------- | ---------- |
| **@SaCheckLogin**      | æ˜¯å¦ç™»å½•       | âš ï¸ ä½    | â­â­       |
| **@SaCheckRole**       | æ˜¯å¦æœ‰æŒ‡å®šè§’è‰² | âœ… ä¸­    | â­â­â­     |
| **@SaCheckPermission** | æ˜¯å¦æœ‰æŒ‡å®šæƒé™ | âœ… é«˜    | â­â­â­â­â­ |

### æƒé™ç å‘½åè§„èŒƒ

```
æ ¼å¼ï¼šæ¨¡å—å:æ“ä½œ

ç¤ºä¾‹ï¼š
user:list       - æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨
user:create     - åˆ›å»ºç”¨æˆ·
user:delete     - åˆ é™¤ç”¨æˆ·
project:approve - å®¡æ‰¹é¡¹ç›®
report:accept   - éªŒæ”¶æŠ¥å‘Š
```

### ä½¿ç”¨æ­¥éª¤

1. **æ•°æ®åº“å®šä¹‰æƒé™**ï¼ˆ`sys_permission` è¡¨ï¼‰
2. **ç»‘å®šæƒé™åˆ°è§’è‰²**ï¼ˆ`sys_role_permission` è¡¨ï¼‰
3. **åœ¨ Controller ä¸­ä½¿ç”¨æ³¨è§£**ï¼ˆ`@SaCheckPermission("user:delete")`ï¼‰
4. **å‰ç«¯æ ¹æ®æƒé™æ§åˆ¶ UI**ï¼ˆéšè—æ— æƒé™çš„æŒ‰é’®ï¼‰
5. **æµ‹è¯•æƒé™åŠŸèƒ½**ï¼ˆç¡®ä¿æƒé™æ£€æŸ¥ç”Ÿæ•ˆï¼‰

---

**ç°åœ¨æ‚¨å¯ä»¥åœ¨é¡¹ç›®ä¸­æ­£ç¡®ä½¿ç”¨æƒé™æ³¨è§£äº†ï¼** ğŸ‰
