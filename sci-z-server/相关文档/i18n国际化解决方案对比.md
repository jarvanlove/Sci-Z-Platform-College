# i18n 国际化解决方案对比

## 问题描述

前端已实现 i18n（Vue I18n，支持 zh-CN、en-US、ko-KR、ja-JP），但后端返回的菜单和接口数据都是中文文本，当前端切换语言时，这部分数据无法切换。

---

## 方案一：前端翻译 Key 映射方案（推荐）⭐

### 核心思路

后端返回**翻译 key**（如 `permissionCode`、`roleCode`），前端根据 key 进行翻译。如果前端没有翻译，则使用后端返回的原始文本作为 fallback。

### 实现方式

#### 后端改动

1. **响应 DTO 保持不变**，但确保返回 `permissionCode`、`roleCode` 等 key 字段
2. **菜单响应（LoginMenuResp）**：

   - 保留 `title` 字段（原始中文文本，用于 fallback）
   - 保留 `permission` 字段（权限码，作为翻译 key）
   - 前端使用 `permission` 作为翻译 key

3. **角色响应（RoleListResp）**：
   - 保留 `roleName` 字段（原始中文文本，用于 fallback）
   - 保留 `roleCode` 字段（角色编码，作为翻译 key）
   - 前端使用 `roleCode` 作为翻译 key

#### 前端改动

1. **翻译文件配置**：

   ```javascript
   // zh-CN.js
   export default {
     menu: {
       'menu:dashboard:view': '仪表板',
       'menu:declaration:list': '申报管理',
       'menu:system:user': '系统管理'
     },
     role: {
       'admin': '系统管理员',
       'user': '普通用户'
     }
   }

   // en-US.js
   export default {
     menu: {
       'menu:dashboard:view': 'Dashboard',
       'menu:declaration:list': 'Declaration Management',
       'menu:system:user': 'System Management'
     },
     role: {
       'admin': 'System Administrator',
       'user': 'Normal User'
     }
   }
   ```

2. **组件中使用**：
   ```vue
   <template>
     <!-- 菜单标题：使用 permission 作为 key -->
     <span>{{ $t(`menu.${menu.permission}`, menu.title) }}</span>

     <!-- 角色名称：使用 roleCode 作为 key -->
     <span>{{ $t(`role.${role.roleCode}`, role.roleName) }}</span>
   </template>
   ```

### 优点

- ✅ **后端改动最小**：只需确保返回 key 字段，无需修改 DTO 结构
- ✅ **前端灵活**：前端可以自由管理翻译文件
- ✅ **向后兼容**：如果前端没有翻译，自动使用原始文本
- ✅ **实现简单**：无需修改数据库，无需新增字段

### 缺点

- ⚠️ **翻译 key 格式依赖**：前端需要知道如何从 `permissionCode` 生成翻译 key
- ⚠️ **需要维护翻译文件**：前端需要为所有菜单和角色添加翻译

### 适用场景

- 前端团队可以维护翻译文件
- 希望后端改动最小
- 翻译内容相对固定，不会频繁变化

---

## 方案二：后端多语言字段方案

### 核心思路

后端根据请求头语言返回对应语言的文本，同时保留原始中文文本作为 fallback。

### 实现方式

#### 后端改动

1. **创建语言工具类**：

   - 从请求头 `X-Language` 或 `Accept-Language` 获取语言
   - 支持：`zh-CN`、`en-US`、`ko-KR`、`ja-JP`

2. **响应 DTO 添加多语言字段**：

   ```java
   // LoginMenuResp
   private String title;        // 中文标题（原始）
   private String titleEn;      // 英文标题（可选）
   private String titleKo;      // 韩文标题（可选）
   private String titleJa;      // 日文标题（可选）
   ```

3. **Service 层根据语言返回对应字段**：

   ```java
   // 根据语言返回对应标题
   String title = LocaleUtil.isEnglish() ? perm.getTitleEn() : perm.getPermissionName();
   ```

4. **数据库扩展（可选）**：
   - 在 `sys_permission` 表添加多语言字段：`permission_name_en`、`permission_name_ko`、`permission_name_ja`
   - 在 `sys_role` 表添加多语言字段：`role_name_en`、`role_name_ko`、`role_name_ja`

#### 前端改动

1. **请求头设置语言**：

   ```javascript
   axios.defaults.headers.common["X-Language"] = "en-US";
   ```

2. **直接使用后端返回的文本**：
   ```vue
   <template>
     <!-- 直接使用后端返回的 title，无需翻译 -->
     <span>{{ menu.title }}</span>
   </template>
   ```

### 优点

- ✅ **前端无需翻译**：后端直接返回对应语言的文本
- ✅ **翻译集中管理**：所有翻译在后端统一管理
- ✅ **支持动态翻译**：可以通过管理界面动态修改翻译

### 缺点

- ❌ **数据库改动大**：需要添加多语言字段
- ❌ **后端改动大**：需要修改所有返回文本的接口
- ❌ **维护成本高**：需要为每个文本维护多语言版本
- ❌ **数据冗余**：同一文本存储多个语言版本

### 适用场景

- 翻译内容需要动态管理
- 后端团队可以维护翻译
- 翻译内容会频繁变化

---

## 方案三：混合方案（Key + 多语言文本）

### 核心思路

后端同时返回**翻译 key** 和**多语言文本对象**，前端优先使用 key 翻译，如果没有翻译则从多语言文本对象中选择。

### 实现方式

#### 后端改动

1. **响应 DTO 结构**：

   ```java
   // LoginMenuResp
   private String title;           // 中文标题（原始，用于 fallback）
   private String titleKey;        // 翻译 key（如：menu.dashboard.view）
   private Map<String, String> titleI18n;  // 多语言文本对象
   // {
   //   "zh-CN": "仪表板",
   //   "en-US": "Dashboard",
   //   "ko-KR": "대시보드",
   //   "ja-JP": "ダッシュボード"
   // }
   ```

2. **Service 层生成多语言对象**：

   ```java
   // 从数据库或配置文件读取多语言文本
   Map<String, String> titleI18n = i18nService.getTextMap("menu.dashboard.view");
   ```

3. **数据库或配置文件存储翻译**：
   - 方案 A：创建 `sys_i18n` 表存储翻译
   - 方案 B：使用 `messages_zh-CN.properties`、`messages_en-US.properties` 等配置文件

#### 前端改动

1. **优先使用 key 翻译**：
   ```vue
   <template>
     <!-- 优先使用 titleKey 翻译 -->
     <span v-if="menu.titleKey && $te(menu.titleKey)">
       {{ $t(menu.titleKey) }}
     </span>
     <!-- 如果没有翻译，从 titleI18n 对象中选择 -->
     <span v-else-if="menu.titleI18n">
       {{ menu.titleI18n[i18n.locale] || menu.title }}
     </span>
     <!-- 最后 fallback 到原始文本 -->
     <span v-else>{{ menu.title }}</span>
   </template>
   ```

### 优点

- ✅ **灵活性最高**：支持 key 翻译和多语言文本两种方式
- ✅ **向后兼容**：前端可以选择使用哪种方式
- ✅ **支持动态翻译**：后端可以动态管理翻译

### 缺点

- ❌ **实现复杂**：需要同时支持两种翻译方式
- ❌ **数据冗余**：返回的数据量较大
- ❌ **维护成本高**：需要维护翻译 key 和多语言文本

### 适用场景

- 需要同时支持静态翻译（前端）和动态翻译（后端）
- 翻译内容需要灵活管理
- 系统规模较大，需要渐进式改造

---

## 方案对比总结

| 方案                       | 后端改动    | 前端改动  | 数据库改动 | 维护成本  | 灵活性    | 推荐度     |
| -------------------------- | ----------- | --------- | ---------- | --------- | --------- | ---------- |
| **方案一：前端 Key 映射**  | ✅ 无需改动 | ⭐⭐ 中等 | ✅ 无需    | ⭐⭐ 中等 | ⭐⭐⭐ 高 | ⭐⭐⭐⭐⭐ |
| **方案二：后端多语言字段** | ❌ 最大     | ✅ 最小   | ❌ 需要    | ❌ 高     | ⭐⭐ 中等 | ⭐⭐       |
| **方案三：混合方案**       | ⭐⭐ 中等   | ⭐⭐ 中等 | ⭐ 可选    | ❌ 高     | ⭐⭐⭐ 高 | ⭐⭐⭐     |

---

## 当前系统状态分析

### 已有的字段（可用于翻译 Key）

1. **菜单（LoginMenuResp）**：

   - ✅ `permission` 字段：权限码（如 `menu:dashboard:view`）
   - ✅ `title` 字段：菜单标题（中文，用于 fallback）

2. **角色（RoleListResp）**：
   - ✅ `roleCode` 字段：角色编码（如 `admin`、`user`）
   - ✅ `roleName` 字段：角色名称（中文，用于 fallback）

### 结论

**方案一可以直接使用，无需后端改动**，因为：

- 菜单已有 `permission` 字段，可以作为翻译 key
- 角色已有 `roleCode` 字段，可以作为翻译 key
- 菜单已有 `title` 字段，可以作为 fallback
- 角色已有 `roleName` 字段，可以作为 fallback

---

## 推荐方案

### 推荐：方案一（前端 Key 映射方案）

**理由**：

1. **后端改动最小**：只需确保返回 `permissionCode`、`roleCode` 等 key 字段（这些字段已经存在）
2. **前端灵活**：前端可以自由管理翻译文件，符合前端 i18n 的最佳实践
3. **实现简单**：无需修改数据库，无需新增字段
4. **向后兼容**：如果前端没有翻译，自动使用原始文本

### 实施步骤

1. **后端**：

   - ✅ **无需任何代码改动**
   - ✅ 已有字段：`LoginMenuResp.permission`、`RoleListResp.roleCode`
   - ✅ 只需在接口文档中说明：前端可以使用这些字段作为翻译 key

2. **前端**：
   - 在翻译文件中添加菜单和角色的翻译（使用 `permission` 和 `roleCode` 作为 key）
   - 在组件中使用 key 进行翻译，fallback 到原始文本（`title`、`roleName`）
   - 切换语言时，**无需重新请求数据**（因为使用的是前端翻译）

---

## 详细实施建议

### 方案一详细实施

#### 1. 菜单翻译 Key 规则

**格式**：`menu.{permissionCode}`

**规则**：将 `permissionCode` 中的冒号（`:`）替换为点（`.`），并添加 `menu.` 前缀

**示例**：

- `permissionCode: "menu:dashboard:view"` → 翻译 key: `menu.menu:dashboard:view`
- 或者直接使用：`menu:dashboard:view` → 翻译 key: `menu.dashboard.view`

**前端翻译文件**：

```javascript
// zh-CN.js
export default {
  menu: {
    'menu:dashboard:view': '仪表板',
    'menu:declaration:list': '申报管理',
    'menu:system:user': '系统管理',
    'menu:project:list': '项目管理',
    'menu:report:list': '验收管理',
    'menu:ai:chat': 'AI助手',
    'menu:user:profile': '用户中心'
  }
}

// en-US.js
export default {
  menu: {
    'menu:dashboard:view': 'Dashboard',
    'menu:declaration:list': 'Declaration Management',
    'menu:system:user': 'System Management',
    'menu:project:list': 'Project Management',
    'menu:report:list': 'Acceptance Management',
    'menu:ai:chat': 'AI Assistant',
    'menu:user:profile': 'User Center'
  }
}

// ko-KR.js
export default {
  menu: {
    'menu:dashboard:view': '대시보드',
    'menu:declaration:list': '신고 관리',
    'menu:system:user': '시스템 관리'
  }
}

// ja-JP.js
export default {
  menu: {
    'menu:dashboard:view': 'ダッシュボード',
    'menu:declaration:list': '申告管理',
    'menu:system:user': 'システム管理'
  }
}
```

#### 2. 角色翻译 Key 规则

**格式**：`role.{roleCode}`

**示例**：

- `roleCode: "admin"` → 翻译 key: `role.admin`
- `roleCode: "user"` → 翻译 key: `role.user`

**前端翻译文件**：

```javascript
// zh-CN.js
export default {
  role: {
    'admin': '系统管理员',
    'user': '普通用户',
    'teacher': '教师'  // 根据实际角色添加
  }
}

// en-US.js
export default {
  role: {
    'admin': 'System Administrator',
    'user': 'Normal User',
    'teacher': 'Teacher'
  }
}

// ko-KR.js
export default {
  role: {
    'admin': '시스템 관리자',
    'user': '일반 사용자',
    'teacher': '교사'
  }
}

// ja-JP.js
export default {
  role: {
    'admin': 'システム管理者',
    'user': '一般ユーザー',
    'teacher': '教師'
  }
}
```

#### 3. 前端组件使用

```vue
<template>
  <!-- 菜单标题：使用 permission 作为 key，title 作为 fallback -->
  <span>{{ $t(`menu.${menu.permission}`, menu.title) }}</span>

  <!-- 或者使用计算属性 -->
  <span>{{ menuTitle(menu) }}</span>
</template>

<script setup>
import { useI18n } from "vue-i18n";

const { t } = useI18n();

// 计算属性：菜单标题
const menuTitle = (menu) => {
  // 优先使用翻译 key，如果没有翻译则使用原始文本
  return t(`menu.${menu.permission}`, menu.title);
};

// 计算属性：角色名称
const roleName = (role) => {
  return t(`role.${role.roleCode}`, role.roleName);
};
</script>
```

#### 4. 切换语言

```javascript
// 切换语言时，无需重新请求数据（因为使用的是前端翻译）
// Vue I18n 会自动更新所有使用 $t() 的文本
i18n.global.locale.value = "en-US"; // Vue 3
// 或
i18n.locale = "en-US"; // Vue 2
```

#### 5. 用户列表中的角色名称翻译

```vue
<template>
  <!-- 用户列表：角色名称列表 -->
  <div v-for="roleName in user.roleNames" :key="roleName">
    <!-- 需要根据 roleCode 翻译，但当前只有 roleName -->
    <!-- 方案A：后端返回 roleCodes 列表 -->
    <span v-for="roleCode in user.roleCodes" :key="roleCode">
      {{ $t(`role.${roleCode}`, roleName) }}
    </span>

    <!-- 方案B：前端维护 roleName -> roleCode 映射 -->
    <span>{{ $t(`role.${getRoleCode(roleName)}`, roleName) }}</span>
  </div>
</template>
```

---

## 其他需要考虑的字段

### 1. 用户列表（UserListResp）

- `roleNames`：角色名称列表

  - 前端可以根据 `roleCode` 进行翻译
  - 或者后端返回 `roleCodes` 列表，前端根据 code 翻译

- `departmentLabel`：部门标签（如"院系"、"部门"）
  - 可以添加翻译 key：`department.label.{industryType}`

### 2. 状态描述

- 状态枚举值可以添加翻译
  - 例如：`status.enabled`、`status.disabled`
  - 前端根据状态码进行翻译

### 3. 操作日志（OperationLogResp）

- `operation`：操作名称
  - 可以添加翻译 key：`operation.{operationCode}`

---

## 总结

**推荐使用方案一（前端 Key 映射方案）**，因为：

1. 后端改动最小，只需确保返回 key 字段（已存在）
2. 前端可以灵活管理翻译文件
3. 实现简单，无需修改数据库
4. 符合前端 i18n 的最佳实践

**如果选择方案一，后端无需任何代码改动**，只需在接口文档中说明：

- 菜单使用 `permission` 字段作为翻译 key（格式：`menu.{permission}`）
- 角色使用 `roleCode` 字段作为翻译 key（格式：`role.{roleCode}`）
- 前端根据这些 key 进行翻译，如果没有翻译则使用 `title`、`roleName` 作为 fallback

---

## 方案二详细实施（如果选择此方案）

### 数据库改动

```sql
-- 权限表添加多语言字段
ALTER TABLE sys_permission
ADD COLUMN permission_name_en VARCHAR(50),
ADD COLUMN permission_name_ko VARCHAR(50),
ADD COLUMN permission_name_ja VARCHAR(50);

-- 角色表添加多语言字段
ALTER TABLE sys_role
ADD COLUMN role_name_en VARCHAR(50),
ADD COLUMN role_name_ko VARCHAR(50),
ADD COLUMN role_name_ja VARCHAR(50),
ADD COLUMN description_en VARCHAR(255),
ADD COLUMN description_ko VARCHAR(255),
ADD COLUMN description_ja VARCHAR(255);
```

### 后端改动

1. **Entity 添加字段**：

   ```java
   // SysPermission
   @TableField("permission_name_en")
   private String permissionNameEn;

   @TableField("permission_name_ko")
   private String permissionNameKo;

   @TableField("permission_name_ja")
   private String permissionNameJa;
   ```

2. **Service 根据语言返回**：

   ```java
   // PermissionServiceImpl
   private String getMenuTitle(SysPermission perm, String language) {
       return switch (language) {
           case "en-US" -> Optional.ofNullable(perm.getPermissionNameEn())
                   .orElse(perm.getPermissionName());
           case "ko-KR" -> Optional.ofNullable(perm.getPermissionNameKo())
                   .orElse(perm.getPermissionName());
           case "ja-JP" -> Optional.ofNullable(perm.getPermissionNameJa())
                   .orElse(perm.getPermissionName());
           default -> perm.getPermissionName(); // 默认中文
       };
   }
   ```

3. **前端请求头设置**：
   ```javascript
   axios.defaults.headers.common["X-Language"] = "en-US";
   ```

### 工作量评估

- **数据库改动**：需要为每个表添加 3-6 个字段
- **Entity 改动**：需要修改 2 个实体类
- **Service 改动**：需要修改所有返回文本的方法
- **数据迁移**：需要为现有数据添加翻译
- **维护成本**：每次新增菜单/角色都需要添加多语言文本

---

## 方案三详细实施（如果选择此方案）

### 数据库设计

```sql
CREATE TABLE sys_i18n (
    id BIGINT PRIMARY KEY,
    resource_type VARCHAR(50) NOT NULL,  -- 'menu', 'role', 'department'
    resource_code VARCHAR(100) NOT NULL, -- 'menu:dashboard:view', 'role.admin'
    language VARCHAR(10) NOT NULL,       -- 'zh-CN', 'en-US', 'ko-KR', 'ja-JP'
    text VARCHAR(255) NOT NULL,          -- 翻译文本
    created_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(resource_type, resource_code, language)
);
```

### 后端改动

1. **创建 I18nService**：

   ```java
   public interface I18nService {
       String getText(String resourceType, String resourceCode, String language);
       Map<String, String> getTextMap(String resourceType, String resourceCode);
   }
   ```

2. **Service 调用 I18nService**：

   ```java
   // 获取多语言文本对象
   Map<String, String> titleI18n = i18nService.getTextMap("menu", perm.getPermissionCode());
   ```

3. **响应 DTO 添加字段**：
   ```java
   private String titleKey;
   private Map<String, String> titleI18n;
   ```

### 工作量评估

- **数据库改动**：需要创建新表
- **Service 改动**：需要创建 I18nService 并修改所有返回文本的方法
- **数据迁移**：需要将现有翻译数据导入数据库
- **维护成本**：需要维护翻译数据表

---

## 最终推荐

### 强烈推荐：方案一（前端 Key 映射方案）

**理由**：

1. ✅ **后端零改动**：所有需要的字段都已存在
2. ✅ **前端灵活**：符合前端 i18n 最佳实践
3. ✅ **实现简单**：无需修改数据库，无需新增字段
4. ✅ **维护成本低**：前端统一管理翻译文件
5. ✅ **性能好**：无需额外的数据库查询

**实施建议**：

1. 后端：无需任何改动，只需在接口文档中说明字段用途
2. 前端：在翻译文件中添加菜单和角色的翻译，使用现有字段作为 key
3. 测试：验证切换语言时菜单和角色名称是否正确切换
