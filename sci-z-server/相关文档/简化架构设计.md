# Sci-Z ç§‘ç ”å¹³å° DDD æ¶æ„è®¾è®¡ - æ™ºèƒ½åŒ–ç§‘ç ”é¡¹ç›®ç®¡ç†

## ğŸ¯ è®¾è®¡åŸåˆ™

1. **ä¿æŒ DDD æ ¸å¿ƒæ€æƒ³**ï¼šé¢†åŸŸé©±åŠ¨ã€åˆ†å±‚æ¶æ„ã€ä¸šåŠ¡é€»è¾‘æ¸…æ™°
2. **ç®€åŒ–å®ç°**ï¼šé™ä½å­¦ä¹ æˆæœ¬ï¼Œå‡å°‘è¿‡åº¦æŠ½è±¡
3. **é€‚åˆå•ä½“åº”ç”¨**ï¼šé¿å…å¾®æœåŠ¡çº§åˆ«çš„å¤æ‚è®¾è®¡
4. **ä¾¿äºç»´æŠ¤**ï¼šç»Ÿä¸€å¤„ç†é€šç”¨é€»è¾‘ï¼Œå‡å°‘é‡å¤ä»£ç 
5. **æ™ºèƒ½åŒ–ç‰¹è‰²**ï¼šçªå‡º AI å·¥ä½œæµå’ŒçŸ¥è¯†åº“ç®¡ç†ç‰¹ç‚¹

## ğŸ“ å¹³å°ç›®å½•ç»“æ„

```
sci-z-server/
â”œâ”€â”€ pom.xml
â””â”€â”€ src/main/
    â”œâ”€â”€ java/com/sciz/server/
    â”‚   â”œâ”€â”€ ServerApplication.java                    # åº”ç”¨å¯åŠ¨ç±»
    â”‚   â”‚
    â”‚   â”œâ”€â”€ interfaces/                                 # æ¥å£å±‚ï¼ˆç”¨æˆ·æ¥å£å±‚ï¼‰
    â”‚   â”‚   â”œâ”€â”€ controller/                            # REST æ§åˆ¶å™¨
    â”‚   â”‚   â”‚   â”œâ”€â”€ user/                              # ç”¨æˆ·æ¨¡å—æ§åˆ¶å™¨
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserController.java            # ç”¨æˆ·ç®¡ç†
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RoleController.java            # è§’è‰²ç®¡ç†
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PermissionController.java      # æƒé™ç®¡ç†
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ AuthController.java            # è®¤è¯æˆæƒ
    â”‚   â”‚   â”‚   â”œâ”€â”€ declaration/                       # ç”³æŠ¥æ¨¡å—æ§åˆ¶å™¨
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ DeclarationController.java     # é¡¹ç›®ç”³æŠ¥ç®¡ç†
    â”‚   â”‚   â”‚   â”œâ”€â”€ project/                           # é¡¹ç›®ç®¡ç†æ¨¡å—æ§åˆ¶å™¨
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectController.java         # é¡¹ç›®ç®¡ç†
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectMemberController.java   # é¡¹ç›®æˆå‘˜ç®¡ç†
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectDocumentController.java # é¡¹ç›®æ–‡æ¡£ç®¡ç†
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectProgressController.java # é¡¹ç›®è¿›åº¦ç®¡ç†
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ KnowledgeBaseController.java   # çŸ¥è¯†åº“æœç´¢
    â”‚   â”‚   â”‚   â”œâ”€â”€ acceptance/                        # éªŒæ”¶æ¨¡å—æ§åˆ¶å™¨
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AcceptanceController.java      # éªŒæ”¶ç®¡ç†
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ReportController.java          # æŠ¥å‘Šç®¡ç†
    â”‚   â”‚   â”‚   â”œâ”€â”€ ai/                                # AIåŠ©æ‰‹æ¨¡å—æ§åˆ¶å™¨
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ConversationController.java    # AIå¯¹è¯ç®¡ç†
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ MessageController.java         # æ¶ˆæ¯ç®¡ç†
    â”‚   â”‚   â”‚   â”œâ”€â”€ knowledge/                         # çŸ¥è¯†åº“æ¨¡å—æ§åˆ¶å™¨
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ KnowledgeBaseController.java   # çŸ¥è¯†åº“ç®¡ç†
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ KnowledgeFolderController.java # æ–‡ä»¶å¤¹ç®¡ç†
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ KnowledgeFileController.java   # æ–‡ä»¶ç®¡ç†
    â”‚   â”‚   â”‚   â”œâ”€â”€ file/                              # æ–‡ä»¶æ¨¡å—æ§åˆ¶å™¨
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ FileController.java            # æ–‡ä»¶ç®¡ç†
    â”‚   â”‚   â”‚   â””â”€â”€ system/                            # ç³»ç»Ÿç®¡ç†æ¨¡å—æ§åˆ¶å™¨
    â”‚   â”‚   â”‚       â”œâ”€â”€ IndustryConfigController.java  # è¡Œä¸šé…ç½®ç®¡ç†
    â”‚   â”‚   â”‚       â”œâ”€â”€ DepartmentController.java      # éƒ¨é—¨ç®¡ç†
    â”‚   â”‚   â”‚       â””â”€â”€ LogController.java             # æ—¥å¿—ç®¡ç†
    â”‚   â”‚   â”œâ”€â”€ assembler/                             # æ¥å£å±‚è½¬æ¢å™¨ï¼ˆDTO <-> VOï¼‰
    â”‚   â”‚   â”‚   â”œâ”€â”€ UserAssembler.java
    â”‚   â”‚   â”‚   â”œâ”€â”€ DeclarationAssembler.java
    â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectAssembler.java
    â”‚   â”‚   â”‚   â””â”€â”€ AcceptanceAssembler.java
    â”‚   â”‚   â”œâ”€â”€ dto/                                   # æ•°æ®ä¼ è¾“å¯¹è±¡
    â”‚   â”‚   â”‚   â”œâ”€â”€ request/                           # è¯·æ±‚ DTO
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ user/
    â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserRegisterRequest.java
    â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserLoginRequest.java
    â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ UserUpdateRequest.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ declaration/
    â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ DeclarationSubmitRequest.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ project/
    â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectCreateRequest.java
    â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectUpdateRequest.java
    â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MemberAddRequest.java
    â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProgressAddRequest.java
    â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ DocumentSearchRequest.java
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ acceptance/
    â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ AcceptanceApplyRequest.java
    â”‚   â”‚   â”‚   â”‚       â””â”€â”€ ReportGenerateRequest.java
    â”‚   â”‚   â”‚   â””â”€â”€ response/                          # å“åº” DTO
    â”‚   â”‚   â”‚       â”œâ”€â”€ user/
    â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ UserInfoResponse.java
    â”‚   â”‚   â”‚       â”‚   â””â”€â”€ LoginResponse.java
    â”‚   â”‚   â”‚       â”œâ”€â”€ declaration/
    â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ DeclarationDetailResponse.java
    â”‚   â”‚   â”‚       â”‚   â””â”€â”€ DeclarationListResponse.java
    â”‚   â”‚   â”‚       â”œâ”€â”€ project/
    â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ ProjectDetailResponse.java
    â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ ProjectListResponse.java
    â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ DocumentListResponse.java
    â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ SearchResultResponse.java
    â”‚   â”‚   â”‚       â”‚   â””â”€â”€ ProgressListResponse.java
    â”‚   â”‚   â”‚       â””â”€â”€ acceptance/
    â”‚   â”‚   â”‚           â”œâ”€â”€ AcceptanceDetailResponse.java
    â”‚   â”‚   â”‚           â”œâ”€â”€ ReportStatusResponse.java
    â”‚   â”‚   â”‚           â””â”€â”€ ReportListResponse.java
    â”‚   â”‚   â””â”€â”€ facade/                                # é—¨é¢æ¥å£ï¼ˆå¯¹å¤–æš´éœ²ï¼‰
    â”‚   â”‚       â”œâ”€â”€ UserFacade.java
    â”‚   â”‚       â”œâ”€â”€ DeclarationFacade.java
    â”‚   â”‚       â”œâ”€â”€ ProjectFacade.java
    â”‚   â”‚       â””â”€â”€ AcceptanceFacade.java
    â”‚   â”‚
    â”‚   â”œâ”€â”€ application/                               # åº”ç”¨å±‚ï¼ˆç”¨ä¾‹ç¼–æ’ï¼‰
    â”‚   â”‚   â”œâ”€â”€ service/                              # åº”ç”¨æœåŠ¡
    â”‚   â”‚   â”‚   â”œâ”€â”€ user/                             # ç”¨æˆ·åº”ç”¨æœåŠ¡
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserApplicationService.java   # ç”¨æˆ·ç®¡ç†åº”ç”¨æœåŠ¡
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AuthApplicationService.java   # è®¤è¯æˆæƒåº”ç”¨æœåŠ¡
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ RoleApplicationService.java   # è§’è‰²æƒé™åº”ç”¨æœåŠ¡
    â”‚   â”‚   â”‚   â”œâ”€â”€ declaration/                      # ç”³æŠ¥åº”ç”¨æœåŠ¡
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ DeclarationApplicationService.java
    â”‚   â”‚   â”‚   â”œâ”€â”€ project/                          # é¡¹ç›®åº”ç”¨æœåŠ¡
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectApplicationService.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectMemberApplicationService.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectDocumentApplicationService.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectProgressApplicationService.java
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ KnowledgeBaseApplicationService.java
    â”‚   â”‚   â”‚   â”œâ”€â”€ acceptance/                       # éªŒæ”¶åº”ç”¨æœåŠ¡
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AcceptanceApplicationService.java
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ReportApplicationService.java
    â”‚   â”‚   â”‚   â”œâ”€â”€ ai/                               # AIåŠ©æ‰‹åº”ç”¨æœåŠ¡
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ConversationApplicationService.java
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ MessageApplicationService.java
    â”‚   â”‚   â”‚   â”œâ”€â”€ knowledge/                        # çŸ¥è¯†åº“åº”ç”¨æœåŠ¡
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ KnowledgeBaseApplicationService.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ KnowledgeFolderApplicationService.java
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ KnowledgeFileApplicationService.java
    â”‚   â”‚   â”‚   â”œâ”€â”€ file/                             # æ–‡ä»¶åº”ç”¨æœåŠ¡
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ FileApplicationService.java
    â”‚   â”‚   â”‚   â””â”€â”€ system/                           # ç³»ç»Ÿç®¡ç†åº”ç”¨æœåŠ¡
    â”‚   â”‚   â”‚       â”œâ”€â”€ IndustryConfigApplicationService.java
    â”‚   â”‚   â”‚       â”œâ”€â”€ DepartmentApplicationService.java
    â”‚   â”‚   â”‚       â””â”€â”€ LogApplicationService.java
    â”‚   â”‚   â”œâ”€â”€ command/                              # å‘½ä»¤å¯¹è±¡ï¼ˆå†™æ“ä½œï¼‰
    â”‚   â”‚   â”‚   â”œâ”€â”€ user/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CreateUserCommand.java
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ UpdateUserCommand.java
    â”‚   â”‚   â”‚   â”œâ”€â”€ declaration/
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SubmitDeclarationCommand.java
    â”‚   â”‚   â”‚   â”œâ”€â”€ project/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CreateProjectCommand.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UpdateProjectCommand.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AddMemberCommand.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UploadDocumentCommand.java
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ AddProgressCommand.java
    â”‚   â”‚   â”‚   â””â”€â”€ acceptance/
    â”‚   â”‚   â”‚       â”œâ”€â”€ ApplyAcceptanceCommand.java
    â”‚   â”‚   â”‚       â””â”€â”€ GenerateReportCommand.java
    â”‚   â”‚   â”œâ”€â”€ query/                                # æŸ¥è¯¢å¯¹è±¡ï¼ˆè¯»æ“ä½œï¼‰
    â”‚   â”‚   â”‚   â”œâ”€â”€ user/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserQuery.java
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ RoleQuery.java
    â”‚   â”‚   â”‚   â”œâ”€â”€ declaration/
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ DeclarationQuery.java
    â”‚   â”‚   â”‚   â”œâ”€â”€ project/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectQuery.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DocumentQuery.java
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ProgressQuery.java
    â”‚   â”‚   â”‚   â””â”€â”€ acceptance/
    â”‚   â”‚   â”‚       â”œâ”€â”€ AcceptanceQuery.java
    â”‚   â”‚   â”‚       â””â”€â”€ ReportQuery.java
    â”‚   â”‚   â”œâ”€â”€ event/                                # åº”ç”¨äº‹ä»¶ï¼ˆè·¨èšåˆåè°ƒï¼‰
    â”‚   â”‚   â”‚   â”œâ”€â”€ handler/                          # äº‹ä»¶å¤„ç†å™¨
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DeclarationEventHandler.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectEventHandler.java
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ AcceptanceEventHandler.java
    â”‚   â”‚   â”‚   â””â”€â”€ publisher/                        # äº‹ä»¶å‘å¸ƒå™¨
    â”‚   â”‚   â”‚       â””â”€â”€ DomainEventPublisher.java
    â”‚   â”‚   â””â”€â”€ assembler/                            # åº”ç”¨å±‚è½¬æ¢å™¨ï¼ˆCommand/Query <-> Domainï¼‰
    â”‚   â”‚       â”œâ”€â”€ UserApplicationAssembler.java
    â”‚   â”‚       â”œâ”€â”€ DeclarationApplicationAssembler.java
    â”‚   â”‚       â”œâ”€â”€ ProjectApplicationAssembler.java
    â”‚   â”‚       â””â”€â”€ AcceptanceApplicationAssembler.java
    â”‚   â”‚
    â”‚   â”œâ”€â”€ domain/                                    # é¢†åŸŸå±‚ï¼ˆæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼‰
    â”‚   â”‚   â”œâ”€â”€ iam/                                   # èº«ä»½ä¸è®¿é—®ç®¡ç†é¢†åŸŸï¼ˆIAMï¼‰
    â”‚   â”‚   â”‚   â”œâ”€â”€ aggregate/                        # èšåˆæ ¹
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ User.java                     # ç”¨æˆ·èšåˆæ ¹
    â”‚   â”‚   â”‚   â”œâ”€â”€ entity/                           # å®ä½“
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Role.java                     # è§’è‰²å®ä½“
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Permission.java               # æƒé™å®ä½“
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Department.java               # éƒ¨é—¨å®ä½“
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ IndustryConfig.java           # è¡Œä¸šé…ç½®å®ä½“
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LoginLog.java                 # ç™»å½•æ—¥å¿—å®ä½“
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ OperationLog.java             # æ“ä½œæ—¥å¿—å®ä½“
    â”‚   â”‚   â”‚   â”œâ”€â”€ valueobject/                      # å€¼å¯¹è±¡
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserProfile.java              # ç”¨æˆ·æ¡£æ¡ˆï¼ˆæ‰©å±•å±æ€§ï¼‰
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserStatus.java               # ç”¨æˆ·çŠ¶æ€
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Password.java                 # å¯†ç å€¼å¯¹è±¡
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RoleType.java                 # è§’è‰²ç±»å‹
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PermissionType.java           # æƒé™ç±»å‹
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DepartmentHierarchy.java      # éƒ¨é—¨å±‚çº§ç»“æ„
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ IndustryType.java             # è¡Œä¸šç±»å‹
    â”‚   â”‚   â”‚   â”œâ”€â”€ service/                          # é¢†åŸŸæœåŠ¡
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AuthenticationService.java    # è®¤è¯æœåŠ¡
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserDomainService.java        # ç”¨æˆ·é¢†åŸŸæœåŠ¡
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RoleManagementService.java    # è§’è‰²ç®¡ç†æœåŠ¡
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PermissionManagementService.java # æƒé™ç®¡ç†æœåŠ¡
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DepartmentManagementService.java # éƒ¨é—¨ç®¡ç†æœåŠ¡
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ IndustryConfigService.java    # è¡Œä¸šé…ç½®æœåŠ¡
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ LogManagementService.java     # æ—¥å¿—ç®¡ç†æœåŠ¡
    â”‚   â”‚   â”‚   â””â”€â”€ repository/                       # ä»“å‚¨æ¥å£
    â”‚   â”‚   â”‚       â”œâ”€â”€ UserRepository.java
    â”‚   â”‚   â”‚       â”œâ”€â”€ RoleRepository.java
    â”‚   â”‚   â”‚       â”œâ”€â”€ PermissionRepository.java
    â”‚   â”‚   â”‚       â”œâ”€â”€ DepartmentRepository.java
    â”‚   â”‚   â”‚       â”œâ”€â”€ IndustryConfigRepository.java
    â”‚   â”‚   â”‚       â”œâ”€â”€ LoginLogRepository.java
    â”‚   â”‚   â”‚       â””â”€â”€ OperationLogRepository.java
    â”‚   â”‚   â”œâ”€â”€ declaration/                          # ç”³æŠ¥ç®¡ç†é¢†åŸŸ
    â”‚   â”‚   â”‚   â”œâ”€â”€ aggregate/
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Declaration.java              # ç”³æŠ¥èšåˆæ ¹
    â”‚   â”‚   â”‚   â”œâ”€â”€ entity/
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ WorkflowTemplate.java         # å·¥ä½œæµæ¨¡æ¿å®ä½“
    â”‚   â”‚   â”‚   â”œâ”€â”€ valueobject/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DeclarationNumber.java        # ç”³æŠ¥ç¼–å·
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ResearchDirection.java        # ç ”ç©¶æ–¹å‘
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ResearchFields.java           # ç ”ç©¶é¢†åŸŸ
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DeclarationStatus.java        # ç”³æŠ¥çŠ¶æ€
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ WorkflowStatus.java           # å·¥ä½œæµçŠ¶æ€
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ WorkflowResult.java           # Difyå·¥ä½œæµç»“æœ
    â”‚   â”‚   â”‚   â”œâ”€â”€ service/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DeclarationDomainService.java # ç”³æŠ¥é¢†åŸŸæœåŠ¡
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DeclarationWorkflowService.java # ç”³æŠ¥å·¥ä½œæµæœåŠ¡
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ WorkflowTemplateService.java  # å·¥ä½œæµæ¨¡æ¿æœåŠ¡
    â”‚   â”‚   â”‚   â””â”€â”€ repository/
    â”‚   â”‚   â”‚       â”œâ”€â”€ DeclarationRepository.java
    â”‚   â”‚   â”‚       â””â”€â”€ WorkflowTemplateRepository.java
    â”‚   â”‚   â”œâ”€â”€ project/                              # é¡¹ç›®ç®¡ç†é¢†åŸŸ
    â”‚   â”‚   â”‚   â”œâ”€â”€ aggregate/
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Project.java                  # é¡¹ç›®èšåˆæ ¹
    â”‚   â”‚   â”‚   â”œâ”€â”€ entity/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectMember.java            # é¡¹ç›®æˆå‘˜å®ä½“
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ProjectProgress.java          # é¡¹ç›®è¿›åº¦å®ä½“
    â”‚   â”‚   â”‚   â”œâ”€â”€ valueobject/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectNumber.java            # é¡¹ç›®ç¼–å·
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectStatus.java            # é¡¹ç›®çŠ¶æ€
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Budget.java                   # é¡¹ç›®é¢„ç®—
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProgressPercentage.java       # è¿›åº¦ç™¾åˆ†æ¯”
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MemberRole.java               # æˆå‘˜è§’è‰²
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Milestone.java                # é‡Œç¨‹ç¢‘ä¿¡æ¯
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ DifyKnowledgeId.java          # DifyçŸ¥è¯†åº“ID
    â”‚   â”‚   â”‚   â”œâ”€â”€ service/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectDomainService.java     # é¡¹ç›®é¢†åŸŸæœåŠ¡
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MemberManagementService.java  # æˆå‘˜ç®¡ç†æœåŠ¡
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ProgressTrackingService.java  # è¿›åº¦è·Ÿè¸ªæœåŠ¡
    â”‚   â”‚   â”‚   â””â”€â”€ repository/
    â”‚   â”‚   â”‚       â”œâ”€â”€ ProjectRepository.java
    â”‚   â”‚   â”‚       â”œâ”€â”€ ProjectMemberRepository.java
    â”‚   â”‚   â”‚       â””â”€â”€ ProjectProgressRepository.java
    â”‚   â”‚   â”œâ”€â”€ report/                               # æŠ¥å‘Šç®¡ç†é¢†åŸŸ
    â”‚   â”‚   â”‚   â”œâ”€â”€ aggregate/
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ReportManagement.java         # æŠ¥å‘Šèšåˆæ ¹
    â”‚   â”‚   â”‚   â”œâ”€â”€ entity/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ GenerationConfig.java         # ç”Ÿæˆé…ç½®å®ä½“
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ReportContent.java            # æŠ¥å‘Šå†…å®¹å®ä½“
    â”‚   â”‚   â”‚   â”œâ”€â”€ valueobject/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ReportNumber.java             # æŠ¥å‘Šç¼–å·
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ReportType.java               # æŠ¥å‘Šç±»å‹
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ GenerationStatus.java         # ç”ŸæˆçŠ¶æ€
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ReportStyle.java              # æŠ¥å‘Šé£æ ¼
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DetailLevel.java              # è¯¦ç»†ç¨‹åº¦
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProgressInfo.java             # ç”Ÿæˆè¿›åº¦
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ DifyTaskId.java               # Difyä»»åŠ¡ID
    â”‚   â”‚   â”‚   â”œâ”€â”€ service/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ReportDomainService.java      # æŠ¥å‘Šé¢†åŸŸæœåŠ¡
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ReportGenerationService.java  # æŠ¥å‘Šç”ŸæˆæœåŠ¡
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ReportExportService.java      # æŠ¥å‘Šå¯¼å‡ºæœåŠ¡
    â”‚   â”‚   â”‚   â””â”€â”€ repository/
    â”‚   â”‚   â”‚       â”œâ”€â”€ ReportManagementRepository.java
    â”‚   â”‚   â”‚       â”œâ”€â”€ GenerationConfigRepository.java
    â”‚   â”‚   â”‚       â””â”€â”€ ReportContentRepository.java
    â”‚   â”‚   â”œâ”€â”€ file/                                 # æ–‡ä»¶å­˜å‚¨é¢†åŸŸ
    â”‚   â”‚   â”‚   â”œâ”€â”€ aggregate/
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Attachment.java               # é™„ä»¶èšåˆæ ¹
    â”‚   â”‚   â”‚   â”œâ”€â”€ entity/
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ AttachmentRelation.java       # é™„ä»¶å…³è”å®ä½“
    â”‚   â”‚   â”‚   â”œâ”€â”€ valueobject/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FileName.java                 # æ–‡ä»¶åç§°
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FileMetadata.java             # æ–‡ä»¶å…ƒæ•°æ®
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FileType.java                 # æ–‡ä»¶ç±»å‹
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ StoragePath.java              # å­˜å‚¨è·¯å¾„
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MD5Hash.java                  # MD5å“ˆå¸Œå€¼
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RelationType.java             # å…³è”ç±»å‹
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AttachmentType.java           # é™„ä»¶ç±»å‹
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ DifyDocId.java                # Difyæ–‡æ¡£ID
    â”‚   â”‚   â”‚   â”œâ”€â”€ service/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FileStorageService.java       # æ–‡ä»¶å­˜å‚¨æœåŠ¡
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FileDeduplicationService.java # æ–‡ä»¶å»é‡æœåŠ¡
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FileSyncService.java          # æ–‡ä»¶åŒæ­¥æœåŠ¡
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ FileRelationService.java      # å…³è”ç®¡ç†æœåŠ¡
    â”‚   â”‚   â”‚   â””â”€â”€ repository/
    â”‚   â”‚   â”‚       â”œâ”€â”€ AttachmentRepository.java
    â”‚   â”‚   â”‚       â””â”€â”€ AttachmentRelationRepository.java
    â”‚   â”‚   â”œâ”€â”€ ai/                                   # AIåŠ©æ‰‹é¢†åŸŸï¼ˆè¾…åŠ©ï¼‰
    â”‚   â”‚   â”‚   â”œâ”€â”€ aggregate/
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Conversation.java             # å¯¹è¯èšåˆæ ¹
    â”‚   â”‚   â”‚   â”œâ”€â”€ entity/
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Message.java                  # æ¶ˆæ¯å®ä½“
    â”‚   â”‚   â”‚   â”œâ”€â”€ valueobject/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ConversationTitle.java        # ä¼šè¯æ ‡é¢˜
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MessageRole.java              # æ¶ˆæ¯è§’è‰²
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MessageContent.java           # æ¶ˆæ¯å†…å®¹
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MessageSource.java            # çŸ¥è¯†æ¥æº
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Confidence.java               # ç½®ä¿¡åº¦
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PinStatus.java                # ç½®é¡¶çŠ¶æ€
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ DifyConversationId.java       # Difyä¼šè¯ID
    â”‚   â”‚   â”‚   â”œâ”€â”€ service/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ConversationService.java      # å¯¹è¯ç®¡ç†æœåŠ¡
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AIChatService.java            # AIèŠå¤©æœåŠ¡
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ MessageService.java           # æ¶ˆæ¯æœåŠ¡
    â”‚   â”‚   â”‚   â””â”€â”€ repository/
    â”‚   â”‚   â”‚       â”œâ”€â”€ ConversationRepository.java
    â”‚   â”‚   â”‚       â””â”€â”€ MessageRepository.java
    â”‚   â”‚   â”œâ”€â”€ knowledge/                            # çŸ¥è¯†åº“é¢†åŸŸ
    â”‚   â”‚   â”‚   â”œâ”€â”€ aggregate/
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ KnowledgeBase.java            # çŸ¥è¯†åº“èšåˆæ ¹
    â”‚   â”‚   â”‚   â”œâ”€â”€ entity/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ KnowledgeFolder.java          # æ–‡ä»¶å¤¹å®ä½“
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ FileRelation.java             # æ–‡ä»¶å…³è”å®ä½“
    â”‚   â”‚   â”‚   â”œâ”€â”€ valueobject/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ KnowledgeStatus.java          # çŸ¥è¯†åº“çŠ¶æ€
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FolderPath.java               # æ–‡ä»¶å¤¹è·¯å¾„
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DifyKnowledgeId.java          # DifyçŸ¥è¯†åº“ID
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ShareStatus.java              # å…±äº«çŠ¶æ€
    â”‚   â”‚   â”‚   â”œâ”€â”€ service/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ KnowledgeManagementService.java # çŸ¥è¯†åº“ç®¡ç†æœåŠ¡
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FolderManagementService.java  # æ–‡ä»¶å¤¹ç®¡ç†æœåŠ¡
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ KnowledgeFileService.java     # æ–‡ä»¶ç®¡ç†æœåŠ¡
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ KnowledgeSearchService.java   # çŸ¥è¯†æ£€ç´¢æœåŠ¡
    â”‚   â”‚   â”‚   â””â”€â”€ repository/
    â”‚   â”‚   â”‚       â”œâ”€â”€ KnowledgeBaseRepository.java
    â”‚   â”‚   â”‚       â”œâ”€â”€ KnowledgeFolderRepository.java
    â”‚   â”‚   â”‚       â””â”€â”€ FileRelationRepository.java
    â”‚   â”‚   â”œâ”€â”€ config/                               # ç³»ç»Ÿé…ç½®é¢†åŸŸï¼ˆè¾…åŠ©ï¼‰
    â”‚   â”‚   â”‚   â”œâ”€â”€ aggregate/
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SystemConfig.java             # ç³»ç»Ÿé…ç½®èšåˆæ ¹
    â”‚   â”‚   â”‚   â”œâ”€â”€ valueobject/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ConfigKey.java                # é…ç½®é”®
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ConfigValue.java              # é…ç½®å€¼
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ConfigType.java               # é…ç½®ç±»å‹
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ EncryptionStatus.java         # æ˜¯å¦åŠ å¯†
    â”‚   â”‚   â”‚   â”œâ”€â”€ service/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SystemConfigService.java      # ç³»ç»Ÿé…ç½®æœåŠ¡
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ConfigValidationService.java  # é…ç½®éªŒè¯æœåŠ¡
    â”‚   â”‚   â”‚   â””â”€â”€ repository/
    â”‚   â”‚   â”‚       â””â”€â”€ SystemConfigRepository.java
    â”‚   â”‚   â””â”€â”€ shared/                               # å…±äº«é¢†åŸŸï¼ˆè·¨é¢†åŸŸï¼‰
    â”‚   â”‚       â”œâ”€â”€ valueobject/                      # å…±äº«å€¼å¯¹è±¡
    â”‚   â”‚       â”‚   â”œâ”€â”€ UserId.java
    â”‚   â”‚       â”‚   â”œâ”€â”€ ProjectId.java
    â”‚   â”‚       â”‚   â”œâ”€â”€ DeclarationId.java
    â”‚   â”‚       â”‚   â”œâ”€â”€ ReportId.java
    â”‚   â”‚       â”‚   â”œâ”€â”€ AttachmentId.java
    â”‚   â”‚       â”‚   â”œâ”€â”€ ConversationId.java
    â”‚   â”‚       â”‚   â”œâ”€â”€ KnowledgeBaseId.java
    â”‚   â”‚       â”‚   â”œâ”€â”€ DateRange.java
    â”‚   â”‚       â”‚   â””â”€â”€ AuditInfo.java                # å®¡è®¡ä¿¡æ¯
    â”‚   â”‚       â”œâ”€â”€ event/                            # é¢†åŸŸäº‹ä»¶
    â”‚   â”‚       â”‚   â”œâ”€â”€ DeclarationSubmittedEvent.java # ç”³æŠ¥æäº¤äº‹ä»¶
    â”‚   â”‚       â”‚   â”œâ”€â”€ DeclarationApprovedEvent.java  # ç”³æŠ¥é€šè¿‡äº‹ä»¶ï¼ˆè§¦å‘é¡¹ç›®åˆ›å»ºï¼‰
    â”‚   â”‚       â”‚   â”œâ”€â”€ ProjectCreatedEvent.java       # é¡¹ç›®åˆ›å»ºäº‹ä»¶
    â”‚   â”‚       â”‚   â”œâ”€â”€ ProjectCompletedEvent.java     # é¡¹ç›®å®Œæˆäº‹ä»¶
    â”‚   â”‚       â”‚   â”œâ”€â”€ FileUploadedEvent.java         # æ–‡ä»¶ä¸Šä¼ äº‹ä»¶
    â”‚   â”‚       â”‚   â”œâ”€â”€ FileSyncedEvent.java           # æ–‡ä»¶åŒæ­¥åˆ°Difyäº‹ä»¶
    â”‚   â”‚       â”‚   â”œâ”€â”€ ReportGenerationStartedEvent.java # æŠ¥å‘Šç”Ÿæˆå¼€å§‹äº‹ä»¶
    â”‚   â”‚       â”‚   â”œâ”€â”€ ReportGeneratedEvent.java      # æŠ¥å‘Šç”Ÿæˆå®Œæˆäº‹ä»¶
    â”‚   â”‚       â”‚   â””â”€â”€ KnowledgeBaseCreatedEvent.java # çŸ¥è¯†åº“åˆ›å»ºäº‹ä»¶
    â”‚   â”‚       â””â”€â”€ exception/                        # é¢†åŸŸå¼‚å¸¸
    â”‚   â”‚           â”œâ”€â”€ DomainException.java
    â”‚   â”‚           â”œâ”€â”€ UserNotFoundException.java
    â”‚   â”‚           â”œâ”€â”€ PermissionDeniedException.java
    â”‚   â”‚           â”œâ”€â”€ RoleNotFoundException.java
    â”‚   â”‚           â”œâ”€â”€ DepartmentNotFoundException.java
    â”‚   â”‚           â”œâ”€â”€ DeclarationNotFoundException.java
    â”‚   â”‚           â”œâ”€â”€ ProjectNotFoundException.java
    â”‚   â”‚           â”œâ”€â”€ ReportNotFoundException.java
    â”‚   â”‚           â”œâ”€â”€ FileNotFoundException.java
    â”‚   â”‚           â”œâ”€â”€ KnowledgeBaseNotFoundException.java
    â”‚   â”‚           â””â”€â”€ InvalidOperationException.java
    â”‚   â”‚
    â”‚   â”œâ”€â”€ infrastructure/                            # åŸºç¡€è®¾æ–½å±‚ï¼ˆæŠ€æœ¯å®ç°ï¼‰
    â”‚   â”‚   â”œâ”€â”€ config/                               # é…ç½®ç±»
    â”‚   â”‚   â”‚   â”œâ”€â”€ database/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DataSourceConfig.java         # æ•°æ®æºé…ç½®
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MyBatisPlusConfig.java        # MyBatis-Plus é…ç½®
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ TransactionConfig.java        # äº‹åŠ¡é…ç½®
    â”‚   â”‚   â”‚   â”œâ”€â”€ cache/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RedisConfig.java              # Redis é…ç½®
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ CacheConfig.java              # ç¼“å­˜é…ç½®
    â”‚   â”‚   â”‚   â”œâ”€â”€ mq/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ KafkaConfig.java              # Kafka é…ç½®
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ KafkaTopicConfig.java         # Kafka Topic é…ç½®
    â”‚   â”‚   â”‚   â”œâ”€â”€ security/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SaTokenConfig.java            # Sa-Token é…ç½®
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SecurityConfig.java           # å®‰å…¨é…ç½®
    â”‚   â”‚   â”‚   â”œâ”€â”€ storage/
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ MinioConfig.java              # Minio é…ç½®
    â”‚   â”‚   â”‚   â”œâ”€â”€ ai/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DifyConfig.java               # Dify é…ç½®
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ LangChain4jConfig.java        # LangChain4j é…ç½®
    â”‚   â”‚   â”‚   â”œâ”€â”€ web/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ WebMvcConfig.java             # Spring MVC é…ç½®
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CorsConfig.java               # è·¨åŸŸé…ç½®
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SwaggerConfig.java            # Swagger APIæ–‡æ¡£é…ç½®
    â”‚   â”‚   â”‚   â”œâ”€â”€ idempotent/                       # å¹‚ç­‰æ€§é…ç½®
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ IdempotentConfig.java         # å¹‚ç­‰æ€§é…ç½®
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ IdempotentInterceptor.java    # å¹‚ç­‰æ€§æ‹¦æˆªå™¨
    â”‚   â”‚   â”‚   â”œâ”€â”€ retry/                            # é‡è¯•æœºåˆ¶é…ç½®
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RetryConfig.java              # é‡è¯•ç­–ç•¥é…ç½®
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ CircuitBreakerConfig.java     # æ–­è·¯å™¨é…ç½®
    â”‚   â”‚   â”‚   â””â”€â”€ trace/                            # é“¾è·¯è¿½è¸ªé…ç½®
    â”‚   â”‚   â”‚       â”œâ”€â”€ TraceConfig.java              # TraceIdé…ç½®
    â”‚   â”‚   â”‚       â””â”€â”€ TraceIdFilter.java            # TraceIdè¿‡æ»¤å™¨
    â”‚   â”‚   â”œâ”€â”€ persistence/                          # æŒä¹…åŒ–å®ç°
    â”‚   â”‚   â”‚   â”œâ”€â”€ mapper/                           # MyBatis-Plus Mapper
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserMapper.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RoleMapper.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PermissionMapper.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserRoleMapper.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RolePermissionMapper.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ IndustryConfigMapper.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DepartmentMapper.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserProfileMapper.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LoginLogMapper.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DeclarationMapper.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ WorkflowTemplateMapper.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectMapper.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectMemberMapper.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectProgressMapper.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AttachmentMapper.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AttachmentRelationMapper.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ConversationMapper.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MessageMapper.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ KnowledgeBaseMapper.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ KnowledgeFolderMapper.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ KnowledgeFileRelationMapper.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ReportManagementMapper.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ReportGenerationConfigMapper.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ReportContentMapper.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ConfigMapper.java
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ OperationLogMapper.java
    â”‚   â”‚   â”‚   â”œâ”€â”€ po/                               # æŒä¹…åŒ–å¯¹è±¡ï¼ˆæ•°æ®åº“å®ä½“ï¼‰
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserPO.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RolePO.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PermissionPO.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserRolePO.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RolePermissionPO.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ IndustryConfigPO.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DepartmentPO.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserProfilePO.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LoginLogPO.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DeclarationPO.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ WorkflowTemplatePO.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectPO.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectMemberPO.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectProgressPO.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AttachmentPO.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AttachmentRelationPO.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ConversationPO.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MessagePO.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ KnowledgeBasePO.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ KnowledgeFolderPO.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ KnowledgeFileRelationPO.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ReportManagementPO.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ReportGenerationConfigPO.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ReportContentPO.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ConfigPO.java
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ OperationLogPO.java
    â”‚   â”‚   â”‚   â”œâ”€â”€ converter/                        # è½¬æ¢å™¨ï¼ˆPO <-> Domainï¼‰
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserConverter.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DeclarationConverter.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectConverter.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ReportConverter.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ KnowledgeConverter.java
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ AIConverter.java
    â”‚   â”‚   â”‚   â””â”€â”€ repository/                       # ä»“å‚¨å®ç°
    â”‚   â”‚   â”‚       â”œâ”€â”€ UserRepositoryImpl.java
    â”‚   â”‚   â”‚       â”œâ”€â”€ RoleRepositoryImpl.java
    â”‚   â”‚   â”‚       â”œâ”€â”€ PermissionRepositoryImpl.java
    â”‚   â”‚   â”‚       â”œâ”€â”€ IndustryConfigRepositoryImpl.java
    â”‚   â”‚   â”‚       â”œâ”€â”€ DepartmentRepositoryImpl.java
    â”‚   â”‚   â”‚       â”œâ”€â”€ DeclarationRepositoryImpl.java
    â”‚   â”‚   â”‚       â”œâ”€â”€ ProjectRepositoryImpl.java
    â”‚   â”‚   â”‚       â”œâ”€â”€ ProjectMemberRepositoryImpl.java
    â”‚   â”‚   â”‚       â”œâ”€â”€ ProjectDocumentRepositoryImpl.java
    â”‚   â”‚   â”‚       â”œâ”€â”€ AcceptanceRepositoryImpl.java
    â”‚   â”‚   â”‚       â”œâ”€â”€ ReportRepositoryImpl.java
    â”‚   â”‚   â”‚       â”œâ”€â”€ ReportManagementRepositoryImpl.java
    â”‚   â”‚   â”‚       â”œâ”€â”€ ConversationRepositoryImpl.java
    â”‚   â”‚   â”‚       â”œâ”€â”€ MessageRepositoryImpl.java
    â”‚   â”‚   â”‚       â”œâ”€â”€ KnowledgeBaseRepositoryImpl.java
    â”‚   â”‚   â”‚       â”œâ”€â”€ AttachmentRepositoryImpl.java
    â”‚   â”‚   â”‚       â””â”€â”€ FileRepositoryImpl.java
    â”‚   â”‚   â”œâ”€â”€ external/                          # å¤–éƒ¨ç³»ç»Ÿé›†æˆ
    â”‚   â”‚   â”‚   â”œâ”€â”€ dify/                             # Dify é›†æˆ
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DifyClient.java               # Dify å®¢æˆ·ç«¯
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DifyWorkflowClient.java       # å·¥ä½œæµå®¢æˆ·ç«¯
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DifyKnowledgeBaseClient.java  # çŸ¥è¯†åº“å®¢æˆ·ç«¯
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ dto/                          # Dify DTO
    â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ WorkflowRequest.java
    â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ WorkflowResponse.java
    â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ KnowledgeBaseRequest.java
    â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ KnowledgeBaseResponse.java
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ adapter/                      # Dify é€‚é…å™¨
    â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ DeclarationWorkflowAdapter.java
    â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ ReportWorkflowAdapter.java
    â”‚   â”‚   â”‚   â”‚       â””â”€â”€ KnowledgeBaseAdapter.java
    â”‚   â”‚   â”‚   â”œâ”€â”€ minio/                            # Minio é›†æˆ
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MinioClient.java              # Minio å®¢æˆ·ç«¯
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MinioStorageService.java      # å­˜å‚¨æœåŠ¡å®ç°
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ dto/
    â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ UploadRequest.java
    â”‚   â”‚   â”‚   â”‚       â””â”€â”€ UploadResponse.java
    â”‚   â”‚   â”‚   â””â”€â”€ kafka/                            # Kafka é›†æˆ
    â”‚   â”‚   â”‚       â”œâ”€â”€ producer/                     # ç”Ÿäº§è€…
    â”‚   â”‚   â”‚       â”‚   â””â”€â”€ EventProducer.java
    â”‚   â”‚   â”‚       â””â”€â”€ consumer/                     # æ¶ˆè´¹è€…
    â”‚   â”‚   â”‚           â”œâ”€â”€ DeclarationEventConsumer.java
    â”‚   â”‚   â”‚           â”œâ”€â”€ DocumentEventConsumer.java
    â”‚   â”‚   â”‚           â””â”€â”€ ReportEventConsumer.java
    â”‚   â”‚   â””â”€â”€ common/                               # åŸºç¡€è®¾æ–½å…¬å…±ç»„ä»¶
    â”‚   â”‚       â”œâ”€â”€ annotation/                       # è‡ªå®šä¹‰æ³¨è§£
    â”‚   â”‚       â”‚   â”œâ”€â”€ Idempotent.java               # å¹‚ç­‰æ€§æ³¨è§£
    â”‚   â”‚       â”‚   â”œâ”€â”€ Retry.java                    # é‡è¯•æ³¨è§£
    â”‚   â”‚       â”‚   â”œâ”€â”€ TraceLog.java                 # é“¾è·¯è¿½è¸ªæ—¥å¿—æ³¨è§£
    â”‚   â”‚       â”‚   â””â”€â”€ ApiVersion.java               # APIç‰ˆæœ¬æ³¨è§£
    â”‚   â”‚       â”œâ”€â”€ aspect/                           # AOP åˆ‡é¢
    â”‚   â”‚       â”‚   â”œâ”€â”€ LogAspect.java                # æ—¥å¿—åˆ‡é¢ï¼ˆå«TraceIdï¼‰
    â”‚   â”‚       â”‚   â”œâ”€â”€ PermissionAspect.java         # æƒé™åˆ‡é¢
    â”‚   â”‚       â”‚   â”œâ”€â”€ TransactionAspect.java        # äº‹åŠ¡åˆ‡é¢
    â”‚   â”‚       â”‚   â”œâ”€â”€ IdempotentAspect.java         # å¹‚ç­‰æ€§åˆ‡é¢
    â”‚   â”‚       â”‚   â””â”€â”€ RetryAspect.java              # é‡è¯•åˆ‡é¢
    â”‚   â”‚       â”œâ”€â”€ interceptor/                      # æ‹¦æˆªå™¨
    â”‚   â”‚       â”‚   â”œâ”€â”€ AuthInterceptor.java          # è®¤è¯æ‹¦æˆªå™¨
    â”‚   â”‚       â”‚   â”œâ”€â”€ RateLimitInterceptor.java     # é™æµæ‹¦æˆªå™¨
    â”‚   â”‚       â”‚   â”œâ”€â”€ IdempotentInterceptor.java    # å¹‚ç­‰æ€§æ‹¦æˆªå™¨
    â”‚   â”‚       â”‚   â””â”€â”€ TraceIdInterceptor.java       # TraceIdæ‹¦æˆªå™¨
    â”‚   â”‚       â”œâ”€â”€ filter/                           # è¿‡æ»¤å™¨
    â”‚   â”‚       â”‚   â”œâ”€â”€ AuthFilter.java               # è®¤è¯è¿‡æ»¤å™¨
    â”‚   â”‚       â”‚   â”œâ”€â”€ CorsFilter.java               # è·¨åŸŸè¿‡æ»¤å™¨
    â”‚   â”‚       â”‚   â””â”€â”€ TraceIdFilter.java            # TraceIdè¿‡æ»¤å™¨ï¼ˆè¯·æ±‚å…¥å£ï¼‰
    â”‚   â”‚       â””â”€â”€ handler/                          # å¤„ç†å™¨
    â”‚   â”‚           â”œâ”€â”€ GlobalExceptionHandler.java   # å…¨å±€å¼‚å¸¸å¤„ç†å™¨
    â”‚   â”‚           â”œâ”€â”€ ResponseHandler.java          # å“åº”å¤„ç†å™¨
    â”‚   â”‚           â””â”€â”€ RetryHandler.java             # é‡è¯•å¤„ç†å™¨
    â”‚   â”‚
    â”‚   â””â”€â”€ shared/                                    # å…±äº«å†…æ ¸ï¼ˆè·¨å±‚å…±äº«ï¼‰
    â”‚       â”œâ”€â”€ result/                               # ç»Ÿä¸€è¿”å›ç»“æœ
    â”‚       â”‚   â”œâ”€â”€ Result.java                       # ç»Ÿä¸€ç»“æœç±»
    â”‚       â”‚   â”œâ”€â”€ PageResult.java                   # åˆ†é¡µç»“æœç±»
    â”‚       â”‚   â””â”€â”€ ResultCode.java                   # ç»“æœç æšä¸¾
    â”‚       â”œâ”€â”€ exception/                            # å…¨å±€å¼‚å¸¸
    â”‚       â”‚   â”œâ”€â”€ BusinessException.java            # ä¸šåŠ¡å¼‚å¸¸
    â”‚       â”‚   â”œâ”€â”€ SystemException.java              # ç³»ç»Ÿå¼‚å¸¸
    â”‚       â”‚   â””â”€â”€ ExceptionCode.java                # å¼‚å¸¸ç æšä¸¾
    â”‚       â”œâ”€â”€ constant/                             # å¸¸é‡å®šä¹‰
    â”‚       â”‚   â”œâ”€â”€ SystemConstants.java              # ç³»ç»Ÿå¸¸é‡
    â”‚       â”‚   â”œâ”€â”€ CacheConstants.java               # ç¼“å­˜å¸¸é‡
    â”‚       â”‚   â””â”€â”€ KafkaTopicConstants.java          # Kafka Topic å¸¸é‡
    â”‚       â”œâ”€â”€ enums/                                # æšä¸¾å®šä¹‰
    â”‚       â”‚   â”œâ”€â”€ UserStatus.java                   # ç”¨æˆ·çŠ¶æ€
    â”‚       â”‚   â”œâ”€â”€ DeclarationStatus.java            # ç”³æŠ¥çŠ¶æ€
    â”‚       â”‚   â”œâ”€â”€ ProjectStatus.java                # é¡¹ç›®çŠ¶æ€
    â”‚       â”‚   â”œâ”€â”€ AcceptanceStatus.java             # éªŒæ”¶çŠ¶æ€
    â”‚       â”‚   â””â”€â”€ ReportType.java                   # æŠ¥å‘Šç±»å‹
    â”‚       â””â”€â”€ util/                                 # å·¥å…·ç±»
    â”‚           â”œâ”€â”€ JsonUtil.java                     # JSON å·¥å…·
    â”‚           â”œâ”€â”€ DateUtil.java                     # æ—¥æœŸå·¥å…·
    â”‚           â”œâ”€â”€ StringUtil.java                   # å­—ç¬¦ä¸²å·¥å…·
    â”‚           â”œâ”€â”€ EncryptUtil.java                  # åŠ å¯†å·¥å…·
    â”‚           â”œâ”€â”€ IdGenerator.java                  # ID ç”Ÿæˆå™¨
    â”‚           â”œâ”€â”€ TraceIdUtil.java                  # TraceId å·¥å…·
    â”‚           â”œâ”€â”€ IdempotentUtil.java               # å¹‚ç­‰æ€§å·¥å…·
    â”‚           â””â”€â”€ RetryUtil.java                    # é‡è¯•å·¥å…·
    â”‚
    â””â”€â”€ resources/
        â”œâ”€â”€ application.yml                            # ä¸»é…ç½®æ–‡ä»¶
        â”œâ”€â”€ application-dev.yml                        # å¼€å‘ç¯å¢ƒé…ç½®
        â”œâ”€â”€ application-test.yml                       # æµ‹è¯•ç¯å¢ƒé…ç½®
        â”œâ”€â”€ application-prod.yml                       # ç”Ÿäº§ç¯å¢ƒé…ç½®
        â”œâ”€â”€ mapper/                                    # MyBatis XML æ˜ å°„æ–‡ä»¶
        â”‚   â”œâ”€â”€ UserMapper.xml
        â”‚   â”œâ”€â”€ RoleMapper.xml
        â”‚   â”œâ”€â”€ PermissionMapper.xml
        â”‚   â”œâ”€â”€ IndustryConfigMapper.xml
        â”‚   â”œâ”€â”€ DepartmentMapper.xml
        â”‚   â”œâ”€â”€ DeclarationMapper.xml
        â”‚   â”œâ”€â”€ ProjectMapper.xml
        â”‚   â”œâ”€â”€ AcceptanceMapper.xml
        â”‚   â”œâ”€â”€ ReportManagementMapper.xml
        â”‚   â”œâ”€â”€ ConversationMapper.xml
        â”‚   â”œâ”€â”€ MessageMapper.xml
        â”‚   â”œâ”€â”€ KnowledgeBaseMapper.xml
        â”‚   â””â”€â”€ AttachmentMapper.xml
        â”œâ”€â”€ db/                                        # æ•°æ®åº“è„šæœ¬
        â”‚   â”œâ”€â”€ migration/                            # æ•°æ®åº“è¿ç§»è„šæœ¬
        â”‚   â”‚   â”œâ”€â”€ V1__init_all_tables.sql
        â”‚   â””â”€â”€ seed/                                 # åˆå§‹æ•°æ®
        â”‚       â””â”€â”€ init_data.sql
        â”œâ”€â”€ logback-spring.xml                         # æ—¥å¿—é…ç½®
        â””â”€â”€ static/                                    # é™æ€èµ„æº
```

## ğŸ“‹ æ ¸å¿ƒæ¦‚å¿µè§£é‡Š

### 1. **Domain å±‚å¯¹è±¡æ¨¡å‹ï¼ˆPOJOï¼‰**

#### **Entityï¼ˆé¢†åŸŸå®ä½“ï¼‰**

- **å®šä¹‰**ï¼šå…·æœ‰å”¯ä¸€æ ‡è¯†çš„ä¸šåŠ¡å¯¹è±¡ï¼ŒåŒ…å«ä¸šåŠ¡é€»è¾‘
- **ç‰¹ç‚¹**ï¼šæœ‰ IDï¼Œæœ‰ç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…å«ä¸šåŠ¡è§„åˆ™
- **ç¤ºä¾‹**ï¼šUserã€Projectã€Declaration ç­‰

#### **DTOï¼ˆæ•°æ®ä¼ è¾“å¯¹è±¡ï¼‰**

- **å®šä¹‰**ï¼šç”¨äºä¸åŒå±‚ä¹‹é—´ä¼ è¾“æ•°æ®çš„å¯¹è±¡
- **ç‰¹ç‚¹**ï¼šæ— ä¸šåŠ¡é€»è¾‘ï¼Œçº¯æ•°æ®ä¼ è¾“
- **åˆ†ç±»**ï¼š
  - **Request DTO**ï¼šæ¥æ”¶å¤–éƒ¨è¯·æ±‚æ•°æ®
  - **Response DTO**ï¼šè¿”å›ç»™å¤–éƒ¨å“åº”æ•°æ®

### 2. **Mapper vs Repository åŒºåˆ«**

#### **Mapperï¼ˆæ•°æ®æ˜ å°„æ¥å£ï¼‰**

- **èŒè´£**ï¼šå®šä¹‰æ•°æ®åº“æ“ä½œæ¥å£
- **ç‰¹ç‚¹**ï¼šMyBatis æ¡†æ¶ï¼Œç›´æ¥æ“ä½œæ•°æ®åº“
- **ä½œç”¨**ï¼šCRUD æ“ä½œï¼ŒSQL æ˜ å°„
- **ç¤ºä¾‹**ï¼š

```java
@Mapper
public interface UserMapper {
    User selectById(Long id);
    int insert(User user);
    int update(User user);
    int deleteById(Long id);
}
```

#### **Repositoryï¼ˆä»“å‚¨æ¥å£ï¼‰**

- **èŒè´£**ï¼šå®šä¹‰é¢†åŸŸæ•°æ®è®¿é—®æ¥å£
- **ç‰¹ç‚¹**ï¼šé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼Œä¸šåŠ¡å¯¼å‘
- **ä½œç”¨**ï¼šèšåˆæ ¹ç®¡ç†ï¼Œä¸šåŠ¡æŸ¥è¯¢
- **ç¤ºä¾‹**ï¼š

```java
public interface UserRepository {
    User findById(UserId id);
    User findByUsername(Username username);
    void save(User user);
    void remove(User user);
}
```
#### **å…³ç³»è¯´æ˜**

- **Mapper**ï¼šæŠ€æœ¯å®ç°å±‚ï¼Œå…³æ³¨æ•°æ®æ“ä½œ
- **Repository**ï¼šä¸šåŠ¡æŠ½è±¡å±‚ï¼Œå…³æ³¨é¢†åŸŸæ¦‚å¿µ
- **Repository å®ç°**ï¼šåœ¨ Infrastructure å±‚å®ç°ï¼Œå†…éƒ¨è°ƒç”¨ Mapper

### 3. **Application Service å®ç°ç±»åˆ’åˆ†**

#### **æ¥å£ä¸å®ç°åˆ†ç¦»**

- **Service æ¥å£**ï¼šå®šä¹‰ä¸šåŠ¡å¥‘çº¦
- **ServiceImpl å®ç°**ï¼šå…·ä½“ä¸šåŠ¡é€»è¾‘å®ç°

#### **å®ç°ç±»èŒè´£**

- **ä¸šåŠ¡ç¼–æ’**ï¼šåè°ƒå¤šä¸ª Domain æœåŠ¡
- **äº‹åŠ¡ç®¡ç†**ï¼šä½¿ç”¨@Transactional
- **äº‹ä»¶å‘å¸ƒ**ï¼šå‘å¸ƒé¢†åŸŸäº‹ä»¶
- **å¤–éƒ¨è°ƒç”¨**ï¼šè°ƒç”¨å¤–éƒ¨æœåŠ¡

## ğŸ”„ æ¨¡å—äº¤äº’æµç¨‹è¯¦è§£

### 1. **Interfaces å±‚ï¼ˆå¯¹å¤–æ¥å£ï¼‰**

**èŒè´£**ï¼šå¤„ç† HTTP è¯·æ±‚ï¼Œå‚æ•°æ ¡éªŒï¼Œæ•°æ®è½¬æ¢

**å·¥ä½œæµç¨‹**ï¼š

1. **æ¥æ”¶è¯·æ±‚**ï¼šController æ¥æ”¶ HTTP è¯·æ±‚
2. **å‚æ•°æ ¡éªŒ**ï¼šä½¿ç”¨@Valid æ³¨è§£è¿›è¡Œå‚æ•°éªŒè¯
3. **æ•°æ®è½¬æ¢**ï¼šä½¿ç”¨ Converter å°† DTO è½¬æ¢ä¸ºé¢†åŸŸå¯¹è±¡
4. **è°ƒç”¨æœåŠ¡**ï¼šè°ƒç”¨ Application å±‚çš„æœåŠ¡
5. **ç»“æœè½¬æ¢**ï¼šå°†é¢†åŸŸå¯¹è±¡è½¬æ¢ä¸º DTO è¿”å›

**å…³é”®ç»„ä»¶**ï¼š

- **Controller**ï¼šæŒ‰ä¸šåŠ¡æ¨¡å—åˆ†ç±»çš„ REST æ§åˆ¶å™¨
- **Converter**ï¼šDTO ä¸é¢†åŸŸå¯¹è±¡ä¹‹é—´çš„è½¬æ¢å™¨

### 2. **Application å±‚ï¼ˆä¸šåŠ¡ç¼–æ’ï¼‰**

**èŒè´£**ï¼šç¼–æ’ä¸šåŠ¡ç”¨ä¾‹ï¼Œäº‹åŠ¡ç®¡ç†ï¼Œè·¨èšåˆåè°ƒ

**å·¥ä½œæµç¨‹**ï¼š

1. **æ¥æ”¶è°ƒç”¨**ï¼šæ¥æ”¶æ¥è‡ª Interfaces å±‚çš„è°ƒç”¨
2. **ä¸šåŠ¡ç¼–æ’**ï¼šåè°ƒå¤šä¸ª Domain å±‚çš„æœåŠ¡
3. **äº‹åŠ¡ç®¡ç†**ï¼šä½¿ç”¨@Transactional ç®¡ç†äº‹åŠ¡è¾¹ç•Œ
4. **äº‹ä»¶å‘å¸ƒ**ï¼šå‘å¸ƒé¢†åŸŸäº‹ä»¶
5. **ç»“æœè¿”å›**ï¼šå°†å¤„ç†ç»“æœè¿”å›ç»™ Interfaces å±‚

**å…³é”®ç»„ä»¶**ï¼š

- **Service æ¥å£**ï¼šå®šä¹‰ä¸šåŠ¡å¥‘çº¦
- **ServiceImpl å®ç°**ï¼šå…·ä½“ä¸šåŠ¡é€»è¾‘å®ç°
- **Task**ï¼šä»»åŠ¡è°ƒåº¦ï¼ˆå®šæ—¶ä»»åŠ¡ã€å¼‚æ­¥ä»»åŠ¡ã€å·¥ä½œæµä»»åŠ¡ï¼‰

### 3. **Domain å±‚ï¼ˆæ ¸å¿ƒä¸šåŠ¡ï¼‰**

**èŒè´£**ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œä¸šåŠ¡è§„åˆ™ï¼Œé¢†åŸŸæ¨¡å‹

**å·¥ä½œæµç¨‹**ï¼š

1. **æ¥æ”¶è°ƒç”¨**ï¼šæ¥æ”¶æ¥è‡ª Application å±‚çš„è°ƒç”¨
2. **ä¸šåŠ¡éªŒè¯**ï¼šæ‰§è¡Œä¸šåŠ¡è§„åˆ™éªŒè¯
3. **çŠ¶æ€å˜æ›´**ï¼šä¿®æ”¹å®ä½“çŠ¶æ€
4. **äº‹ä»¶å‘å¸ƒ**ï¼šå‘å¸ƒé¢†åŸŸäº‹ä»¶
5. **æ•°æ®æŒä¹…åŒ–**ï¼šé€šè¿‡ Repository æ¥å£ä¿å­˜æ•°æ®

**å…³é”®ç»„ä»¶**ï¼š

- **Entity**ï¼šé¢†åŸŸå®ä½“ï¼ŒåŒ…å«ä¸šåŠ¡é€»è¾‘
- **DTO**ï¼šæ•°æ®ä¼ è¾“å¯¹è±¡
- **Mapper**ï¼šæ•°æ®æ˜ å°„æ¥å£
- **Repository**ï¼šä»“å‚¨æ¥å£ï¼Œå®šä¹‰æ•°æ®è®¿é—®å¥‘çº¦

### 4. **Infrastructure å±‚ï¼ˆæŠ€æœ¯å®ç°ï¼‰**

**èŒè´£**ï¼šæŠ€æœ¯å®ç°ï¼Œå¤–éƒ¨é›†æˆï¼Œæ•°æ®æŒä¹…åŒ–

**å·¥ä½œæµç¨‹**ï¼š

1. **å®ç°æ¥å£**ï¼šå®ç° Domain å±‚å®šä¹‰çš„ Repository æ¥å£
2. **æ•°æ®æŒä¹…åŒ–**ï¼šé€šè¿‡ MyBatis è¿›è¡Œæ•°æ®åº“æ“ä½œ
3. **å¤–éƒ¨é›†æˆ**ï¼šé›†æˆ Difyã€MinIOã€Kafka ç­‰å¤–éƒ¨æœåŠ¡
4. **äº‹ä»¶å¤„ç†**ï¼šå¤„ç†é¢†åŸŸäº‹ä»¶ï¼Œè°ƒç”¨å¤–éƒ¨æœåŠ¡
5. **ç¼“å­˜ç®¡ç†**ï¼šé€šè¿‡ Redis è¿›è¡Œç¼“å­˜æ“ä½œ

**å…³é”®ç»„ä»¶**ï¼š

- **Config**ï¼šé…ç½®ç±»ï¼ˆdatabaseã€cacheã€mqã€securityã€storageã€aiã€webã€idempotentã€retryã€traceï¼‰
- **External**ï¼šå¤–éƒ¨æœåŠ¡é›†æˆï¼ˆdifyã€minioã€kafkaã€redisï¼‰
- **Common**ï¼šé€šç”¨ç»„ä»¶ï¼ˆannotationã€interceptorã€aspectã€handlerã€filterï¼‰
- **Shared**ï¼šå…±äº«ç»„ä»¶ï¼ˆresultã€exceptionã€eventã€constantã€enumsã€utilsï¼‰

## ğŸ¯ æ¶æ„ç‰¹è‰²ä¼˜åŠ¿

### âœ… **æ™ºèƒ½åŒ–ç‰¹è‰²**

- **AI å·¥ä½œæµé›†æˆ**ï¼šæ·±åº¦é›†æˆ Dify å¹³å°
- **æ™ºèƒ½çŸ¥è¯†åº“**ï¼šæ”¯æŒè¯­ä¹‰æœç´¢å’Œ AI é—®ç­”
- **æ™ºèƒ½æŠ¥å‘Šç”Ÿæˆ**ï¼šåŸºäº AI çš„è‡ªåŠ¨åŒ–æŠ¥å‘Šç”Ÿæˆ
- **æ™ºèƒ½æœç´¢**ï¼šæ”¯æŒå‘é‡åŒ–æœç´¢å’Œè¯­ä¹‰ç†è§£

### âœ… **ç§‘ç ”é¢†åŸŸç‰¹è‰²**

- **é¡¹ç›®å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šä»ç”³æŠ¥åˆ°éªŒæ”¶çš„å®Œæ•´æµç¨‹
- **å¤šè§’è‰²æƒé™ç®¡ç†**ï¼šæ”¯æŒä¸åŒè§’è‰²çš„æƒé™æ§åˆ¶
- **è¡Œä¸šé…ç½®åŒ–**ï¼šæ”¯æŒä¸åŒè¡Œä¸šçš„åŠ¨æ€å­—æ®µé…ç½®
- **å·¥ä½œæµè‡ªåŠ¨åŒ–**ï¼šåŸºäº Dify çš„æ™ºèƒ½å·¥ä½œæµç¼–æ’

### âœ… **æŠ€æœ¯æ¶æ„ä¼˜åŠ¿**

- **è´´è¿‘å®é™…å¼€å‘**ï¼šé¿å…è¿‡åº¦ç†è®ºåŒ–çš„ DDD æ¦‚å¿µ
- **å­¦ä¹ æˆæœ¬ä½**ï¼šç›®å½•ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç†è§£
- **å¼€å‘æ•ˆç‡é«˜**ï¼šä½¿ç”¨å·¥å…·è‡ªåŠ¨ç”Ÿæˆï¼Œå‡å°‘é‡å¤ä»£ç 
- **ç»´æŠ¤ç®€å•**ï¼šç»Ÿä¸€å¤„ç†é€šç”¨é€»è¾‘ï¼Œå…±äº«ç»„ä»¶

### âœ… **ä¸šåŠ¡å¯¼å‘**

- **ç§‘ç ”é¡¹ç›®ç®¡ç†**ï¼šçªå‡ºç§‘ç ”é¢†åŸŸçš„ä¸šåŠ¡ç‰¹ç‚¹
- **AI é›†æˆ**ï¼šæ·±åº¦é›†æˆ Dify å¹³å°ï¼Œæ”¯æŒæ™ºèƒ½å·¥ä½œæµ
- **çŸ¥è¯†åº“ç®¡ç†**ï¼šæ”¯æŒçŸ¥è¯†åº“çš„åˆ›å»ºã€ç®¡ç†å’Œæœç´¢
- **å¤šè§’è‰²æƒé™**ï¼šæ”¯æŒä¸åŒè§’è‰²çš„æƒé™æ§åˆ¶

### âœ… **æŠ€æœ¯æ¶æ„**

- **åˆ†å±‚æ¸…æ™°**ï¼šå››å±‚æ¶æ„ï¼ŒèŒè´£åˆ†æ˜
- **ä¾èµ–å€’ç½®**ï¼šDomain å±‚ä¸ä¾èµ– Infrastructure å±‚
- **äº‹ä»¶é©±åŠ¨**ï¼šä½¿ç”¨äº‹ä»¶è§£è€¦ä¸šåŠ¡é€»è¾‘
- **ç»Ÿä¸€å¤„ç†**ï¼šå¼‚å¸¸ã€äº‹ä»¶ã€è½¬æ¢ç­‰ç»Ÿä¸€å¤„ç†

## ğŸ“‹ å®æ–½å»ºè®®

### 1. **æ¸è¿›å¼å®æ–½**

- **ç¬¬ä¸€é˜¶æ®µ**ï¼šå®ç°æ ¸å¿ƒé¢†åŸŸï¼ˆuserã€projectï¼‰
- **ç¬¬äºŒé˜¶æ®µ**ï¼šæ·»åŠ ç”³æŠ¥å’ŒæŠ¥å‘ŠåŠŸèƒ½
- **ç¬¬ä¸‰é˜¶æ®µ**ï¼šé›†æˆçŸ¥è¯†åº“å’Œ AI åŠŸèƒ½
- **ç¬¬å››é˜¶æ®µ**ï¼šä¼˜åŒ–æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒ

### 2. **å›¢é˜ŸåŸ¹è®­**

- **DDD æ ¸å¿ƒæ¦‚å¿µ**ï¼šé‡ç‚¹è®²è§£èšåˆæ ¹ã€å®ä½“ã€å€¼å¯¹è±¡
- **æ¶æ„è®¾è®¡åŸåˆ™**ï¼šè®²è§£åˆ†å±‚æ¶æ„å’Œä¾èµ–å€’ç½®
- **å¼€å‘è§„èŒƒ**ï¼šå»ºç«‹ä»£ç è§„èŒƒå’Œå‘½åçº¦å®š
- **å·¥å…·ä½¿ç”¨**ï¼šåŸ¹è®­ MapStructã€MyBatis ç­‰å·¥å…·ä½¿ç”¨

### 3. **å·¥å…·æ”¯æŒ**

- **ä»£ç ç”Ÿæˆ**ï¼šä½¿ç”¨ MapStruct è‡ªåŠ¨ç”Ÿæˆè½¬æ¢å™¨
- **æ•°æ®åº“ç®¡ç†**ï¼šä½¿ç”¨ Flyway è¿›è¡Œæ•°æ®åº“ç‰ˆæœ¬ç®¡ç†
- **API æ–‡æ¡£**ï¼šä½¿ç”¨ Swagger ç”Ÿæˆ API æ–‡æ¡£
- **ç›‘æ§å‘Šè­¦**ï¼šé›†æˆç›‘æ§å’Œæ—¥å¿—ç³»ç»Ÿ

## ğŸ† æ€»ç»“

è¿™ä¸ª Sci-Z ç§‘ç ”å¹³å°çš„ DDD æ¶æ„è®¾è®¡å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

### ğŸ¯ **æ™ºèƒ½åŒ–ç‰¹è‰²**

- æ·±åº¦é›†æˆ AI å·¥ä½œæµå’ŒçŸ¥è¯†åº“ç®¡ç†
- æ”¯æŒæ™ºèƒ½æœç´¢å’Œè‡ªåŠ¨åŒ–æŠ¥å‘Šç”Ÿæˆ
- çªå‡ºç§‘ç ”é¢†åŸŸçš„ä¸šåŠ¡ç‰¹ç‚¹

### ğŸ—ï¸ **æ¶æ„ä¼˜åŠ¿**

- æ—¢ä¿æŒ DDD æ ¸å¿ƒæ€æƒ³ï¼Œåˆé™ä½å¤æ‚åº¦
- é€‚åˆå•ä½“åº”ç”¨å’Œåˆä¸­çº§å›¢é˜Ÿ
- æ”¯æŒæœªæ¥æ‰©å±•ä¸ºå¾®æœåŠ¡æ¶æ„

### ğŸš€ **å®æ–½ä»·å€¼**

- **å¿«é€Ÿå¼€å‘**ï¼šç®€åŒ–å®ç°ï¼Œä¸“æ³¨ä¸šåŠ¡é€»è¾‘
- **æ˜“äºç»´æŠ¤**ï¼šç»Ÿä¸€å¤„ç†ï¼Œå‡å°‘é‡å¤ä»£ç 
- **å›¢é˜Ÿå‹å¥½**ï¼šé™ä½å­¦ä¹ æˆæœ¬ï¼Œæé«˜å¼€å‘æ•ˆç‡

é€šè¿‡è¿™ç§è®¾è®¡ï¼Œå›¢é˜Ÿå¯ä»¥æ›´å¥½åœ°ç†è§£ DDD æ€æƒ³ï¼ŒåŒæ—¶æ„å»ºå‡ºå…·æœ‰é²œæ˜ç‰¹è‰²çš„æ™ºèƒ½åŒ–ç§‘ç ”é¡¹ç›®ç®¡ç†å¹³å°ï¼

## ğŸš€ å®Œæ•´ç™»å½•ç¤ºä¾‹ - è¦†ç›–æ‰€æœ‰ç›®å½•ç»“æ„

### ğŸ“‹ ç™»å½•ä¸šåŠ¡æµç¨‹

```mermaid
sequenceDiagram
    participant Client as å®¢æˆ·ç«¯
    participant Controller as AuthController
    participant Converter as UserConverter
    participant Service as AuthService
    participant Entity as User
    participant Repository as UserRepository
    participant Mapper as UserMapper
    participant Database as æ•°æ®åº“
    participant Cache as Redisç¼“å­˜
    participant Event as äº‹ä»¶ç³»ç»Ÿ

    Client->>Controller: POST /api/auth/login
    Controller->>Converter: è½¬æ¢LoginRequestä¸ºUser
    Converter->>Service: è°ƒç”¨AuthService.login()
    Service->>Repository: æŸ¥æ‰¾ç”¨æˆ·
    Repository->>Mapper: æŸ¥è¯¢æ•°æ®åº“
    Mapper->>Database: æ‰§è¡ŒSQL
    Database-->>Mapper: è¿”å›ç”¨æˆ·æ•°æ®
    Mapper-->>Repository: è¿”å›UserPO
    Repository-->>Service: è¿”å›Userå®ä½“
    Service->>Entity: éªŒè¯å¯†ç 
    Entity->>Service: éªŒè¯ç»“æœ
    Service->>Cache: ç¼“å­˜ç”¨æˆ·ä¿¡æ¯
    Service->>Event: å‘å¸ƒç™»å½•äº‹ä»¶
    Service-->>Converter: è¿”å›Userå®ä½“
    Converter-->>Controller: è¿”å›LoginResponse
    Controller-->>Client: è¿”å›ç™»å½•ç»“æœ
```

### ğŸ”§ å…·ä½“ä»£ç å®ç°

#### 1. **Interfaces å±‚ - å¯¹å¤–æ¥å£**

##### **Controllerï¼ˆæ§åˆ¶å™¨ï¼‰**

```java
// interfaces/controller/AuthController.java
@RestController
@RequestMapping("/api/auth")
@Slf4j
public class AuthController {

    @Autowired
    private AuthService authService;

    @Autowired
    private UserConverter userConverter;

    @PostMapping("/login")
    public Result<LoginResp> login(@Valid @RequestBody LoginReq request) {
        log.info("ç”¨æˆ·ç™»å½•è¯·æ±‚: {}", request.getUsername());

        // 1. è½¬æ¢DTOä¸ºé¢†åŸŸå¯¹è±¡
        User user = userConverter.toDomain(request);

        // 2. è°ƒç”¨åº”ç”¨æœåŠ¡
        User loginUser = authService.login(user);

        // 3. è½¬æ¢é¢†åŸŸå¯¹è±¡ä¸ºå“åº”DTO
        LoginResp response = userConverter.toResponse(loginUser);

        return Result.success(response);
    }
}
```

##### **Converterï¼ˆè½¬æ¢å™¨ï¼‰**

```java
// interfaces/converter/UserConverter.java
@Mapper(componentModel = "spring")
public interface UserConverter {

    UserConverter INSTANCE = Mappers.getMapper(UserConverter.class);

    // DTO -> Domain Object
    User toDomain(LoginReq request);

    // Domain Object -> Response DTO
    LoginResp toResponse(User user);

}
```

#### 2. **Application å±‚ - ä¸šåŠ¡ç¼–æ’**

##### **Service æ¥å£**

```java
// application/service/AuthService.java
public interface AuthService {

    /**
     * ç”¨æˆ·ç™»å½•
     * @param user ç”¨æˆ·ä¿¡æ¯
     * @return ç™»å½•åçš„ç”¨æˆ·ä¿¡æ¯
     */
    User login(User user);

    /**
     * ç”¨æˆ·ç™»å‡º
     * @param userId ç”¨æˆ·ID
     */
    void logout(Long userId);
}
```

##### **ServiceImpl å®ç°**

```java
// application/impl/AuthServiceImpl.java
@Service
@Transactional
@Slf4j
public class AuthServiceImpl implements AuthService {

    @Autowired
    private UserRepository userRepository;

    @Autowired
    private RedisService redisService;

    @Autowired
    private EventPublisher eventPublisher;

    @Override
    public User login(User user) {
        // 1. æŸ¥æ‰¾ç”¨æˆ·
        User foundUser = userRepository.findByUsername(user.getUsername());
        if (foundUser == null) {
            throw new NotFoundException("ç”¨æˆ·ä¸å­˜åœ¨");
        }

        // 2. éªŒè¯å¯†ç 
        if (!foundUser.validatePassword(user.getPassword())) {
            throw new ValidationException("å¯†ç é”™è¯¯");
        }

        // 3. æ›´æ–°ç™»å½•æ—¶é—´
        foundUser.updateLastLoginTime();
        userRepository.save(foundUser);

        // 4. ç¼“å­˜ç”¨æˆ·ä¿¡æ¯
        redisService.setUserInfo(foundUser);

        // 5. å‘å¸ƒç™»å½•äº‹ä»¶
        eventPublisher.publish(new UserLoginEvent(foundUser));

        log.info("ç”¨æˆ·ç™»å½•æˆåŠŸ: {}", foundUser.getUsername());
        return foundUser;
    }

    @Override
    public void logout(Long userId) {
        // 1. æ¸…é™¤ç¼“å­˜
        redisService.removeUserInfo(userId);

        // 2. å‘å¸ƒç™»å‡ºäº‹ä»¶
        eventPublisher.publish(new UserLogoutEvent(userId));

        log.info("ç”¨æˆ·ç™»å‡º: {}", userId);
    }
}
```

##### **Taskï¼ˆä»»åŠ¡è°ƒåº¦ï¼‰**

```java
// application/task/ScheduledTask.java
@Component
@Slf4j
public class ScheduledTask {

    @Autowired
    private UserRepository userRepository;

    /**
     * å®šæ—¶æ¸…ç†è¿‡æœŸç™»å½•ä¿¡æ¯
     */
    @Scheduled(fixedRate = 3600000) // æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡
    public void cleanExpiredLoginInfo() {
        log.info("å¼€å§‹æ¸…ç†è¿‡æœŸç™»å½•ä¿¡æ¯");
        // æ¸…ç†é€»è¾‘
    }
}
```

#### 3. **Domain å±‚ - æ ¸å¿ƒä¸šåŠ¡**

##### **Entityï¼ˆé¢†åŸŸå®ä½“ï¼‰**

```java
// domain/pojo/entity/user/User.java
@Entity
@Table(name = "sys_user")
public class User {

    @Id
    private Long id;

    private String username;
    private String password;
    private String email;
    private UserStatus status;
    private LocalDateTime lastLoginTime;

    /**
     * éªŒè¯å¯†ç 
     */
    public boolean validatePassword(String inputPassword) {
        return BCrypt.checkpw(inputPassword, this.password);
    }

    /**
     * æ›´æ–°æœ€åç™»å½•æ—¶é—´
     */
    public void updateLastLoginTime() {
        this.lastLoginTime = LocalDateTime.now();
    }

    /**
     * æ£€æŸ¥ç”¨æˆ·çŠ¶æ€
     */
    public boolean isActive() {
        return this.status == UserStatus.ACTIVE;
    }

    // getterã€setteræ–¹æ³•
}
```

##### **DTOï¼ˆæ•°æ®ä¼ è¾“å¯¹è±¡ï¼‰**

```java
// domain/pojo/dto/request/LoginReq.java
public class LoginReq {

    @NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    private String username;

    @NotBlank(message = "å¯†ç ä¸èƒ½ä¸ºç©º")
    private String password;

    private Boolean rememberMe = false;

    // getterã€setteræ–¹æ³•
}

// domain/pojo/dto/response/LoginResp.java
public class LoginResp {
    private String token;
    private String refreshToken;
    private UserInfo userInfo;
    private Long expiresIn;

    // getterã€setteræ–¹æ³•
}
```

##### **Mapperï¼ˆæ•°æ®æ˜ å°„æ¥å£ï¼‰**

```java
// domain/mapper/UserMapper.java
@Mapper
public interface UserMapper {

    /**
     * æ ¹æ®ç”¨æˆ·åæŸ¥æ‰¾ç”¨æˆ·
     */
    UserPO selectByUsername(@Param("username") String username);

    /**
     * æ›´æ–°ç”¨æˆ·ä¿¡æ¯
     */
    int updateUser(UserPO userPO);

    /**
     * æ’å…¥ç”¨æˆ·
     */
    int insertUser(UserPO userPO);
}
```

##### **Repositoryï¼ˆä»“å‚¨æ¥å£ï¼‰**

```java
// domain/repository/UserRepository.java
public interface UserRepository {

    /**
     * æ ¹æ®ç”¨æˆ·åæŸ¥æ‰¾ç”¨æˆ·
     */
    User findByUsername(String username);

    /**
     * ä¿å­˜ç”¨æˆ·
     */
    User save(User user);

    /**
     * æ ¹æ®IDæŸ¥æ‰¾ç”¨æˆ·
     */
    User findById(Long id);
}
```

#### 4. **Infrastructure å±‚ - æŠ€æœ¯å®ç°**

##### **Configï¼ˆé…ç½®ç±»ï¼‰**

```java
// infrastructure/config/database/DatabaseConfig.java
@Configuration
@EnableTransactionManagement
public class DatabaseConfig {

    @Bean
    @ConfigurationProperties("spring.datasource")
    public DataSource dataSource() {
        return new HikariDataSource();
    }

    @Bean
    public SqlSessionFactory sqlSessionFactory() throws Exception {
        SqlSessionFactoryBean factoryBean = new SqlSessionFactoryBean();
        factoryBean.setDataSource(dataSource());
        return factoryBean.getObject();
    }
}

// infrastructure/config/cache/RedisConfig.java
@Configuration
@EnableCaching
public class RedisConfig {

    @Bean
    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory factory) {
        RedisTemplate<String, Object> template = new RedisTemplate<>();
        template.setConnectionFactory(factory);
        template.setKeySerializer(new StringRedisSerializer());
        template.setValueSerializer(new GenericJackson2JsonRedisSerializer());
        return template;
    }
}

// infrastructure/config/security/SecurityConfig.java
@Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        return http
            .csrf().disable()
            .authorizeHttpRequests()
            .requestMatchers("/api/auth/**").permitAll()
            .anyRequest().authenticated()
            .and()
            .build();
    }
}
```

##### **Commonï¼ˆé€šç”¨ç»„ä»¶ï¼‰**

```java
// infrastructure/common/annotation/Log.java
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface Log {
    String value() default "";
    String module() default "";
}

// infrastructure/common/aspect/LogAspect.java
@Aspect
@Component
@Slf4j
public class LogAspect {

    @Around("@annotation(log)")
    public Object around(ProceedingJoinPoint point, Log log) throws Throwable {
        long startTime = System.currentTimeMillis();
        try {
            Object result = point.proceed();
            long endTime = System.currentTimeMillis();
            log.info("æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œè€—æ—¶: {}ms", endTime - startTime);
            return result;
        } catch (Exception e) {
            log.error("æ–¹æ³•æ‰§è¡Œå¼‚å¸¸", e);
            throw e;
        }
    }
}

// infrastructure/common/handler/GlobalExceptionHandler.java
@RestControllerAdvice
@Slf4j
public class GlobalExceptionHandler {

    @ExceptionHandler(BusinessException.class)
    public Result<Void> handleBusinessException(BusinessException e) {
        log.error("ä¸šåŠ¡å¼‚å¸¸: {}", e.getMessage());
        return Result.error(e.getCode(), e.getMessage());
    }

    @ExceptionHandler(ValidationException.class)
    public Result<Void> handleValidationException(ValidationException e) {
        log.error("éªŒè¯å¼‚å¸¸: {}", e.getMessage());
        return Result.error("VALIDATION_ERROR", e.getMessage());
    }
}
```

##### **EventPublisherï¼ˆäº‹ä»¶å‘å¸ƒå™¨ï¼‰**

```java
// infrastructure/shared/event/EventPublisher.java
@Component
@Slf4j
public class EventPublisher {

    @Autowired
    private ApplicationEventPublisher applicationEventPublisher;

    /**
     * å‘å¸ƒé¢†åŸŸäº‹ä»¶
     * @param event é¢†åŸŸäº‹ä»¶
     */
    public void publish(DomainEvent event) {
        log.info("å‘å¸ƒé¢†åŸŸäº‹ä»¶: {}", event.getClass().getSimpleName());
        applicationEventPublisher.publishEvent(event);
    }

    /**
     * å‘å¸ƒç”¨æˆ·ç™»å½•äº‹ä»¶
     * @param user ç”¨æˆ·ä¿¡æ¯
     */
    public void publishUserLogin(User user) {
        UserLoginEvent event = new UserLoginEvent(user);
        publish(event);
    }

    /**
     * å‘å¸ƒç”¨æˆ·ç™»å‡ºäº‹ä»¶
     * @param userId ç”¨æˆ·ID
     */
    public void publishUserLogout(Long userId) {
        UserLogoutEvent event = new UserLogoutEvent(userId);
        publish(event);
    }

    /**
     * å‘å¸ƒé¡¹ç›®åˆ›å»ºäº‹ä»¶
     * @param project é¡¹ç›®ä¿¡æ¯
     */
    public void publishProjectCreated(Project project) {
        ProjectCreatedEvent event = new ProjectCreatedEvent(project);
        publish(event);
    }
}
```

##### **Externalï¼ˆå¤–éƒ¨æœåŠ¡é›†æˆï¼‰**

```java
// infrastructure/external/dify/dto/request/DifyChatReq.java
public class DifyChatReq {
    private String query;
    private String conversationId;
    private String user;
    private Map<String, Object> inputs;
    private String responseMode;
    private String userId;

    // getterã€setteræ–¹æ³•
}

// infrastructure/external/dify/dto/response/DifyChatResp.java
public class DifyChatResp {
    private String message;
    private String conversationId;
    private String messageId;
    private String answer;
    private Map<String, Object> metadata;
    private String createdAt;

    // getterã€setteræ–¹æ³•
}

// infrastructure/external/minio/dto/request/MinioUploadReq.java
public class MinioUploadReq {
    private String bucketName;
    private String objectName;
    private MultipartFile file;
    private String contentType;
    private Map<String, String> metadata;

    // getterã€setteræ–¹æ³•
}

// infrastructure/external/minio/dto/response/MinioUploadResp.java
public class MinioUploadResp {
    private String objectName;
    private String url;
    private String etag;
    private Long size;
    private LocalDateTime uploadTime;

    // getterã€setteræ–¹æ³•
}

// infrastructure/external/kafka/dto/request/KafkaMessageReq.java
public class KafkaMessageReq {
    private String topic;
    private String key;
    private Object message;
    private Map<String, String> headers;
    private Integer partition;

    // getterã€setteræ–¹æ³•
}

// infrastructure/external/kafka/dto/response/KafkaMessageResp.java
public class KafkaMessageResp {
    private String topic;
    private Integer partition;
    private Long offset;
    private String timestamp;
    private Boolean success;

    // getterã€setteræ–¹æ³•
}

// infrastructure/external/redis/dto/request/RedisSetReq.java
public class RedisSetReq {
    private String key;
    private Object value;
    private Duration timeout;
    private String dataType;

    // getterã€setteræ–¹æ³•
}

// infrastructure/external/redis/dto/response/RedisSetResp.java
public class RedisSetResp {
    private String key;
    private Boolean success;
    private String message;
    private LocalDateTime setTime;

    // getterã€setteræ–¹æ³•
}

// infrastructure/external/dify/DifyService.java
@Service
@Slf4j
public class DifyService {

    @Autowired
    private DifyConfig difyConfig;

    @Autowired
    private DifyConverter difyConverter;

    /**
     * å‘é€èŠå¤©æ¶ˆæ¯åˆ° Dify
     */
    public ChatResp sendChatMessage(ChatReq chatReq) {
        log.info("å‘é€æ¶ˆæ¯åˆ° Dify: {}", chatReq.getMessage());

        // 1. è½¬æ¢ä¸º Dify API æ¨¡å‹
        DifyChatReq difyReq = difyConverter.toDifyReq(chatReq);

        // 2. è°ƒç”¨ Dify API
        DifyChatResp difyResp = callDifyApi(difyReq);

        // 3. è½¬æ¢ä¸ºä¸šåŠ¡æ¨¡å‹
        ChatResp chatResp = difyConverter.toChatResp(difyResp);

        return chatResp;
    }

    private DifyChatResp callDifyApi(DifyChatReq req) {
        // å…·ä½“çš„ API è°ƒç”¨é€»è¾‘
        // ä½¿ç”¨ RestTemplate æˆ– WebClient è°ƒç”¨ Dify API
        return new DifyChatResp();
    }
}

// infrastructure/external/minio/MinioService.java
@Service
@Slf4j
public class MinioService {

    @Autowired
    private MinioConfig minioConfig;

    /**
     * ä¸Šä¼ æ–‡ä»¶åˆ° MinIO
     */
    public String uploadFile(MultipartFile file) {
        log.info("ä¸Šä¼ æ–‡ä»¶åˆ° MinIO: {}", file.getOriginalFilename());
        // æ–‡ä»¶ä¸Šä¼ é€»è¾‘
        return "file-url";
    }

    /**
     * ä» MinIO ä¸‹è½½æ–‡ä»¶
     */
    public byte[] downloadFile(String fileUrl) {
        log.info("ä» MinIO ä¸‹è½½æ–‡ä»¶: {}", fileUrl);
        // æ–‡ä»¶ä¸‹è½½é€»è¾‘
        return new byte[0];
    }
}

// infrastructure/external/kafka/KafkaProducer.java
@Component
@Slf4j
public class KafkaProducer {

    @Autowired
    private KafkaTemplate<String, Object> kafkaTemplate;

    /**
     * å‘é€æ¶ˆæ¯åˆ° Kafka
     */
    public void sendMessage(String topic, Object message) {
        log.info("å‘é€æ¶ˆæ¯åˆ° Kafka ä¸»é¢˜: {}", topic);
        kafkaTemplate.send(topic, message);
    }
}

// infrastructure/external/redis/RedisService.java
@Service
@Slf4j
public class RedisService {

    @Autowired
    private RedisTemplate<String, Object> redisTemplate;

    /**
     * è®¾ç½®ç”¨æˆ·ä¿¡æ¯åˆ°ç¼“å­˜
     */
    public void setUserInfo(User user) {
        String key = "user:info:" + user.getId();
        redisTemplate.opsForValue().set(key, user, Duration.ofHours(1));
        log.info("ç”¨æˆ·ä¿¡æ¯å·²ç¼“å­˜: {}", user.getUsername());
    }

    /**
     * ä»ç¼“å­˜è·å–ç”¨æˆ·ä¿¡æ¯
     */
    public User getUserInfo(Long userId) {
        String key = "user:info:" + userId;
        return (User) redisTemplate.opsForValue().get(key);
    }

    /**
     * æ¸…é™¤ç”¨æˆ·ç¼“å­˜
     */
    public void removeUserInfo(Long userId) {
        String key = "user:info:" + userId;
        redisTemplate.delete(key);
        log.info("ç”¨æˆ·ç¼“å­˜å·²æ¸…é™¤: {}", userId);
    }
}
```

##### **Sharedï¼ˆå…±äº«ç»„ä»¶ï¼‰**

```java
// infrastructure/shared/result/Result.java
public class Result<T> {
    private String code;
    private String message;
    private T data;

    public static <T> Result<T> success(T data) {
        Result<T> result = new Result<>();
        result.setCode("200");
        result.setMessage("æˆåŠŸ");
        result.setData(data);
        return result;
    }

    public static <T> Result<T> error(String code, String message) {
        Result<T> result = new Result<>();
        result.setCode(code);
        result.setMessage(message);
        return result;
    }
}

// infrastructure/shared/exception/BusinessException.java
public class BusinessException extends RuntimeException {
    private final String code;
    private final String message;

    public BusinessException(String code, String message) {
        super(message);
        this.code = code;
        this.message = message;
    }
}

// infrastructure/shared/event/DomainEvent.java
public abstract class DomainEvent {
    private final String eventId;
    private final LocalDateTime occurredOn;

    public DomainEvent() {
        this.eventId = UUID.randomUUID().toString();
        this.occurredOn = LocalDateTime.now();
    }

    public String getEventId() { return eventId; }
    public LocalDateTime getOccurredOn() { return occurredOn; }
}

// infrastructure/shared/event/UserLoginEvent.java
public class UserLoginEvent extends DomainEvent {
    private final Long userId;
    private final String username;
    private final LocalDateTime loginTime;

    public UserLoginEvent(User user) {
        super();
        this.userId = user.getId();
        this.username = user.getUsername();
        this.loginTime = LocalDateTime.now();
    }

    // getteræ–¹æ³•
    public Long getUserId() { return userId; }
    public String getUsername() { return username; }
    public LocalDateTime getLoginTime() { return loginTime; }
}

// infrastructure/shared/event/UserLogoutEvent.java
public class UserLogoutEvent extends DomainEvent {
    private final Long userId;
    private final LocalDateTime logoutTime;

    public UserLogoutEvent(Long userId) {
        super();
        this.userId = userId;
        this.logoutTime = LocalDateTime.now();
    }

    // getteræ–¹æ³•
    public Long getUserId() { return userId; }
    public LocalDateTime getLogoutTime() { return logoutTime; }
}

// infrastructure/shared/event/ProjectCreatedEvent.java
public class ProjectCreatedEvent extends DomainEvent {
    private final Long projectId;
    private final String projectName;
    private final Long creatorId;
    private final LocalDateTime createTime;

    public ProjectCreatedEvent(Project project) {
        super();
        this.projectId = project.getId();
        this.projectName = project.getName();
        this.creatorId = project.getCreatorId();
        this.createTime = LocalDateTime.now();
    }

    // getteræ–¹æ³•
    public Long getProjectId() { return projectId; }
    public String getProjectName() { return projectName; }
    public Long getCreatorId() { return creatorId; }
    public LocalDateTime getCreateTime() { return createTime; }
}

// infrastructure/shared/enums/UserStatus.java
public enum UserStatus {
    ACTIVE("æ¿€æ´»"),
    INACTIVE("æœªæ¿€æ´»"),
    LOCKED("é”å®š"),
    DISABLED("ç¦ç”¨");

    private final String description;

    UserStatus(String description) {
        this.description = description;
    }
}

// infrastructure/shared/utils/JsonUtils.java
public class JsonUtils {

    private static final ObjectMapper objectMapper = new ObjectMapper();

    public static String toJson(Object obj) {
        try {
            return objectMapper.writeValueAsString(obj);
        } catch (Exception e) {
            throw new RuntimeException("JSONè½¬æ¢å¤±è´¥", e);
        }
    }

    public static <T> T fromJson(String json, Class<T> clazz) {
        try {
            return objectMapper.readValue(json, clazz);
        } catch (Exception e) {
            throw new RuntimeException("JSONè§£æå¤±è´¥", e);
        }
    }
}
```

#### 5. **Resources å±‚ - èµ„æºæ–‡ä»¶**

##### **application.yml**

```yaml
# resources/application.yml
server:
  port: 8080

spring:
  application:
    name: sci-z-server

  datasource:
    url: jdbc:postgresql://localhost:5432/sciz_db
    username: sciz_user
    password: sciz_pass
    driver-class-name: org.postgresql.Driver

  redis:
    host: localhost
    port: 6379
    password:
    database: 0

  kafka:
    bootstrap-servers: localhost:9092
    consumer:
      group-id: sci-z-group
```

##### **UserMapper.xml**

```xml
<!-- resources/mapper/user/UserMapper.xml -->
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sciz.server.domain.mapper.UserMapper">

    <select id="selectByUsername" resultType="com.sciz.server.infrastructure.persistence.entity.UserPO">
        SELECT * FROM sys_user WHERE username = #{username}
    </select>

    <update id="updateUser" parameterType="com.sciz.server.infrastructure.persistence.entity.UserPO">
        UPDATE sys_user
        SET last_login_time = #{lastLoginTime}
        WHERE id = #{id}
    </update>

</mapper>
```

### ğŸ¯ **å®Œæ•´æµç¨‹æ€»ç»“**

1. **å®¢æˆ·ç«¯** â†’ **AuthController** â†’ **UserConverter** â†’ **AuthService**
2. **AuthService** â†’ **UserRepository** â†’ **UserMapper** â†’ **æ•°æ®åº“**
3. **æ•°æ®åº“** â†’ **UserPO** â†’ **User å®ä½“** â†’ **ä¸šåŠ¡éªŒè¯**
4. **ä¸šåŠ¡éªŒè¯** â†’ **ç¼“å­˜æ›´æ–°** â†’ **äº‹ä»¶å‘å¸ƒ** â†’ **å“åº”è¿”å›**

è¿™ä¸ªå®Œæ•´çš„ç™»å½•ç¤ºä¾‹è¦†ç›–äº†é¡¹ç›®ç›®å½•ç»“æ„ä¸­çš„æ¯ä¸€é¡¹ï¼Œå±•ç¤ºäº†ä»æ¥å£å±‚åˆ°åŸºç¡€è®¾æ–½å±‚çš„å®Œæ•´è°ƒç”¨é“¾ï¼Œä½“ç°äº† DDD æ¶æ„çš„åˆ†å±‚èŒè´£å’Œä¾èµ–å…³ç³»ã€‚
