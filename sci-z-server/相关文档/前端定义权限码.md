# 前端定义权限码与菜单映射（用于与后端对齐与初始化）

本文档汇总当前前端项目的权限类型、权限码清单、路由与菜单的权限绑定关系、图标约定，以及后端落表建议，便于后续与后端接口/数据库初始化保持一致。

## 1. 权限模型与校验机制

- 路由守卫：每个需要鉴权的页面在 `meta.permission` 声明所需权限，路由跳转前校验。
- 指令控制：
  - `v-permission="'perm:code' | ['perm:a','perm:b']"` 控制元素显示/隐藏。
  - `v-role="'role' | ['roleA','roleB']"` 控制元素显示/隐藏。
- 角色与权限：`admin` 或 `'*'` 代表全权限。

关键实现位置（仅供参考）：

```1:44:src/router/index.js
{
  path: '/dashboard',
  name: 'Dashboard',
  component: () => import('@/views/Dashboard/index.vue'),
  meta: {
    title: '仪表板',
    requiresAuth: true,
    permission: 'menu:dashboard:view',
    layout: 'main'
  }
}
```

```295:321:src/router/index.js
// 检查页面权限
if (to.meta.permission && !authStore.hasPermission(to.meta.permission)) {
  ElMessage.error('没有权限访问该页面')
  return next('/dashboard')
}
```

```12:41:src/directives/permission.js
export const permission = {
  mounted(el, binding) {
    const { value } = binding
    const authStore = useAuthStore()
    const hasPermission = checkPermission(value, authStore)
    if (!hasPermission) {
      el.style.display = 'none'
    }
  },
  updated(el, binding) {
    const { value } = binding
    const authStore = useAuthStore()
    const hasPermission = checkPermission(value, authStore)
    el.style.display = hasPermission ? '' : 'none'
  }
}
```

## 2. 权限码清单（当前前端使用）

来源：`src/utils/constants.js` 与 `src/store/modules/auth.js`（模拟数据）。

- 菜单级权限（menu:...）：
  - `menu:dashboard:view`
  - `menu:declaration:list`
  - `menu:declaration:create`
  - `menu:declaration:detail`
  - `menu:project:list`
  - `menu:project:detail`
  - `menu:project:progress`
  - `menu:report:list`
  - `menu:report:generate`
  - `menu:knowledge:list`
  - `menu:knowledge:detail`
  - `menu:ai:chat`
  - `menu:user:profile`
  - `menu:user:security`
  - `menu:system:user`
  - `menu:system:role`
  - `menu:system:config`
  - `menu:system:logs`

- 按钮级权限（button:...）（当前模拟使用，模板/页面可通过 v-permission 调用）：
  - `button:declaration:create`
  - `button:project:create`
  - `button:report:generate`
  - `button:knowledge:create`

- 数据级权限（data:...）（当前模拟使用）：
  - `data:own`
  - `data:public`

- 特权：
  - `'*'`（拥有全部权限）

## 3. 路由 — 权限 — 页面（标题）对照

以下为所有受控路由与对应权限码，后端可按此初始化菜单/路由权限表。

- `/dashboard` — 仪表板 — `menu:dashboard:view`
- `/declaration/list` — 申报列表 — `menu:declaration:list`
- `/declaration/create` — 新建申报 — `menu:declaration:create`
- `/declaration/detail/:id` — 申报详情 — `menu:declaration:detail`
- `/project/list` — 项目列表 — `menu:project:list`
- `/project/detail/:id` — 项目详情 — `menu:project:detail`
- `/project/progress/:id` — 项目进度 — `menu:project:progress`
- `/report/list` — 报告列表 — `menu:report:list`
- `/report/generate` — 报告生成 — `menu:report:generate`
- `/knowledge/list` — 知识库列表 — `menu:knowledge:list`
- `/knowledge/detail/:id` — 知识库详情 — `menu:knowledge:detail`
- `/ai/chat` — AI助手 — `menu:ai:chat`
- `/user/profile` — 个人信息 — `menu:user:profile`
- `/user/security` — 安全设置 — `menu:user:security`
- `/system/user` — 用户管理 — `menu:system:user`
- `/system/role` — 角色权限 — `menu:system:role`
- `/system/config` — 系统配置 — `menu:system:config`
- `/system/logs` — 日志管理 — `menu:system:logs`

注：`/login`、`/register`、`/reset-password` 为公开页，无需权限。

## 4. 菜单结构与图标映射（侧边栏）

前端侧边栏菜单来自用户的菜单列表（当前为模拟），结构字段：`path`、`title`、`icon`、`permission`、`children`。

图标来源：`@element-plus/icons-vue`，在 `src/main.js` 全量注册，菜单项的 `icon` 字段使用其组件名字符串（如 `Odometer`、`Document`）。

当前模拟菜单（层级与图标）：

- 一级：`/dashboard` — 仪表板 — Icon: `Odometer` — `menu:dashboard:view`
- 一级：`declaration` — 申报管理 — Icon: `Document` — `menu:declaration:list`
  - 子项：`/declaration/list` — 申报列表 — Icon: `List` — `menu:declaration:list`
- 一级：`project` — 项目管理 — Icon: `Folder` — `menu:project:list`
  - 子项：`/project/list` — 项目列表 — Icon: `List` — `menu:project:list`
- 一级：`acceptance` — 验收管理 — Icon: `Check` — `menu:report:list`
  - 子项：`/report/list` — 报告管理 — Icon: `List` — `menu:report:list`
- 一级：`ai` — AI助手 — Icon: `Monitor` — `menu:ai:chat`
  - 子项：`/knowledge/list` — 知识库 — Icon: `Reading` — `menu:knowledge:list`
  - 子项：`/ai/chat` — AI对话 — Icon: `Avatar` — `menu:ai:chat`
- 一级：`user` — 用户中心 — Icon: `User` — `menu:user:profile`
  - 子项：`/user/profile` — 个人信息 — Icon: `House` — `menu:user:profile`
  - 子项：`/user/security` — 安全设置 — Icon: `Lock` — `menu:user:security`
- 一级：`system` — 系统管理 — Icon: `Setting` — `menu:system:user`
  - 子项：`/system/user` — 用户管理 — Icon: `User` — `menu:system:user`
  - 子项：`/system/role` — 角色权限 — Icon: `Key` — `menu:system:role`
  - 子项：`/system/config` — 系统配置 — Icon: `Setting` — `menu:system:config`
  - 子项：`/system/logs` — 日志管理 — Icon: `Document` — `menu:system:logs`

注：父级分组（如 `declaration`、`project`、`system`）可与实际路由前缀对应，也可仅作菜单分组，后端可在菜单表通过 `parent_id` 体现层级。

## 5. 与后端对接与落表建议

建议最小表结构（字段仅供对齐参考）：

- `permissions`（权限表）
  - `id`、`code`（唯一，如 `menu:project:list`）、`name`（展示名）、`type`（menu|button|data）、`description`
- `menus`（菜单表）
  - `id`、`path`、`title`、`icon`（与前端保持 Element Plus Icon 名称一致）
  - `permission_code`（关联到 `permissions.code`）
  - `parent_id`、`order_num`、`visible`
- `roles`（角色表）
  - `id`、`code`（如 `admin`/`user`）、`name`、`description`
- `role_permissions`（角色-权限关联表）
  - `role_id`、`permission_id`
- `user_roles`（用户-角色关联表）
  - `user_id`、`role_id`

初始化建议：
- 管理员 `admin` 角色授予 `'*'` 或授予全部权限码。
- 普通用户 `user` 角色授予上文“菜单级权限清单”中与业务一致的最小集合（与现有模拟一致可快速跑通）。
- 菜单表按“菜单结构与图标映射”逐条初始化，确保 `path` 与路由一致、`permission_code` 一一对应。

## 6. 前后端约定要点

- 前端路由鉴权读取 `to.meta.permission`，请确保后端返回的权限集合包含对应的权限码。
- 前端按钮、数据级权限通过 `v-permission`/`v-role` 控制，后端如需精细控制，请下发相应 `button:*`、`data:*` 权限码。
- Icon 使用 Element Plus 图标组件名（`@element-plus/icons-vue`），后端无需解析，原样存储并回传给前端即可。
- `'*'`/`admin` 为超级权限/角色约定。

## 7. 附：权限码来源引用

- 常量定义：`src/utils/constants.js` → `PERMISSIONS`
- 路由元信息权限：`src/router/index.js` → `meta.permission`
- 侧边栏菜单（模拟）：`src/store/modules/auth.js` → `getMockMenus()`
- 权限/角色（模拟）：`src/store/modules/auth.js` → `getMockPermissions()`
- 指令：`src/directives/permission.js`（`v-permission`/`v-role`）
