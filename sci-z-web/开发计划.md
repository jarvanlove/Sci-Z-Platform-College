# 高校科研项目管理平台开发计划

## 1. 项目概述

### 1.1 项目信息

- 项目名称：高校科研项目管理平台（Sci-Z-Platform-College）
- 开发模式：前后端分离 + 微服务架构 + DDD 领域驱动设计
- 技术栈：Spring Boot 2.7、Spring Cloud Alibaba、Java 11、PostgreSQL、Redis、Kafka、MinIO、MyBatis-Plus、Sa-Token、LangChain4j、Dify、Vue 3、Vite、Pinia、Element Plus、Axios
- 目标人群：高校科研人员、科研管理部门、系统管理员
- 交付目标：实现申报-执行（项目管理）-验收的全流程管理与 AI 能力集成（Dify 工作流与知识库）

### 1.2 范围与关键能力

- 用户管理（认证授权、RBAC、用户资料、登录日志）
- 申报（研究方向/领域、状态跟踪、Dify 工作流触发）
- 项目管理（成员、文档、进度、知识库同步/检索）
- 验收（申请/审核、报告生成与预览下载）
- 文件（上传/预览、MinIO、MD5 去重、业务绑定）
- 系统配置（参数与开关）
- AI 集成（Dify 工作流、知识库、LangChain4j）

---

## 2. 阶段规划与里程碑（20 周）

### 阶段一：基础设施与骨架（第 1-3 周）

#### 1.1 开发环境准备（第 1 周）

后端环境搭建

- [ ] 搭建 Spring Boot 项目基础架构
- [ ] 配置 DDD 项目结构（interfaces/application/domain/infrastructure/shared）
- [ ] 集成 MyBatis-Plus + PostgreSQL
- [ ] 配置 Redis 缓存
- [ ] 集成 Sa-Token 权限认证
- [ ] 配置 Swagger3/OpenAPI 文档
- [ ] 集成 Kafka 生产/消费端
- [ ] 配置 MinIO 客户端与签名 URL

前端环境搭建

- [ ] 初始化 Vite + Vue 3 工程
- [ ] 集成 Element Plus 组件库与主题
- [ ] 配置 Vue Router（基础路由 + 守卫）
- [ ] 集成 Pinia 状态管理
- [ ] 封装 Axios（请求/响应拦截、错误统一处理）
- [ ] 配置 ESLint + Prettier + Husky（提交校验）

#### 1.2 数据库初始化（第 2 周）

- [ ] 创建 16 张核心表（与 README 4.1 一致）
- [ ] 主键使用 `BIGINT GENERATED BY DEFAULT AS IDENTITY`
- [ ] 为所有表添加 `is_deleted` 字段
- [ ] 为所有字段与表添加 `COMMENT ON` 注释
- [ ] 按查询场景创建索引（唯一/组合/状态/时间/外键）
- [ ] 输出迁移脚本（V1..V4），可在 PostgreSQL 一次执行

#### 1.3 基础框架集成（第 3 周）

后端通用能力

- [ ] 统一异常处理（全局异常 + 错误码）
- [ ] 统一返回结果（Result/PageResult）
- [ ] 统一日志（Logback + 请求链路 traceId）
- [ ] CORS 与安全配置

前端通用能力

- [ ] 布局框架（Header/Sidebar/Main）
- [ ] 通用组件（Dialog/Pagination/StatusTag/Loading）
- [ ] 全局主题应用（README 6.4 学术配色）

里程碑

- [ ] 应用可启动、基础依赖可用、数据库可初始化

### 阶段二：认证与权限（第 4-5 周）

后端（用户/角色/权限/RBAC）

- [ ] 用户注册/登录/登出 API（/user/register,/user/login,/user/logout）
- [ ] 获取当前用户信息 /user/info
- [ ] 修改密码 /user/password、更新资料 /user/update
- [ ] 角色管理（新增/编辑/列表/删除）
- [ ] 权限管理（菜单/按钮/API，编码唯一）
- [ ] 用户-角色、角色-权限 关联维护 API
- [ ] 登录日志记录与查询
- [ ] 鉴权注解与 AOP 校验、白名单与忽略配置

前端

- [ ] 登录/注册页与表单校验
- [ ] Token 存储与自动刷新、登录状态管理
- [ ] 动态菜单（基于权限树）与按钮级指令 v-permission
- [ ] 用户中心（个人信息/安全设置/登录日志）

验收里程碑

- [ ] 完成用户认证链路与 RBAC 能力，页面权限与接口权限一致

### 阶段三：申报与项目管理（第 6-9 周）

申报模块（后端）

- [ ] 申报提交 /declaration/submit（研究方向/研究领域参数校验）
- [ ] 申报列表/详情/撤回 API
- [ ] 调用 Dify 申报工作流（LangChain4j 封装、失败重试）
- [ ] 申报状态查询与轮询/回调

申报模块（前端）

- [ ] 新建申报页（富文本/标签输入）
- [ ] 申报列表/详情页（状态流转显示）

项目管理（后端）

- [ ] 项目 CRUD、项目负责人与成员关系
- [ ] 文档上传（MinIO）与 `file_info` 入库、签名 URL 生成
- [ ] 知识库同步（将文档同步至 Dify 知识库）与检索 API
- [ ] 项目进度新增/列表、里程碑标记

项目管理（前端）

- [ ] 项目列表/详情
- [ ] 文档管理：上传/列表/预览/删除
- [ ] 知识库搜索：关键词/语义搜索结果展示
- [ ] 进度管理：新增/列表/里程碑标记
- [ ] 成员管理：添加/移除/角色类型

里程碑

- [ ] 申报 → 项目承接链路贯通，项目核心功能可用

### 阶段四：验收与报告（第 10-13 周）

后端

- [ ] 验收申请/提交/审核 API，状态机与权限控制
- [ ] 调用 Dify 报告生成工作流（科技/自评），异步任务与状态查询
- [ ] 报告内容持久化、MinIO 存储、下载链接
- [ ] 验收与报告的审计日志

前端

- [ ] 验收列表/详情/申请
- [ ] 报告生成/列表/预览/下载（PDF/Word 链接）

里程碑

- [ ] 项目 → 验收与报告链路可以稳定闭环

### 阶段五：AI 助手与通用能力（第 14-15 周）

- [ ] AI 助手：聊天窗口、知识来源标注、置信度条、会话管理
- [ ] 系统配置：系统参数 CRUD、加密字段（密钥）管理
- [ ] 消息通知：站内信/邮件（可选）
- [ ] 日志查询与监控接口
- [ ] WebSocket 推送（可选）

里程碑

- [ ] AI 助手上线，通用能力完善

### 阶段六：集成测试与优化（第 16-18 周）

- 接口联调、性能优化（缓存/索引/SQL 调优）、文件存储与异步链路验证、监控与告警
- 测试：单元/集成/接口/性能/安全/兼容性、UAT
- 里程碑：通过核心场景回归与性能门槛

### 阶段七：部署与发布（第 19-20 周）

- 构建与发布、配置管理、迁移脚本执行、灰度与回滚预案、培训与交接
- 里程碑：生产环境稳定上线

---

## 3. 详细任务分解

### 3.1 后端任务（DDD 分层）

- 接口层（interfaces）：Controller、DTO、Assembler、Facade
- 应用层（application）：ApplicationService、Command/Query、事件处理与发布
- 领域层（domain）：聚合根（User/Declaration/Project/Acceptance/File/Report）、实体、值对象、领域服务、仓储接口
- 基础设施层（infrastructure）：MyBatis-Plus Mapper、PO、RepositoryImpl、外部集成（Dify/MinIO/Kafka）、配置（DB/Cache/MQ/Security）

核心用例与接口（示例）：

- 用户：注册/登录/登出/信息/密码；角色/权限；登录日志
- 申报：提交/列表/详情/撤回；状态查询；触发 Dify 工作流
- 项目：CRUD；成员增删/列表；进度新增/列表；文档上传/列表/预览链接；知识库同步/搜索
- 验收：申请/提交/审核/状态；报告生成/列表/预览/下载
- AI：执行工作流、知识库同步/检索、任务状态

### 3.2 数据库与数据治理

- 表结构：与 README 4.1 的 16 张表一致（sys_user、sys_role、sys_permission、sys_user_role、sys_role_permission、sys_login_log、project_declaration、project、project_member、project_document、project_progress、project_acceptance、acceptance_report、file_info、sys_config、dify_config）
- 规范：
  - 主键：`BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY`
  - 逻辑删除：`is_deleted SMALLINT DEFAULT 0`
  - 时间：`created_time`、`updated_time` 标准化
  - 注释：使用 `COMMENT ON TABLE/COLUMN` 统一维护
  - 索引：唯一索引 + 组合索引 + 状态/时间/外键常用查询索引；部分索引带 `WHERE is_deleted = 0`
- 脚本：分模块迁移（V1..V4），开发/测试/生产三套环境变量

### 3.3 前端任务

- 基座：Vite、Vue3、Pinia、Vue Router、Element Plus、Axios、ESLint/Prettier
- 视图：
  - 认证：Login、Register
  - 仪表板：Dashboard
  - 用户中心：Profile、Security
  - 申报：List、Create、Detail
  - 项目：List、Detail、Documents、Progress、Members、Knowledge
  - 验收：List、Apply、Detail、Reports
  - 错误：403、404
- 组件：Layout、FileUpload、FilePreview、SearchBox、StatusTag、Loading、Dialog、Pagination
- 主题：采用 README 6.4 的“高校科研学术配色”方案

### 3.4 AI 与外部集成

- Dify：工作流执行（申报/报告）、知识库同步/检索、任务状态
- LangChain4j：统一调用封装与重试、超时降级
- MinIO：对象存储客户端与签名 URL 生成
- Kafka：进度/验收等事件发布与消费

### 3.5 DevOps 与部署

- 构建：Maven、前端打包、版本号与制品归档
- 配置：多环境配置、敏感信息加密（如 API Key）
- 部署：Docker 镜像、Compose/K8s、Nginx 前端与网关反代
- 监控：Prometheus/Grafana、SkyWalking、日志采集

---

## 4. 质量与安全

### 4.1 测试矩阵

- 单元测试（JUnit5 + Mockito）、集成测试（Spring Boot Test）
- 前端测试（Vitest + Vue Test Utils）
- 接口测试（Postman/Newman）、性能测试（JMeter）、安全测试（OWASP ZAP）

### 4.2 代码与流程

- 代码规范：ESLint/Prettier、阿里 Java 规范
- PR 流程：分支策略、代码评审、CI 校验（lint/test/build）

### 4.3 风险与应对

- Dify 稳定性：预生产验证、超时重试与降级、幂等设计
- 大文件/并发：分片上传、断点续传、CDN/缓存、热点索引优化
- 数据一致性：事件驱动 + 最终一致性、审计日志、灾备备份

---

## 5. 与 README/需求文档的对齐

- 架构模型：微服务 + 前后端分离 + DDD 四层，与 README 5.1 一致
- 数据库：表结构/注释/索引与 README 4.1 保持一致，SQL 可在 PostgreSQL 直接执行
- 页面与流程：与 README 6.2 的页面列表与业务流转图一致
- AI 能力：严格按需求文档“申报/执行/验收”三阶段的 Dify 集成方式实现

---

## 6. 交付清单

- 源码（后端/前端）与构建脚本
- 数据库脚本（迁移与初始化）
- 部署清单（Dockerfile/Compose/K8s 清单、Nginx 配置）
- 使用手册与管理员手册
- 测试报告与性能报告
