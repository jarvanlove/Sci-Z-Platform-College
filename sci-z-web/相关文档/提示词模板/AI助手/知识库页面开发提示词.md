# çŸ¥è¯†åº“é¡µé¢å¼€å‘æç¤ºè¯

## ğŸ“‹ é¡µé¢ä¿¡æ¯
- **åŸå‹å›¾è·¯å¾„**ï¼š`åŸå‹å›¾/AIåŠ©æ‰‹/çŸ¥è¯†åº“.html`
- **é¡µé¢ç±»å‹**ï¼šçŸ¥è¯†åº“æœç´¢é¡µé¢
- **é¡µé¢åç§°**ï¼šçŸ¥è¯†åº“
- **ä¸»è¦åŠŸèƒ½**ï¼šçŸ¥è¯†åº“æœç´¢ã€æ–‡æ¡£ç®¡ç†ã€AIå¯¹è¯äº¤äº’ï¼ˆä¸AIå¯¹è¯é¡µé¢ä¿æŒä¸€è‡´ï¼‰
- **å¯¹åº”æ–‡ä»¶è·¯å¾„**ï¼š`src/views/AI/Knowledge.vue`

## ğŸ¨ åŸå‹å›¾è§†è§‰åˆ†æ

### **æ•´ä½“å¸ƒå±€**
- ä¸‰æ å¸ƒå±€ï¼šå·¦ä¾§çŸ¥è¯†åº“åˆ—è¡¨ + ä¸­é—´æœç´¢ç»“æœ + å³ä¾§AIå¯¹è¯
- èƒŒæ™¯è‰²ï¼š`#f7f9fc`
- é«˜åº¦ï¼š`100vh`ï¼Œå…¨å±æ˜¾ç¤º

### **å·¦ä¾§çŸ¥è¯†åº“åˆ—è¡¨åŒºåŸŸ**
- å®½åº¦ï¼š`280px`
- èƒŒæ™¯ï¼š`#ffffff`
- è¾¹æ¡†ï¼š`1px solid #e5e7eb`
- å¤´éƒ¨ï¼šæœç´¢æ¡†ã€æ–°å»ºçŸ¥è¯†åº“æŒ‰é’®
- åˆ—è¡¨ï¼šçŸ¥è¯†åº“åˆ†ç±»ï¼Œæ”¯æŒå±•å¼€/æ”¶èµ·

### **ä¸­é—´æœç´¢ç»“æœåŒºåŸŸ**
- æœç´¢æ¡†ï¼šé¡¶éƒ¨å›ºå®šï¼Œæ”¯æŒå®æ—¶æœç´¢
- ç»“æœåˆ—è¡¨ï¼šæ–‡æ¡£å¡ç‰‡ï¼Œæ˜¾ç¤ºæ ‡é¢˜ã€æ‘˜è¦ã€æ¥æºã€æ—¶é—´
- åˆ†é¡µï¼šåº•éƒ¨åˆ†é¡µç»„ä»¶
- ç­›é€‰ï¼šæ”¯æŒæŒ‰ç±»å‹ã€æ—¶é—´ç­›é€‰

### **å³ä¾§AIå¯¹è¯åŒºåŸŸ**
- **ä¸AIå¯¹è¯é¡µé¢å®Œå…¨ä¸€è‡´**ï¼šå¯¹è¯å†å²ã€æ¶ˆæ¯æ˜¾ç¤ºã€è¾“å…¥æ¡†
- æ”¯æŒæµå¼å“åº”ã€ä»£ç é«˜äº®ã€Markdownæ¸²æŸ“
- å¯¹è¯ä¸Šä¸‹æ–‡ä¸çŸ¥è¯†åº“æœç´¢ç»“æœå…³è”

## ğŸ”§ æŠ€æœ¯å®ç°è¦æ±‚

### 1. é¡µé¢ç»“æ„
```vue
<template>
  <div class="knowledge-base-container">
    <!-- å·¦ä¾§çŸ¥è¯†åº“åˆ—è¡¨ -->
    <div class="kb-list-sidebar">
      <div class="kb-list-header">
        <div class="search-input-wrap">
          <el-input
            v-model="kbSearchKeyword"
            :placeholder="$t('ai.knowledge.searchKb')"
            clearable
            @input="handleKbSearch"
          >
            <template #prefix>
              <el-icon><Search /></el-icon>
            </template>
          </el-input>
        </div>
        <el-button type="primary" class="new-kb-btn" @click="createKnowledgeBase">
          <el-icon><Plus /></el-icon>
          {{ $t('ai.knowledge.newKb') }}
        </el-button>
      </div>
      
      <div class="kb-list">
        <div
          v-for="kb in knowledgeBases"
          :key="kb.id"
          class="kb-item"
          :class="{ active: currentKbId === kb.id }"
          @click="selectKnowledgeBase(kb.id)"
        >
          <div class="kb-item-content">
            <div class="kb-title">{{ kb.name }}</div>
            <div class="kb-desc">{{ kb.description }}</div>
            <div class="kb-meta">
              <span class="kb-count">{{ kb.documentCount }} {{ $t('ai.knowledge.documents') }}</span>
              <span class="kb-time">{{ formatTime(kb.updatedAt) }}</span>
            </div>
          </div>
          <div class="kb-item-actions" @click.stop>
            <el-dropdown @command="(action) => handleKbAction(action, kb)">
              <el-button class="kb-more-btn" text>
                <el-icon><MoreFilled /></el-icon>
              </el-button>
              <template #dropdown>
                <el-dropdown-menu>
                  <el-dropdown-item command="edit">{{ $t('common.edit') }}</el-dropdown-item>
                  <el-dropdown-item command="settings">{{ $t('common.settings') }}</el-dropdown-item>
                  <el-dropdown-item command="delete" divided>
                    {{ $t('common.delete') }}
                  </el-dropdown-item>
                </el-dropdown-menu>
              </template>
            </el-dropdown>
          </div>
        </div>
      </div>
    </div>

    <!-- ä¸­é—´æœç´¢ç»“æœåŒºåŸŸ -->
    <div class="search-results-area">
      <!-- æœç´¢å¤´éƒ¨ -->
      <div class="search-header">
        <div class="search-input-container">
          <el-input
            v-model="searchKeyword"
            :placeholder="$t('ai.knowledge.searchPlaceholder')"
            size="large"
            @keyup.enter="handleSearch"
            @input="handleSearchInput"
          >
            <template #prefix>
              <el-icon><Search /></el-icon>
            </template>
            <template #suffix>
              <el-button
                v-if="searchKeyword"
                text
                @click="clearSearch"
              >
                <el-icon><Close /></el-icon>
              </el-button>
            </template>
          </el-input>
        </div>
        
        <div class="search-actions">
          <el-button @click="handleSearch">
            <el-icon><Search /></el-icon>
            {{ $t('common.search') }}
          </el-button>
          <el-button @click="showFilters">
            <el-icon><Filter /></el-icon>
            {{ $t('common.filter') }}
          </el-button>
        </div>
      </div>

      <!-- ç­›é€‰æ¡ä»¶ -->
      <div v-if="showFilterPanel" class="filter-panel">
        <div class="filter-row">
          <div class="filter-item">
            <label>{{ $t('ai.knowledge.documentType') }}</label>
            <el-select v-model="filters.type" clearable>
              <el-option label="å…¨éƒ¨" value="" />
              <el-option label="PDF" value="pdf" />
              <el-option label="Word" value="docx" />
              <el-option label="Markdown" value="md" />
              <el-option label="æ–‡æœ¬" value="txt" />
            </el-select>
          </div>
          <div class="filter-item">
            <label>{{ $t('ai.knowledge.timeRange') }}</label>
            <el-date-picker
              v-model="filters.dateRange"
              type="daterange"
              :range-separator="$t('common.to')"
              :start-placeholder="$t('common.startDate')"
              :end-placeholder="$t('common.endDate')"
            />
          </div>
          <div class="filter-item">
            <el-button @click="applyFilters">{{ $t('common.apply') }}</el-button>
            <el-button @click="resetFilters">{{ $t('common.reset') }}</el-button>
          </div>
        </div>
      </div>

      <!-- æœç´¢ç»“æœ -->
      <div class="search-results">
        <div v-if="searching" class="search-loading">
          <el-icon class="is-loading"><Loading /></el-icon>
          <span>{{ $t('ai.knowledge.searching') }}</span>
        </div>

        <div v-else-if="searchResults.length === 0 && searchKeyword" class="no-results">
          <div class="no-results-icon">ğŸ”</div>
          <div class="no-results-title">{{ $t('ai.knowledge.noResults') }}</div>
          <div class="no-results-subtitle">{{ $t('ai.knowledge.tryDifferentKeywords') }}</div>
        </div>

        <div v-else-if="searchResults.length === 0" class="empty-state">
          <div class="empty-icon">ğŸ“š</div>
          <div class="empty-title">{{ $t('ai.knowledge.welcome') }}</div>
          <div class="empty-subtitle">{{ $t('ai.knowledge.searchHint') }}</div>
        </div>

        <div v-else class="results-list">
          <div
            v-for="result in searchResults"
            :key="result.id"
            class="result-item"
            @click="selectDocument(result)"
          >
            <div class="result-header">
              <div class="result-title">{{ result.title }}</div>
              <div class="result-type">
                <el-tag :type="getTypeTagType(result.type)" size="small">
                  {{ result.type.toUpperCase() }}
                </el-tag>
              </div>
            </div>
            
            <div class="result-content">
              <div class="result-summary">{{ result.summary }}</div>
              <div class="result-highlights" v-if="result.highlights">
                <div
                  v-for="highlight in result.highlights"
                  :key="highlight"
                  class="highlight-item"
                  v-html="highlight"
                ></div>
              </div>
            </div>
            
            <div class="result-meta">
              <div class="result-source">
                <el-icon><Document /></el-icon>
                <span>{{ result.source }}</span>
              </div>
              <div class="result-time">{{ formatTime(result.updatedAt) }}</div>
              <div class="result-score">
                <el-icon><Star /></el-icon>
                <span>{{ Math.round(result.score * 100) }}%</span>
              </div>
            </div>
          </div>
        </div>

        <!-- åˆ†é¡µ -->
        <BasePagination
          v-if="searchResults.length > 0"
          :current="pagination.current"
          :size="pagination.size"
          :total="pagination.total"
          @change="handlePageChange"
          @size-change="handlePageSizeChange"
        />
      </div>
    </div>

    <!-- å³ä¾§AIå¯¹è¯åŒºåŸŸ - ä¸AIå¯¹è¯é¡µé¢å®Œå…¨ä¸€è‡´ -->
    <div class="chat-sidebar">
      <div class="chat-header">
        <div class="chat-title-header">
          {{ $t('ai.knowledge.aiAssistant') }}
        </div>
        <div class="chat-actions">
          <el-button text @click="clearChatMessages">
            <el-icon><Delete /></el-icon>
            {{ $t('ai.chat.clear') }}
          </el-button>
        </div>
      </div>

      <!-- æ¶ˆæ¯åŒºåŸŸ - ä¸AIå¯¹è¯é¡µé¢å®Œå…¨ä¸€è‡´ -->
      <div class="messages-container" ref="messagesContainer">
        <div v-if="chatMessages.length === 0" class="empty-chat-message">
          <div class="empty-icon">ğŸ¤–</div>
          <div class="empty-title">{{ $t('ai.knowledge.chatWelcome') }}</div>
          <div class="empty-subtitle">{{ $t('ai.knowledge.chatHint') }}</div>
        </div>

        <div
          v-for="message in chatMessages"
          :key="message.id"
          class="message-item"
          :class="message.role"
        >
          <div class="message-avatar">
            <div v-if="message.role === 'user'" class="user-avatar">
              <el-icon><User /></el-icon>
            </div>
            <div v-else class="ai-avatar">
              <el-icon><Robot /></el-icon>
            </div>
          </div>
          
          <div class="message-content">
            <div class="message-header">
              <span class="message-role">
                {{ message.role === 'user' ? $t('ai.chat.user') : $t('ai.chat.assistant') }}
              </span>
              <span class="message-time">{{ formatTime(message.timestamp) }}</span>
            </div>
            
            <div class="message-body">
              <!-- æ–‡æœ¬å†…å®¹ -->
              <div v-if="message.contentType === 'text'" class="text-content">
                {{ message.content }}
              </div>
              
              <!-- Markdownå†…å®¹ -->
              <div v-else-if="message.contentType === 'markdown'" class="markdown-content">
                <div v-html="renderMarkdown(message.content)"></div>
              </div>
              
              <!-- ä»£ç å†…å®¹ -->
              <div v-else-if="message.contentType === 'code'" class="code-content">
                <div class="code-header">
                  <span class="code-language">{{ message.payload.language }}</span>
                  <el-button text size="small" @click="copyCode(message.payload.content)">
                    <el-icon><CopyDocument /></el-icon>
                    {{ $t('common.copy') }}
                  </el-button>
                </div>
                <pre><code :class="message.payload.language">{{ message.payload.content }}</code></pre>
              </div>
              
              <!-- æµå¼å“åº” -->
              <div v-if="message.streaming" class="streaming-indicator">
                <el-icon class="is-loading"><Loading /></el-icon>
                <span>{{ $t('ai.chat.thinking') }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- è¾“å…¥åŒºåŸŸ - ä¸AIå¯¹è¯é¡µé¢å®Œå…¨ä¸€è‡´ -->
      <div class="input-area">
        <div class="input-container">
          <div class="input-actions">
            <el-button text @click="toggleAttachment">
              <el-icon><Paperclip /></el-icon>
            </el-button>
          </div>
          
          <el-input
            v-model="chatInputMessage"
            type="textarea"
            :rows="1"
            :autosize="{ minRows: 1, maxRows: 6 }"
            :placeholder="$t('ai.knowledge.chatPlaceholder')"
            class="message-input"
            @keydown.enter.exact="handleChatSend"
            @keydown.enter.shift.exact="handleNewLine"
          />
          
          <el-button
            type="primary"
            class="send-button"
            :disabled="!chatInputMessage.trim() || isGenerating"
            :loading="isGenerating"
            @click="handleChatSend"
          >
            <el-icon v-if="!isGenerating"><Position /></el-icon>
            <el-icon v-else class="is-loading"><Loading /></el-icon>
          </el-button>
        </div>
        
        <div class="input-footer">
          <span class="input-tip">{{ $t('ai.knowledge.chatTip') }}</span>
        </div>
      </div>
    </div>
  </div>
</template>
```

### 2. æ ¸å¿ƒåŠŸèƒ½å®ç°
```javascript
<script setup>
import { ref, reactive, computed, onMounted, nextTick, watch } from 'vue'
import { useI18n } from 'vue-i18n'
import { ElMessage, ElMessageBox } from 'element-plus'
import {
  Search, Plus, MoreFilled, Close, Filter, Document, Star,
  Delete, User, Robot, CopyDocument, Loading, Paperclip, Position
} from '@element-plus/icons-vue'
import { BasePagination } from '@/components/Common'
import { searchDocuments, getKnowledgeBases, createKnowledgeBase, sendMessage } from '@/api/AI'
import { formatDate } from '@/utils/date'
import { createLogger } from '@/utils/simpleLogger'

const { t } = useI18n()
const logger = createLogger('KnowledgeBase')

// å“åº”å¼æ•°æ®
const messagesContainer = ref()
const kbSearchKeyword = ref('')
const searchKeyword = ref('')
const searching = ref(false)
const showFilterPanel = ref(false)
const currentKbId = ref(null)
const isGenerating = ref(false)

// çŸ¥è¯†åº“åˆ—è¡¨
const knowledgeBases = ref([])

// æœç´¢ç»“æœ
const searchResults = ref([])

// åˆ†é¡µ
const pagination = reactive({
  current: 1,
  size: 10,
  total: 0
})

// ç­›é€‰æ¡ä»¶
const filters = reactive({
  type: '',
  dateRange: []
})

// å¯¹è¯ç›¸å…³ - ä¸AIå¯¹è¯é¡µé¢å®Œå…¨ä¸€è‡´
const chatInputMessage = ref('')
const chatMessages = ref([])

// çŸ¥è¯†åº“ä¸æœç´¢ç»“æœå‡é€šè¿‡åç«¯æ¥å£è·å–ï¼ˆæ— æœ¬åœ°Mockï¼‰
// TODO: getKnowledgeBases / searchDocuments æ¥å£ç”±åç«¯æä¾›

// æ–¹æ³•
const loadKnowledgeBases = async () => {
  try {
    // TODO: è°ƒç”¨APIè·å–çŸ¥è¯†åº“åˆ—è¡¨
    // const response = await getKnowledgeBases()
    // knowledgeBases.value = response.data
    knowledgeBases.value = []
  } catch (error) {
    ElMessage.error(t('ai.knowledge.loadKbError'))
  }
}

const selectKnowledgeBase = (kbId) => {
  currentKbId.value = kbId
  // æ¸…ç©ºæœç´¢ç»“æœ
  searchResults.value = []
  searchKeyword.value = ''
}

const handleKbSearch = (keyword) => {
  // å®æ—¶æœç´¢çŸ¥è¯†åº“ï¼ˆå»ºè®®åç«¯æ”¯æŒå…³é”®è¯ç­›é€‰ï¼‰
  // TODO: getKnowledgeBases({ keyword }) å¹¶æ›´æ–° knowledgeBases
}

const handleSearch = async () => {
  if (!searchKeyword.value.trim()) {
    ElMessage.warning(t('ai.knowledge.enterKeyword'))
    return
  }
  
  searching.value = true
  
  try {
    // TODO: è°ƒç”¨APIæœç´¢æ–‡æ¡£
    // const response = await searchDocuments({
    //   keyword: searchKeyword.value,
    //   kbId: currentKbId.value,
    //   page: pagination.current,
    //   size: pagination.size,
    //   filters: filters
    // })
    // searchResults.value = response.data
    // pagination.total = response.total
    ElMessage.success(t('ai.knowledge.searchComplete'))
  } catch (error) {
    ElMessage.error(t('ai.knowledge.searchError'))
  } finally {
    searching.value = false
  }
}

const handleSearchInput = () => {
  // å®æ—¶æœç´¢å»ºè®®ï¼ˆå¯é€‰ï¼‰
}

const clearSearch = () => {
  searchKeyword.value = ''
  searchResults.value = []
  pagination.total = 0
}

const showFilters = () => {
  showFilterPanel.value = !showFilterPanel.value
}

const applyFilters = () => {
  pagination.current = 1
  handleSearch()
}

const resetFilters = () => {
  filters.type = ''
  filters.dateRange = []
  pagination.current = 1
  handleSearch()
}

const selectDocument = (document) => {
  // å°†æ–‡æ¡£å†…å®¹å‘é€åˆ°AIå¯¹è¯
  const message = `è¯·å¸®æˆ‘åˆ†æè¿™ä¸ªæ–‡æ¡£ï¼š${document.title}\n\n${document.summary}`
  chatInputMessage.value = message
  handleChatSend()
}

const getTypeTagType = (type) => {
  const typeMap = {
    pdf: 'danger',
    docx: 'primary',
    md: 'success',
    txt: 'info'
  }
  return typeMap[type] || 'info'
}

const handlePageChange = (page) => {
  pagination.current = page
  handleSearch()
}

const handlePageSizeChange = (size) => {
  pagination.size = size
  pagination.current = 1
  handleSearch()
}

const createKnowledgeBase = async () => {
  try {
    const { value: name } = await ElMessageBox.prompt(
      t('ai.knowledge.createKbTitle'),
      t('ai.knowledge.newKb'),
      {
        confirmButtonText: t('common.confirm'),
        cancelButtonText: t('common.cancel'),
        inputPlaceholder: t('ai.knowledge.kbNamePlaceholder')
      }
    )
    
    const newKb = {
      id: Date.now().toString(),
      name,
      description: t('ai.knowledge.newKbDesc'),
      documentCount: 0,
      updatedAt: new Date()
    }
    
    // TODO: è°ƒç”¨APIåˆ›å»ºçŸ¥è¯†åº“
    // await createKnowledgeBase(newKb)
    
    knowledgeBases.value.unshift(newKb)
    ElMessage.success(t('ai.knowledge.kbCreated'))
  } catch (error) {
    // ç”¨æˆ·å–æ¶ˆ
  }
}

const handleKbAction = async (action, kb) => {
  switch (action) {
    case 'edit':
      await editKnowledgeBase(kb)
      break
    case 'settings':
      await openKbSettings(kb)
      break
    case 'delete':
      await deleteKnowledgeBase(kb)
      break
  }
}

const editKnowledgeBase = async (kb) => {
  try {
    const { value: name } = await ElMessageBox.prompt(
      t('ai.knowledge.editKbTitle'),
      t('common.edit'),
      {
        confirmButtonText: t('common.confirm'),
        cancelButtonText: t('common.cancel'),
        inputValue: kb.name
      }
    )
    
    kb.name = name
    // TODO: è°ƒç”¨APIæ›´æ–°çŸ¥è¯†åº“
    // await updateKnowledgeBase(kb.id, { name })
    
    ElMessage.success(t('ai.knowledge.kbUpdated'))
  } catch (error) {
    // ç”¨æˆ·å–æ¶ˆ
  }
}

const openKbSettings = (kb) => {
  ElMessage.info(t('ai.knowledge.settingsComingSoon'))
}

const deleteKnowledgeBase = async (kb) => {
  try {
    await ElMessageBox.confirm(
      t('ai.knowledge.deleteKbConfirm'),
      t('common.confirm'),
      {
        confirmButtonText: t('common.confirm'),
        cancelButtonText: t('common.cancel'),
        type: 'warning'
      }
    )
    
    // TODO: è°ƒç”¨APIåˆ é™¤çŸ¥è¯†åº“
    // await deleteKnowledgeBase(kb.id)
    
    const index = knowledgeBases.value.findIndex(k => k.id === kb.id)
    if (index > -1) {
      knowledgeBases.value.splice(index, 1)
    }
    
    if (currentKbId.value === kb.id) {
      currentKbId.value = null
      searchResults.value = []
    }
    
    ElMessage.success(t('ai.knowledge.kbDeleted'))
  } catch (error) {
    // ç”¨æˆ·å–æ¶ˆ
  }
}

// AIå¯¹è¯ç›¸å…³æ–¹æ³• - ä¸AIå¯¹è¯é¡µé¢å®Œå…¨ä¸€è‡´
const handleChatSend = async () => {
  if (!chatInputMessage.value.trim() || isGenerating.value) return
  
  const userMessage = {
    id: Date.now().toString(),
    role: 'user',
    content: chatInputMessage.value,
    contentType: 'text',
    timestamp: new Date()
  }
  
  chatMessages.value.push(userMessage)
  const userInput = chatInputMessage.value
  chatInputMessage.value = ''
  
  await nextTick()
  scrollToBottom()
  
  await sendAIMessage(userInput)
}

const sendAIMessage = async (userInput) => {
  isGenerating.value = true
  
  const aiMessage = {
    id: Date.now().toString(),
    role: 'assistant',
    content: '',
    contentType: 'text',
    timestamp: new Date(),
    streaming: true
  }
  
  chatMessages.value.push(aiMessage)
  
  try {
    // TODO: è°ƒç”¨AIå¯¹è¯æ¥å£ï¼ˆæµå¼ï¼‰ï¼Œç»“åˆçŸ¥è¯†åº“ä¸Šä¸‹æ–‡
    // çº¦å®šï¼šsendMessageæ”¯æŒReadableStreamæˆ–SSEäº‹ä»¶ï¼š
    // { type: 'text' | 'markdown' | 'code' | 'image' | 'file' | 'metadata' | 'end' | 'error', payload }
    // ç¤ºä¾‹ï¼šFetch + ReadableStream
    // const stream = await sendMessage({ message: userInput, context: searchResults.value, kbId: currentKbId.value })
    // const reader = stream.getReader()
    // const decoder = new TextDecoder()
    // while (true) {
    //   const { value, done } = await reader.read()
    //   if (done) break
    //   const chunk = decoder.decode(value, { stream: true })
    //   for (const line of chunk.split('\n')) {
    //     if (!line) continue
    //     const event = JSON.parse(line)
    //     switch (event.type) {
    //       case 'text':
    //         aiMessage.content += event.payload
    //         break
    //       case 'markdown':
    //         aiMessage.contentType = 'markdown'
    //         aiMessage.content += event.payload
    //         break
    //       case 'code':
    //         aiMessage.contentType = 'code'
    //         aiMessage.payload = { ...(aiMessage.payload || {}), ...event.payload }
    //         break
    //       case 'image':
    //         // TODO: æ¸²æŸ“å›¾ç‰‡æ¶ˆæ¯
    //         break
    //       case 'file':
    //         // TODO: æ¸²æŸ“æ–‡ä»¶é™„ä»¶
    //         break
    //       case 'metadata':
    //         // TODO: å¤„ç†å…ƒä¿¡æ¯
    //         break
    //       case 'end':
    //         break
    //       case 'error':
    //         throw new Error(event.payload?.message || 'AI error')
    //     }
    //     await nextTick(); scrollToBottom()
    //   }
    // }
    
  } catch (error) {
    aiMessage.content = t('ai.chat.responseError')
    ElMessage.error(t('ai.chat.sendError'))
  } finally {
    aiMessage.streaming = false
    isGenerating.value = false
    await nextTick()
    scrollToBottom()
  }
}

// æµå¼å¤„ç†ç”±sendMessageå®ç°ï¼Œå‰ç«¯æŒ‰äº‹ä»¶ç±»å‹å¢é‡æ¸²æŸ“ï¼ˆè§ä¸Šæ–¹TODOç¤ºä¾‹ï¼‰

const clearChatMessages = async () => {
  try {
    await ElMessageBox.confirm(
      t('ai.chat.clearConfirm'),
      t('common.confirm'),
      {
        confirmButtonText: t('common.confirm'),
        cancelButtonText: t('common.cancel'),
        type: 'warning'
      }
    )
    
    chatMessages.value = []
    ElMessage.success(t('ai.chat.cleared'))
  } catch (error) {
    // ç”¨æˆ·å–æ¶ˆ
  }
}

const copyCode = async (code) => {
  try {
    await navigator.clipboard.writeText(code)
    ElMessage.success(t('common.copied'))
  } catch (error) {
    ElMessage.error(t('common.copyError'))
  }
}

const renderMarkdown = (content) => {
  // TODO: å®ç°Markdownæ¸²æŸ“
  return content.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
    .replace(/\*(.*?)\*/g, '<em>$1</em>')
    .replace(/`(.*?)`/g, '<code>$1</code>')
}

const scrollToBottom = () => {
  if (messagesContainer.value) {
    messagesContainer.value.scrollTop = messagesContainer.value.scrollHeight
  }
}

const formatTime = (date) => {
  return new Date(date).toLocaleTimeString('zh-CN', {
    hour: '2-digit',
    minute: '2-digit'
  })
}

const handleNewLine = () => {
  // Shift+Enter æ¢è¡Œï¼Œä¸å‘é€
}

const toggleAttachment = () => {
  ElMessage.info(t('ai.chat.attachmentComingSoon'))
}

// ç›‘å¬æ¶ˆæ¯å˜åŒ–ï¼Œè‡ªåŠ¨æ»šåŠ¨
watch(chatMessages, () => {
  nextTick(() => {
    scrollToBottom()
  })
}, { deep: true })

onMounted(() => {
  loadKnowledgeBases()
})
</script>
```

### 3. æ ·å¼å®ç°
```scss
<style lang="scss" scoped>
.knowledge-base-container {
  display: flex;
  height: 100vh;
  background: #f7f9fc;
}

/* å·¦ä¾§çŸ¥è¯†åº“åˆ—è¡¨ */
.kb-list-sidebar {
  width: 280px;
  background: #ffffff;
  border-right: 1px solid #e5e7eb;
  display: flex;
  flex-direction: column;
  flex-shrink: 0;
}

.kb-list-header {
  padding: 16px;
  border-bottom: 1px solid #f3f4f6;
}

.search-input-wrap {
  margin-bottom: 12px;
}

.new-kb-btn {
  width: 100%;
  background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
  color: white;
  border: none;
  border-radius: 8px;
  padding: 12px 16px;
  font-weight: 500;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  transition: all 0.2s;
  
  &:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
  }
}

.kb-list {
  flex: 1;
  overflow-y: auto;
  padding: 8px;
}

.kb-item {
  display: flex;
  align-items: center;
  padding: 12px;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
  margin-bottom: 4px;
  
  &:hover {
    background: #f8fafc;
  }
  
  &.active {
    background: #eff6ff;
    border: 1px solid #dbeafe;
  }
}

.kb-item-content {
  flex: 1;
  min-width: 0;
}

.kb-title {
  font-weight: 500;
  color: #111827;
  font-size: 14px;
  margin-bottom: 4px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.kb-desc {
  color: #6b7280;
  font-size: 12px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  margin-bottom: 4px;
}

.kb-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 11px;
  color: #9ca3af;
}

.kb-item-actions {
  opacity: 0;
  transition: opacity 0.2s;
}

.kb-item:hover .kb-item-actions {
  opacity: 1;
}

.kb-more-btn {
  padding: 4px;
  color: #6b7280;
  
  &:hover {
    color: #374151;
    background: #f3f4f6;
  }
}

/* ä¸­é—´æœç´¢ç»“æœåŒºåŸŸ */
.search-results-area {
  flex: 1;
  display: flex;
  flex-direction: column;
  background: #ffffff;
  border-right: 1px solid #e5e7eb;
}

.search-header {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 16px 20px;
  border-bottom: 1px solid #f3f4f6;
  background: #fafbfc;
}

.search-input-container {
  flex: 1;
}

.search-actions {
  display: flex;
  gap: 8px;
}

.filter-panel {
  padding: 16px 20px;
  background: #f8fafc;
  border-bottom: 1px solid #e5e7eb;
}

.filter-row {
  display: flex;
  align-items: center;
  gap: 16px;
}

.filter-item {
  display: flex;
  align-items: center;
  gap: 8px;
  
  label {
    font-size: 14px;
    color: #374151;
    white-space: nowrap;
  }
}

.search-results {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
}

.search-loading {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 40px;
  color: #6b7280;
  font-size: 14px;
  
  .el-icon {
    margin-right: 8px;
    font-size: 16px;
  }
}

.no-results,
.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  text-align: center;
}

.no-results-icon,
.empty-icon {
  font-size: 64px;
  margin-bottom: 16px;
}

.no-results-title,
.empty-title {
  font-size: 20px;
  font-weight: 600;
  color: #111827;
  margin-bottom: 8px;
}

.no-results-subtitle,
.empty-subtitle {
  color: #6b7280;
  margin-bottom: 32px;
}

.results-list {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.result-item {
  padding: 16px;
  background: #ffffff;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
  
  &:hover {
    border-color: #dbeafe;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    transform: translateY(-1px);
  }
}

.result-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 8px;
}

.result-title {
  font-size: 16px;
  font-weight: 600;
  color: #111827;
  flex: 1;
  margin-right: 12px;
}

.result-type {
  flex-shrink: 0;
}

.result-content {
  margin-bottom: 12px;
}

.result-summary {
  color: #6b7280;
  font-size: 14px;
  line-height: 1.6;
  margin-bottom: 8px;
}

.result-highlights {
  .highlight-item {
    background: #fef3c7;
    padding: 2px 4px;
    border-radius: 4px;
    margin: 2px 0;
    font-size: 13px;
    
    :deep(mark) {
      background: #fbbf24;
      color: #92400e;
      padding: 1px 2px;
      border-radius: 2px;
    }
  }
}

.result-meta {
  display: flex;
  align-items: center;
  gap: 16px;
  font-size: 12px;
  color: #9ca3af;
}

.result-source {
  display: flex;
  align-items: center;
  gap: 4px;
}

.result-score {
  display: flex;
  align-items: center;
  gap: 4px;
  color: #f59e0b;
}

/* å³ä¾§AIå¯¹è¯åŒºåŸŸ - ä¸AIå¯¹è¯é¡µé¢å®Œå…¨ä¸€è‡´ */
.chat-sidebar {
  width: 320px;
  background: #ffffff;
  display: flex;
  flex-direction: column;
  flex-shrink: 0;
}

.chat-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 20px;
  border-bottom: 1px solid #f3f4f6;
  background: #fafbfc;
}

.chat-title-header {
  font-size: 16px;
  font-weight: 600;
  color: #111827;
}

.chat-actions {
  display: flex;
  gap: 8px;
}

.messages-container {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  background: #ffffff;
}

.empty-chat-message {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  text-align: center;
}

.empty-icon {
  font-size: 48px;
  margin-bottom: 16px;
}

.empty-title {
  font-size: 18px;
  font-weight: 600;
  color: #111827;
  margin-bottom: 8px;
}

.empty-subtitle {
  color: #6b7280;
  font-size: 14px;
}

.message-item {
  display: flex;
  margin-bottom: 16px;
  gap: 8px;
  
  &.user {
    flex-direction: row-reverse;
    
    .message-content {
      background: #eff6ff;
      border: 1px solid #dbeafe;
    }
  }
  
  &.assistant {
    .message-content {
      background: #ffffff;
      border: 1px solid #e5e7eb;
    }
  }
}

.message-avatar {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  
  .user-avatar {
    background: #3b82f6;
    color: white;
  }
  
  .ai-avatar {
    background: #10b981;
    color: white;
  }
}

.message-content {
  max-width: 80%;
  padding: 8px 12px;
  border-radius: 8px;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

.message-header {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 4px;
}

.message-role {
  font-size: 11px;
  font-weight: 500;
  color: #6b7280;
}

.message-time {
  font-size: 10px;
  color: #9ca3af;
}

.message-body {
  line-height: 1.5;
  color: #374151;
  font-size: 13px;
}

.text-content {
  white-space: pre-wrap;
  word-break: break-word;
}

.markdown-content {
  :deep(h1), :deep(h2), :deep(h3) {
    margin: 8px 0 4px 0;
    color: #111827;
    font-size: 14px;
  }
  
  :deep(p) {
    margin: 4px 0;
  }
  
  :deep(code) {
    background: #f3f4f6;
    padding: 1px 3px;
    border-radius: 3px;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 12px;
  }
  
  :deep(ul), :deep(ol) {
    margin: 4px 0;
    padding-left: 16px;
  }
  
  :deep(li) {
    margin: 2px 0;
  }
}

.code-content {
  background: #1f2937;
  border-radius: 6px;
  overflow: hidden;
  margin: 4px 0;
}

.code-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 6px 8px;
  background: #374151;
  border-bottom: 1px solid #4b5563;
}

.code-language {
  color: #d1d5db;
  font-size: 10px;
  font-weight: 500;
}

.code-content pre {
  margin: 0;
  padding: 12px;
  overflow-x: auto;
  background: #1f2937;
  
  code {
    color: #f9fafb;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 12px;
    line-height: 1.4;
  }
}

.streaming-indicator {
  display: flex;
  align-items: center;
  gap: 6px;
  color: #6b7280;
  font-size: 12px;
  font-style: italic;
}

.input-area {
  padding: 16px;
  background: #fafbfc;
  border-top: 1px solid #f3f4f6;
}

.input-container {
  display: flex;
  align-items: flex-end;
  gap: 8px;
  background: #ffffff;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  padding: 8px;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

.input-actions {
  display: flex;
  gap: 4px;
  margin-bottom: 6px;
}

.message-input {
  flex: 1;
  
  :deep(.el-textarea__inner) {
    border: none;
    box-shadow: none;
    resize: none;
    font-size: 13px;
    line-height: 1.4;
    
    &:focus {
      box-shadow: none;
    }
  }
}

.send-button {
  width: 32px;
  height: 32px;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.input-footer {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-top: 6px;
}

.input-tip {
  font-size: 11px;
  color: #9ca3af;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 1200px) {
  .chat-sidebar {
    width: 280px;
  }
}

@media (max-width: 768px) {
  .knowledge-base-container {
    flex-direction: column;
  }
  
  .kb-list-sidebar {
    width: 100%;
    height: 200px;
    border-right: none;
    border-bottom: 1px solid #e5e7eb;
  }
  
  .search-results-area {
    height: calc(100vh - 200px - 300px);
  }
  
  .chat-sidebar {
    width: 100%;
    height: 300px;
    border-top: 1px solid #e5e7eb;
  }
  
  .result-item {
    padding: 12px;
  }
  
  .message-content {
    max-width: 85%;
  }
}
</style>
```

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

1. **ä¸‰æ å¸ƒå±€**ï¼šå·¦ä¾§çŸ¥è¯†åº“åˆ—è¡¨ + ä¸­é—´æœç´¢ç»“æœ + å³ä¾§AIå¯¹è¯
2. **AIå¯¹è¯ä¸€è‡´æ€§**ï¼šå³ä¾§å¯¹è¯åŒºåŸŸä¸AIå¯¹è¯é¡µé¢å®Œå…¨ä¸€è‡´ï¼ŒåŒ…æ‹¬ï¼š
   - æ¶ˆæ¯æ˜¾ç¤ºæ ¼å¼
   - æµå¼å“åº”æ•ˆæœ
   - ä»£ç é«˜äº®
   - Markdownæ¸²æŸ“
   - è¾“å…¥äº¤äº’
3. **çŸ¥è¯†åº“æœç´¢**ï¼šæ”¯æŒå®æ—¶æœç´¢ã€ç­›é€‰ã€åˆ†é¡µ
4. **æ–‡æ¡£å…³è”**ï¼šç‚¹å‡»æœç´¢ç»“æœå¯ç›´æ¥å‘é€åˆ°AIå¯¹è¯
5. **å“åº”å¼è®¾è®¡**ï¼šç§»åŠ¨ç«¯é€‚é…ï¼Œæ”¯æŒä¸‰æ å˜å•æ å¸ƒå±€
6. **å›½é™…åŒ–æ”¯æŒ**ï¼šæ‰€æœ‰æ–‡æœ¬ä½¿ç”¨$t()å‡½æ•°
7. **Mockæ•°æ®**ï¼šåŒ…å«TODOæ³¨é‡Šï¼Œä¾¿äºåç«¯é›†æˆ

**æœ€ç»ˆè¦æ±‚ï¼šç”Ÿæˆçš„ä»£ç å¿…é¡»ä¸åŸå‹å›¾çš„è§†è§‰æ•ˆæœå’Œäº¤äº’é€»è¾‘å®Œå…¨ä¸€è‡´ï¼Œç‰¹åˆ«æ˜¯AIå¯¹è¯éƒ¨åˆ†è¦ä¸AIå¯¹è¯é¡µé¢ä¿æŒå®Œå…¨ä¸€è‡´ï¼**
