# 报告生成页面开发提示词

## 📋 页面信息
- **原型图路径**：`原型图/验收模块/报告生成.html`
- **页面类型**：表单页面
- **页面名称**：报告生成
- **主要功能**：报告配置、生成过程监控、报告预览编辑
- **对应文件路径**：`src/views/Report/Generate.vue`

## 🎨 原型图视觉分析

### **整体布局**
- 背景色：`#f7f9fc`
- 容器：`padding: 20px`，`min-height: calc(100vh - 56px)`
- 页面标题：`font-size: 24px`，`color: #1e3a8a`，`font-weight: 600`

### **配置区域**
- 白色卡片：`background: #ffffff`，`border-radius: 8px`，`padding: 24px`
- 表单布局：`display: grid`，`grid-template-columns: repeat(2, 1fr)`，`gap: 20px`
- 表单项：`margin-bottom: 20px`
- 标签样式：`font-weight: 600`，`color: #374151`

### **生成过程区域**
- 进度条：`height: 8px`，`border-radius: 4px`，`background: #e5e7eb`
- 进度文本：`font-size: 14px`，`color: #6b7280`
- 消息列表：`max-height: 200px`，`overflow-y: auto`
- 消息项：`padding: 8px 12px`，`border-radius: 4px`，`margin-bottom: 4px`

### **预览区域**
- 预览容器：`background: #ffffff`，`border-radius: 8px`，`padding: 24px`
- 工具栏：`display: flex`，`justify-content: space-between`，`align-items: center`
- 编辑器：`min-height: 400px`，`border: 1px solid #e5e7eb`
- 操作按钮：`display: flex`，`gap: 8px`

## 🔧 技术实现要求

### 1. 页面结构
```vue
<template>
  <div class="report-generate-container">
    <!-- 页面头部 -->
    <div class="page-header">
      <div class="header-left">
        <el-button @click="handleBack" class="back-button">
          <el-icon><ArrowLeft /></el-icon>
          {{ $t('common.back') }}
        </el-button>
        <h1 class="page-title">{{ $t('report.generate.title') }}</h1>
      </div>
    </div>

    <div class="content-grid">
      <!-- 配置区域 -->
      <BaseCard class="config-card">
        <template #header>
          <div class="card-header">
            <h3>{{ $t('report.generate.configTitle') }}</h3>
            <el-tag v-if="isGenerating" type="warning" effect="dark">
              {{ $t('report.generate.generating') }}
            </el-tag>
          </div>
        </template>

        <el-form
          ref="configFormRef"
          :model="configForm"
          :rules="configRules"
          label-width="120px"
          class="config-form"
        >
          <el-form-item :label="$t('report.generate.project')" prop="projectId">
            <el-select
              v-model="configForm.projectId"
              :placeholder="$t('report.generate.selectProject')"
              style="width: 100%"
              :disabled="isGenerating"
              @change="handleProjectChange"
            >
              <el-option
                v-for="project in projects"
                :key="project.id"
                :label="project.name"
                :value="project.id"
              >
                <div class="project-option">
                  <span class="project-name">{{ project.name }}</span>
                  <span class="project-code">{{ project.code }}</span>
                </div>
              </el-option>
            </el-select>
          </el-form-item>

          <el-form-item :label="$t('report.generate.workflow')" prop="workflowId">
            <el-select
              v-model="configForm.workflowId"
              :placeholder="$t('report.generate.selectWorkflow')"
              style="width: 100%"
              :disabled="isGenerating"
              @change="handleWorkflowChange"
            >
              <el-option
                v-for="workflow in workflows"
                :key="workflow.id"
                :label="workflow.name"
                :value="workflow.id"
              >
                <div class="workflow-option">
                  <span class="workflow-name">{{ workflow.name }}</span>
                  <span class="workflow-desc">{{ workflow.description }}</span>
                </div>
              </el-option>
            </el-select>
          </el-form-item>

          <el-form-item :label="$t('report.generate.reportType')" prop="reportType">
            <el-radio-group v-model="configForm.reportType" :disabled="isGenerating">
              <el-radio value="tech">{{ $t('report.types.tech') }}</el-radio>
              <el-radio value="self">{{ $t('report.types.self') }}</el-radio>
            </el-radio-group>
          </el-form-item>

          <el-form-item :label="$t('report.generate.template')" prop="templateId">
            <el-select
              v-model="configForm.templateId"
              :placeholder="$t('report.generate.selectTemplate')"
              style="width: 100%"
              :disabled="isGenerating"
            >
              <el-option
                v-for="template in templates"
                :key="template.id"
                :label="template.name"
                :value="template.id"
              >
                <div class="template-option">
                  <span class="template-name">{{ template.name }}</span>
                  <span class="template-desc">{{ template.description }}</span>
                </div>
              </el-option>
            </el-select>
          </el-form-item>

          <!-- 高级配置 -->
          <el-collapse v-model="advancedConfigOpen" class="advanced-config">
            <el-collapse-item :title="$t('report.generate.advancedConfig')" name="advanced">
              <el-form-item :label="$t('report.generate.wordCount')">
                <el-input-number
                  v-model="configForm.wordCount"
                  :min="1000"
                  :max="50000"
                  :step="500"
                  :disabled="isGenerating"
                  style="width: 100%"
                />
              </el-form-item>

              <el-form-item :label="$t('report.generate.includeCharts')">
                <el-switch
                  v-model="configForm.includeCharts"
                  :disabled="isGenerating"
                />
              </el-form-item>

              <el-form-item :label="$t('report.generate.includeImages')">
                <el-switch
                  v-model="configForm.includeImages"
                  :disabled="isGenerating"
                />
              </el-form-item>

              <el-form-item :label="$t('report.generate.customPrompt')">
                <el-input
                  v-model="configForm.customPrompt"
                  type="textarea"
                  :rows="3"
                  :placeholder="$t('report.generate.customPromptPlaceholder')"
                  :disabled="isGenerating"
                />
              </el-form-item>
            </el-collapse-item>
          </el-collapse>

          <el-form-item class="form-actions">
            <el-button
              type="primary"
              size="large"
              :loading="isGenerating"
              :disabled="!canGenerate"
              @click="handleGenerate"
            >
              <el-icon v-if="!isGenerating"><Magic /></el-icon>
              {{ isGenerating ? $t('report.generate.generating') : $t('report.generate.startGenerate') }}
            </el-button>
            <el-button
              v-if="isGenerating"
              type="danger"
              size="large"
              @click="handleStopGenerate"
            >
              <el-icon><Close /></el-icon>
              {{ $t('report.generate.stopGenerate') }}
            </el-button>
          </el-form-item>
        </el-form>
      </BaseCard>

      <!-- 生成过程区域 -->
      <BaseCard v-if="isGenerating || generateProgress > 0" class="process-card">
        <template #header>
          <h3>{{ $t('report.generate.processTitle') }}</h3>
        </template>

        <div class="progress-section">
          <div class="progress-info">
            <span class="progress-text">
              {{ $t('report.generate.progress', { 
                current: Math.round(generateProgress), 
                total: 100 
              }) }}
            </span>
            <span class="progress-status">{{ currentStatus }}</span>
          </div>
          <el-progress
            :percentage="generateProgress"
            :status="generateProgress === 100 ? 'success' : 'active'"
            :stroke-width="8"
            :show-text="false"
          />
        </div>

        <div class="messages-section">
          <h4>{{ $t('report.generate.messages') }}</h4>
          <div class="messages-list">
            <div
              v-for="(message, index) in generateMessages"
              :key="index"
              class="message-item"
              :class="message.type"
            >
              <el-icon class="message-icon">
                <InfoFilled v-if="message.type === 'info'" />
                <SuccessFilled v-else-if="message.type === 'success'" />
                <WarningFilled v-else-if="message.type === 'warning'" />
                <CircleCloseFilled v-else-if="message.type === 'error'" />
              </el-icon>
              <span class="message-text">{{ message.text }}</span>
              <span class="message-time">{{ formatTime(message.timestamp) }}</span>
            </div>
          </div>
        </div>
      </BaseCard>

      <!-- 预览区域 -->
      <BaseCard v-if="reportContent" class="preview-card">
        <template #header>
          <div class="preview-header">
            <h3>{{ $t('report.generate.previewTitle') }}</h3>
            <div class="preview-actions">
              <el-button size="small" @click="toggleEditMode">
                <el-icon><Edit /></el-icon>
                {{ isEditMode ? $t('common.preview') : $t('common.edit') }}
              </el-button>
              <el-button size="small" type="primary" @click="handleSave">
                <el-icon><Check /></el-icon>
                {{ $t('common.save') }}
              </el-button>
              <el-dropdown @command="(format) => handleDownload(format)" trigger="click">
                <el-button size="small" type="primary">
                  <el-icon><Download /></el-icon>
                  {{ $t('common.download') }}
                  <el-icon class="el-icon--right"><ArrowDown /></el-icon>
                </el-button>
                <template #dropdown>
                  <el-dropdown-menu>
                    <el-dropdown-item command="pdf">PDF</el-dropdown-item>
                    <el-dropdown-item command="word">Word</el-dropdown-item>
                    <el-dropdown-item command="markdown">Markdown</el-dropdown-item>
                  </el-dropdown-menu>
                </template>
              </el-dropdown>
              <el-button size="small" type="success" @click="handleRegenerate">
                <el-icon><Refresh /></el-icon>
                {{ $t('report.generate.regenerate') }}
              </el-button>
            </div>
          </div>
        </template>

        <div class="preview-content">
          <!-- 编辑模式 -->
          <div v-if="isEditMode" class="editor-container">
            <el-input
              v-model="reportContent"
              type="textarea"
              :rows="20"
              :placeholder="$t('report.generate.editPlaceholder')"
              class="content-editor"
            />
          </div>

          <!-- 预览模式 -->
          <div v-else class="preview-container">
            <div class="report-preview" v-html="reportContent"></div>
          </div>
        </div>
      </BaseCard>
    </div>
  </div>
</template>
```

### 2. 核心功能实现
```javascript
<script setup>
import { ref, reactive, computed, onMounted, nextTick } from 'vue'
import { useRouter } from 'vue-router'
import { useI18n } from 'vue-i18n'
import { ElMessage, ElMessageBox } from 'element-plus'
import {
  ArrowLeft, Magic, Close, Edit, Check, Download, ArrowDown, Refresh,
  InfoFilled, SuccessFilled, WarningFilled, CircleCloseFilled
} from '@element-plus/icons-vue'
import { BaseCard } from '@/components/Common'
import { generateReport, downloadReport, saveReport, getProjects, getWorkflows, getTemplates } from '@/api/Report'
import { formatDate } from '@/utils/date'
import { STATUS_CONFIG } from '@/utils/constants'
import { validateReportWordCount } from '@/utils/validate'

const router = useRouter()
const { t } = useI18n()
const logger = createLogger('ReportGenerate')

// 响应式数据
const configFormRef = ref()
const isGenerating = ref(false)
const generateProgress = ref(0)
const currentStatus = ref('')
const generateMessages = ref([])
const reportContent = ref('')
const isEditMode = ref(false)
const advancedConfigOpen = ref([])

// 配置表单
const configForm = reactive({
  projectId: '',
  workflowId: '',
  reportType: 'tech',
  templateId: '',
  wordCount: 5000,
  includeCharts: true,
  includeImages: true,
  customPrompt: ''
})

// 表单验证规则
const configRules = {
  projectId: [
    { required: true, message: t('report.generate.projectRequired'), trigger: 'change' }
  ],
  workflowId: [
    { required: true, message: t('report.generate.workflowRequired'), trigger: 'change' }
  ],
  reportType: [
    { required: true, message: t('report.generate.reportTypeRequired'), trigger: 'change' }
  ],
  templateId: [
    { required: true, message: t('report.generate.templateRequired'), trigger: 'change' }
  ],
  wordCount: [
    { 
      validator: (rule, value, callback) => {
        if (!validateReportWordCount(value)) {
          callback(new Error(t('report.generate.wordCountFormat')))
        } else {
          callback()
        }
      }, 
      trigger: 'blur' 
    }
  ]
}

// 数据源（通过接口获取）
const projects = ref([])
const workflows = ref([])
const templates = ref([])

// 计算属性
const canGenerate = computed(() => {
  return configForm.projectId && 
         configForm.workflowId && 
         configForm.reportType && 
         configForm.templateId &&
         !isGenerating.value
})

// 方法
const handleBack = () => {
  if (isGenerating.value) {
    ElMessageBox.confirm(
      t('report.generate.backConfirm'),
      t('common.confirm'),
      {
        confirmButtonText: t('common.confirm'),
        cancelButtonText: t('common.cancel'),
        type: 'warning'
      }
    ).then(() => {
      router.push('/report/list')
    }).catch(() => {
      // 用户取消
    })
  } else {
    router.push('/report/list')
  }
}

const handleProjectChange = (projectId) => {
  const project = projects.value.find(p => p.id === projectId)
  if (project) {
    ElMessage.success(t('report.generate.projectSelected', { name: project.name }))
  }
}

const handleWorkflowChange = (workflowId) => {
  const workflow = workflows.value.find(w => w.id === workflowId)
  if (workflow) {
    ElMessage.success(t('report.generate.workflowSelected', { name: workflow.name }))
  }
}

const handleGenerate = async () => {
  try {
    await configFormRef.value.validate()
    
    isGenerating.value = true
    generateProgress.value = 0
    generateMessages.value = []
    reportContent.value = ''
    
    // 添加开始消息
    addMessage('info', t('report.generate.startMessage'))
    
    // TODO: 替换为实际后端接口
    // const { data } = await generateReport({
    //   projectId: configForm.projectId,
    //   workflowId: configForm.workflowId,
    //   reportType: configForm.reportType,
    //   templateId: configForm.templateId,
    //   wordCount: configForm.wordCount,
    //   includeCharts: configForm.includeCharts,
    //   includeImages: configForm.includeImages,
    //   customPrompt: configForm.customPrompt
    // })
    // reportContent.value = data.content
    // isGenerating.value = false
    // addMessage('success', t('report.generate.generateSuccess'))
    
    ElMessage.success(t('report.generate.generateSuccess'))
  } catch (error) {
    ElMessage.error(t('report.generate.generateError'))
  }
}


const addMessage = (type, text) => {
  generateMessages.value.push({
    type,
    text,
    timestamp: new Date()
  })
  
  // 限制消息数量
  if (generateMessages.value.length > 50) {
    generateMessages.value.shift()
  }
}

const handleStopGenerate = async () => {
  try {
    await ElMessageBox.confirm(
      t('report.generate.stopConfirm'),
      t('common.confirm'),
      {
        confirmButtonText: t('common.confirm'),
        cancelButtonText: t('common.cancel'),
        type: 'warning'
      }
    )
    
    isGenerating.value = false
    addMessage('warning', t('report.generate.stopped'))
    ElMessage.info(t('report.generate.stopped'))
  } catch (error) {
    // 用户取消
  }
}

const toggleEditMode = () => {
  isEditMode.value = !isEditMode.value
  ElMessage.info(
    isEditMode.value 
      ? t('report.generate.editModeOn') 
      : t('report.generate.editModeOff')
  )
}

const handleSave = async () => {
  try {
    // TODO: 实现保存功能（后端接口：保存报告内容）
    // await saveReport({
    //   projectId: configForm.projectId,
    //   content: reportContent.value,
    //   type: configForm.reportType
    // })
    
    ElMessage.success(t('report.generate.saveSuccess'))
  } catch (error) {
    ElMessage.error(t('report.generate.saveError'))
  }
}

const handleDownload = async (format) => {
  try {
    ElMessage.info(t('report.generate.downloading', { format: format.toUpperCase() }))
    
    // TODO: 实现下载功能（后端接口：导出指定格式报告）
    // await downloadReport({
    //   content: reportContent.value,
    //   format: format,
    //   projectId: configForm.projectId
    // })
    
    ElMessage.success(t('report.generate.downloadSuccess', { format: format.toUpperCase() }))
  } catch (error) {
    ElMessage.error(t('report.generate.downloadError'))
  }
}

const handleRegenerate = async () => {
  try {
    await ElMessageBox.confirm(
      t('report.generate.regenerateConfirm'),
      t('common.confirm'),
      {
        confirmButtonText: t('common.confirm'),
        cancelButtonText: t('common.cancel'),
        type: 'warning'
      }
    )
    
    reportContent.value = ''
    isEditMode.value = false
    await handleGenerate()
  } catch (error) {
    // 用户取消
  }
}

// 工具函数
const formatTime = (date) => {
  return date.toLocaleTimeString('zh-CN', { 
    hour: '2-digit', 
    minute: '2-digit', 
    second: '2-digit' 
  })
}

onMounted(() => {
  // 初始化数据
  loadProjects()
  loadWorkflows()
  loadTemplates()
  ElMessage.info(t('report.generate.welcomeMessage'))
})

// 数据加载方法
const loadProjects = async () => {
  try {
    // TODO: 替换为实际后端接口
    // const { data } = await getProjects()
    // projects.value = data

    // 临时模拟数据（后端开发完成后删除）
    // projects.value = [
    //   {
    //     id: '1',
    //     name: '基于深度学习的图像识别技术研究',
    //     code: 'AI2024001',
    //     description: '人工智能研究项目'
    //   },
    //   {
    //     id: '2',
    //     name: '智能物联网系统关键技术研发',
    //     code: 'IOT2024002',
    //     description: '物联网技术项目'
    //   }
    // ]
  } catch (error) {
    ElMessage.error(t('report.generate.loadProjectsError'))
  }
}

const loadWorkflows = async () => {
  try {
    // TODO: 替换为实际后端接口
    // const { data } = await getWorkflows()
    // workflows.value = data

    // 临时模拟数据（后端开发完成后删除）
    // workflows.value = [
    //   {
    //     id: '1',
    //     name: '标准科技报告流程',
    //     description: '适用于一般科技项目的标准报告生成流程'
    //   },
    //   {
    //     id: '2',
    //     name: '自评报告流程',
    //     description: '适用于项目自评的简化报告生成流程'
    //   }
    // ]
  } catch (error) {
    ElMessage.error(t('report.generate.loadWorkflowsError'))
  }
}

const loadTemplates = async () => {
  try {
    // TODO: 替换为实际后端接口
    // const { data } = await getTemplates()
    // templates.value = data

    // 临时模拟数据（后端开发完成后删除）
    // templates.value = [
    //   {
    //     id: '1',
    //     name: '科技报告标准模板',
    //     description: '包含项目概述、技术方案、实施过程、成果展示等章节'
    //   },
    //   {
    //     id: '2',
    //     name: '自评报告模板',
    //     description: '包含项目执行情况、目标达成度、问题分析等章节'
    //   }
    // ]
  } catch (error) {
    ElMessage.error(t('report.generate.loadTemplatesError'))
  }
}
</script>
```

### 3. 样式实现
```scss
<style lang="scss" scoped>
.report-generate-container {
  padding: 20px;
  background: #f7f9fc;
  min-height: calc(100vh - 56px);
}

.page-header {
  margin-bottom: 20px;
}

.header-left {
  display: flex;
  align-items: center;
  gap: 16px;
}

.back-button {
  display: flex;
  align-items: center;
  gap: 8px;
  color: #6b7280;
  border: 1px solid #e5e7eb;
  background: #ffffff;
  
  &:hover {
    color: #1e3a8a;
    border-color: #1e3a8a;
  }
}

.page-title {
  font-size: 24px;
  font-weight: 600;
  color: #1e3a8a;
  margin: 0;
}

.content-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  align-items: start;
}

.config-card {
  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    
    h3 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
      color: #111827;
    }
  }
}

.config-form {
  .el-form-item {
    margin-bottom: 20px;
  }
  
  .form-actions {
    margin-top: 32px;
    margin-bottom: 0;
    text-align: center;
    
    .el-button {
      min-width: 140px;
    }
  }
}

.project-option,
.workflow-option,
.template-option {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.project-name,
.workflow-name,
.template-name {
  font-weight: 600;
  color: #111827;
}

.project-code,
.workflow-desc,
.template-desc {
  font-size: 12px;
  color: #6b7280;
}

.advanced-config {
  margin-top: 20px;
  
  :deep(.el-collapse-item__header) {
    font-weight: 600;
    color: #374151;
  }
}

.process-card {
  .progress-section {
    margin-bottom: 24px;
  }
  
  .progress-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
  }
  
  .progress-text {
    font-size: 14px;
    font-weight: 600;
    color: #1e3a8a;
  }
  
  .progress-status {
    font-size: 12px;
    color: #6b7280;
  }
  
  .messages-section {
    h4 {
      margin: 0 0 12px 0;
      font-size: 14px;
      font-weight: 600;
      color: #374151;
    }
  }
  
  .messages-list {
    max-height: 200px;
    overflow-y: auto;
    border: 1px solid #e5e7eb;
    border-radius: 6px;
    padding: 8px;
  }
  
  .message-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    border-radius: 4px;
    margin-bottom: 4px;
    font-size: 13px;
    
    &.info {
      background: #f0f9ff;
      color: #0369a1;
    }
    
    &.success {
      background: #f0fdf4;
      color: #166534;
    }
    
    &.warning {
      background: #fffbeb;
      color: #d97706;
    }
    
    &.error {
      background: #fef2f2;
      color: #dc2626;
    }
    
    .message-icon {
      font-size: 14px;
    }
    
    .message-text {
      flex: 1;
    }
    
    .message-time {
      font-size: 11px;
      opacity: 0.7;
    }
  }
}

.preview-card {
  grid-column: 1 / -1;
  
  .preview-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    
    h3 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
      color: #111827;
    }
  }
  
  .preview-actions {
    display: flex;
    gap: 8px;
  }
  
  .preview-content {
    .editor-container {
      .content-editor {
        :deep(.el-textarea__inner) {
          font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
          font-size: 14px;
          line-height: 1.6;
        }
      }
    }
    
    .preview-container {
      .report-preview {
        min-height: 400px;
        padding: 24px;
        background: #ffffff;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        font-size: 14px;
        line-height: 1.8;
        color: #374151;
        
        h1 {
          font-size: 24px;
          font-weight: 700;
          color: #111827;
          margin: 0 0 24px 0;
          padding-bottom: 12px;
          border-bottom: 2px solid #e5e7eb;
        }
        
        h2 {
          font-size: 20px;
          font-weight: 600;
          color: #1e3a8a;
          margin: 32px 0 16px 0;
        }
        
        p {
          margin: 0 0 16px 0;
        }
        
        ul {
          margin: 0 0 16px 0;
          padding-left: 24px;
          
          li {
            margin-bottom: 8px;
          }
        }
      }
    }
  }
}

// 响应式设计
@media (max-width: 1200px) {
  .content-grid {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 768px) {
  .report-generate-container {
    padding: 16px;
  }
  
  .header-left {
    flex-direction: column;
    align-items: flex-start;
    gap: 12px;
  }
  
  .config-form {
    .form-actions {
      .el-button {
        width: 100%;
        margin-bottom: 8px;
      }
    }
  }
  
  .preview-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 12px;
  }
  
  .preview-actions {
    width: 100%;
    flex-wrap: wrap;
    
    .el-button {
      flex: 1;
      min-width: 80px;
    }
  }
}
</style>
```

## ⚠️ 重要注意事项

1. **配置表单**：完整的项目、工作流、模板选择，支持高级配置选项
2. **生成过程**：实时进度显示、状态消息、可中断生成
3. **预览编辑**：支持HTML预览和文本编辑两种模式
4. **报告操作**：保存、下载（多格式）、重新生成等完整功能
5. **响应式布局**：桌面端双栏布局，移动端单栏布局
6. **国际化支持**：所有文本使用$t()函数
7. **Mock数据**：包含TODO注释，便于后端集成
8. **用户体验**：加载状态、确认对话框、操作反馈等

**最终要求：生成的代码必须与原型图的视觉效果和交互逻辑完全一致！**
