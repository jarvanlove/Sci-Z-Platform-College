## 权限相关后端接口对接说明

本文档汇总当前已完成的 Sa-Token 相关接口，包含请求方式、路径、入参/出参说明、典型前端使用场景以及对接要点。未列出的接口表示仍为占位或待实现功能。

> 更新时间：2025-11-09 03:45（北京时间）

---

### 1. 认证模块接口（`AuthController`）

| 功能             | 方法 & 路径                                                      | 入参                                                                                 | 出参                                                                                 | 前端场景                     | 对接说明                                                                       |
| ---------------- | ---------------------------------------------------------------- | ------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------ | ---------------------------- | ------------------------------------------------------------------------------ |
| 用户登录         | `POST /api/auth/login`                                           | `LoginReq`（body，含 `username`、`password`、`captcha`、`captchaKey`、`rememberMe`） | `LoginResp`（token、用户信息、角色、权限、菜单、记住我标记）                         | 登录页表单提交               | 登录成功后保存 `token`，落库记住我为 7 天；失败 ≥3 次需先获取验证码            |
| 获取验证码       | `GET /api/auth/captcha`                                          | 无                                                                                   | `CaptchaResp`（`captchaKey`、`captchaImage`、`expiresIn`）                           | 登录页在失败次数达阈值后调用 | 前端需缓存 `captchaKey`，之后与验证码一起提交登录                              |
| 用户注册         | `POST /api/auth/register`                                        | `RegisterReq`（body，含用户名/邮箱/手机号/密码/验证码等）                            | `RegisterResp`（userId、基础信息）                                                   | 注册页面                     | 已包含验证码与唯一性校验；注册成功自动绑定默认角色并刷新权限缓存               |
| 退出登录         | `POST /api/auth/logout`                                          | 无                                                                                   | `Result<Void>`                                                                       | 个人中心 / 顶部退出按钮      | 调用后需清空前端保存的 token、角色等信息                                       |
| 刷新或续期 Token | `POST /api/auth/refresh-token`                                   | 无                                                                                   | `RefreshTokenResp`（`loginId`、`tokenName`、`tokenValue`、`expiresIn`、`expiresAt`） | token 将过期前的续期操作     | 若 `expiresAt = null` 表示 Sa-Token 记住我模式（长期有效），前端可不用再倒计时 |
| 获取当前档案     | `POST /api/auth/profile`                                         | 无                                                                                   | `ProfileResp`（用户信息、角色、权限、菜单、token 信息）                              | 登录后初始化、用户中心展示   | 返回结构与 `login` 保持一致，可用于刷新、页面初始化                            |
| 登录状态校验     | `GET /api/auth/check/login`                                      | 无                                                                                   | `CheckLoginResp`（是否登录、loginId、token 剩余秒数、token 信息）                    | 路由守卫、启动页自动跳转     | 未登录返回 `login=false`，其余字段为空/0；前端可据此跳转到登录页               |
| 角色校验         | `GET /api/auth/check/role?roleCode=xxx[&industryType=yyy]`       | `roleCode` 必填，`industryType` 可选                                                 | `CheckRoleResp`（`roleCode`、`industryType`、`hasRole`）                             | 页面级或按钮级角色控制       | 若不传 `industryType`，默认当前行业；返回 `hasRole=false` 表示无权限           |
| 权限校验         | `GET /api/auth/check/perm?permissionCode=xxx[&industryType=yyy]` | `permissionCode` 必填，`industryType` 可选                                           | `CheckPermResp`（`permissionCode`、`industryType`、`hasPermission`）                 | 细粒度权限开关、接口兜底     | 前端可在路由渲染或接口前置判断                                                 |
| 获取部门标签     | `GET /api/auth/department/label`                                 | 无                                                                                   | `List<DepartmentLabelResp>`（`label`、`value`）                                      | 注册/资料编辑时选择院系      | 结果已按行业缓存；若无数据返回空列表                                           |

---

### 2. 用户/角色管理接口（`UserController`）

当前只有角色-权限、用户-角色相关接口落地，其他 `industry/permission/user` 接口仍为占位（返回空结果）。

| 功能         | 方法 & 路径                                                 | 入参                                                                            | 出参                                          | 前端场景                     | 对接说明                                 |
| ------------ | ----------------------------------------------------------- | ------------------------------------------------------------------------------- | --------------------------------------------- | ---------------------------- | ---------------------------------------- |
| 查询角色权限 | `GET /api/user/roles/{roleId}/permissions?industryType=xxx` | `roleId`（path）、`industryType`（query）                                       | `RolePermissionIdsResp`（`permissionIdList`） | 角色管理编辑页回显权限复选框 | `industryType` 必填，与角色列表保持一致  |
| 更新角色权限 | `POST /api/user/roles/permissions`                          | `RolePermissionUpdateReq`（body：`roleId`、`industryType`、`permissionIdList`） | `Result<Void>`                                | 角色管理保存权限配置         | 全量替换：提交列表即最终绑定集合         |
| 查询用户角色 | `GET /api/user/users/{userId}/roles?industryType=xxx`       | `userId`（path）、`industryType`（query）                                       | `UserRoleIdsResp`（`roleIdList`）             | 用户管理编辑页回显角色       | `industryType` 必填                      |
| 更新用户角色 | `POST /api/user/users/roles`                                | `UserRoleUpdateReq`（body：`userId`、`industryType`、`roleIdList`）             | `Result<Void>`                                | 用户管理保存角色绑定         | 同样为全量替换；成功后后端已刷新权限缓存 |

---

### 3. 尚未完成的 Sa-Token 任务

- 会话治理接口：`/api/auth/session/current`、`/api/auth/session/kickout`、`/api/auth/session/disable`、`/api/auth/session/devices`
- 重置密码完整流程（验证码/旧密码校验、强密码策略、事件推送）
- 风控与限流能力（分布式限流、黑名单、登录失败策略等）
- 鉴权相关单元/集成测试补全

以上待办实现后，将继续更新本对接文档。
