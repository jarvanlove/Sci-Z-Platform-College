<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>æŠ¥å‘Šç®¡ç† - é«˜æ ¡ç§‘ç ”é¡¹ç›®ç®¡ç†å¹³å°</title>
    <link rel="icon" href="../images/favicon.ico" type="image/x-icon" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/element-plus/dist/index.css"
    />
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://unpkg.com/element-plus"></script>
    <script src="https://unpkg.com/@element-plus/icons-vue@2.3.1/dist/index.iife.js"></script>
    <script src="https://unpkg.com/dayjs@1.11.10/locale/zh-cn.js"></script>

    <link rel="stylesheet" href="../é€šç”¨è§„èŒƒ/æ ·å¼.css" />
    <style>
      /* é¡µé¢å¸ƒå±€æ ·å¼ */
      .report-list-container {
        padding: 20px;
        background: #f7f9fc;
        min-height: calc(100vh - 56px);
      }

      /* é¡µé¢å¤´éƒ¨ */
      .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .page-title {
        font-size: 24px;
        font-weight: 600;
        color: #1e3a8a;
        margin: 0;
      }

      .header-actions {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      /* æœç´¢ç­›é€‰åŒºåŸŸ */
      .search-card {
        background: #ffffff;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
        border: 1px solid #e5e7eb;
      }

      .search-form {
        display: flex;
        gap: 16px;
        align-items: end;
      }

      .search-form .el-form-item {
        margin-bottom: 0;
      }

      /* åŠ è½½çŠ¶æ€æ ·å¼ */
      .loading-container {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 40px;
        color: #6b7280;
        font-size: 14px;
      }

      .loading-container .el-icon {
        margin-right: 8px;
        font-size: 16px;
      }

      /* ç©ºçŠ¶æ€æ ·å¼ */
      .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #6b7280;
      }

      .empty-state-icon {
        font-size: 48px;
        margin-bottom: 16px;
        opacity: 0.5;
      }

      .empty-state-text {
        font-size: 16px;
        margin-bottom: 8px;
      }

      .empty-state-hint {
        font-size: 14px;
        color: #9ca3af;
      }

      /* æŠ¥å‘Šç»Ÿè®¡æ  */
      .result-count-bar {
        font-size: 14px;
        color: #6b7280;
        margin-bottom: 20px;
        padding: 12px 0;
      }

      /* å¡ç‰‡è§†å›¾ */
      .card-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 20px;
        margin-bottom: 24px;
      }

      .report-card {
        background: #ffffff;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        border: 1px solid #e5e7eb;
        transition: all 0.2s;
        cursor: pointer;
        position: relative;
      }

      .report-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        transform: translateY(-2px);
      }

      .report-card.selected {
        border-color: #1e3a8a;
        box-shadow: 0 0 0 2px rgba(30, 58, 138, 0.2);
      }

      .card-header {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        margin-bottom: 16px;
      }

      .report-type-tag {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 500;
      }

      .report-type-tag.tech {
        background: #dbeafe;
        color: #1e40af;
      }

      .report-type-tag.self {
        background: #e0f2fe;
        color: #0369a1;
      }

      .card-menu {
        position: relative;
      }

      .menu-btn {
        padding: 4px;
        border: none;
        background: none;
        cursor: pointer;
        color: #9ca3af;
        border-radius: 4px;
        transition: all 0.2s;
      }

      .menu-btn:hover {
        background: #f3f4f6;
        color: #6b7280;
      }

      .card-content {
        margin-bottom: 16px;
      }

      .project-name {
        font-size: 16px;
        font-weight: 600;
        color: #111827;
        margin: 0 0 8px 0;
        line-height: 1.4;
      }

      .report-summary {
        font-size: 14px;
        color: #6b7280;
        line-height: 1.6;
        margin: 0;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .card-meta {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 12px;
        margin-bottom: 16px;
        padding: 12px 0;
        border-top: 1px solid #f3f4f6;
        border-bottom: 1px solid #f3f4f6;
      }

      .meta-item {
        text-align: center;
      }

      .meta-value {
        font-size: 16px;
        font-weight: 600;
        color: #1e3a8a;
        margin: 0 0 2px 0;
      }

      .meta-label {
        font-size: 12px;
        color: #9ca3af;
        margin: 0;
      }

      .card-actions {
        display: flex;
        gap: 8px;
      }

      .action-btn {
        flex: 1;
        padding: 8px 12px;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        background: #ffffff;
        color: #6b7280;
        cursor: pointer;
        font-size: 12px;
        transition: all 0.2s;
        text-align: center;
        text-decoration: none;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
      }

      .action-btn:hover {
        background: #f9fafb;
        color: #374151;
        border-color: #d1d5db;
      }

      .action-btn.primary {
        background: #1e3a8a;
        color: #ffffff;
        border-color: #1e3a8a;
      }

      .action-btn.primary:hover {
        background: #1e40af;
      }

      .action-btn.danger {
        background: #dc2626;
        color: #ffffff;
        border-color: #dc2626;
      }

      .action-btn.danger:hover {
        background: #b91c1c;
        border-color: #b91c1c;
      }

      /* ç©ºçŠ¶æ€ */
      .empty-state {
        text-align: center;
        padding: 80px 20px;
        background: #ffffff;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .empty-icon {
        font-size: 64px;
        color: #d1d5db;
        margin-bottom: 20px;
      }

      .empty-title {
        font-size: 18px;
        font-weight: 600;
        color: #374151;
        margin: 0 0 8px 0;
      }

      .empty-description {
        font-size: 14px;
        color: #9ca3af;
        margin: 0 0 24px 0;
      }

      .empty-action {
        background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
        color: #ffffff;
        border: none;
        border-radius: 8px;
        padding: 12px 24px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        box-shadow: 0 2px 8px rgba(30, 58, 138, 0.3);
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .empty-action:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(30, 58, 138, 0.4);
      }

      /* åˆ†é¡µåŒºåŸŸ */
      .pagination-section {
        margin-top: 24px;
      }

      /* è‡ªå®šä¹‰å¼¹çª—æ ·å¼ */
      .el-message-box {
        border-radius: 12px !important;
        overflow: hidden;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12) !important;
      }

      .el-message-box__header {
        padding: 20px 24px 16px 24px !important;
        border-bottom: 1px solid #f0f0f0 !important;
        background: #ffffff !important;
      }

      .el-message-box__title {
        font-size: 16px !important;
        font-weight: 600 !important;
        color: #1e3a8a !important;
        line-height: 1.5 !important;
      }

      .el-message-box__headerbtn {
        top: 16px !important;
        right: 20px !important;
        width: 24px !important;
        height: 24px !important;
      }

      .el-message-box__close {
        color: #9ca3af !important;
        font-size: 16px !important;
      }

      .el-message-box__close:hover {
        color: #6b7280 !important;
      }

      .el-message-box__content {
        padding: 20px 24px !important;
        background: #ffffff !important;
      }

      .el-message-box__message {
        font-size: 14px !important;
        line-height: 1.6 !important;
        color: #374151 !important;
        margin: 0 !important;
        padding: 0 !important;
      }

      .el-message-box__btns {
        padding: 16px 24px 20px 24px !important;
        background: #ffffff !important;
        display: flex !important;
        justify-content: flex-end !important;
        gap: 12px !important;
      }

      .el-message-box__btns .el-button {
        padding: 8px 20px !important;
        border-radius: 8px !important;
        font-size: 14px !important;
        font-weight: 500 !important;
        border: 1px solid !important;
        transition: all 0.2s ease !important;
      }

      .el-message-box__btns .el-button--default {
        background: #ffffff !important;
        border-color: #d1d5db !important;
        color: #6b7280 !important;
      }

      .el-message-box__btns .el-button--default:hover {
        background: #f9fafb !important;
        border-color: #9ca3af !important;
        color: #374151 !important;
      }

      .el-message-box__btns .el-button--primary {
        background: #1e3a8a !important;
        border-color: #1e3a8a !important;
        color: #ffffff !important;
      }

      .el-message-box__btns .el-button--primary:hover {
        background: #1e40af !important;
        border-color: #1e40af !important;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
      }

      .el-message-box__btns .el-button--primary:active {
        transform: translateY(0);
        box-shadow: 0 2px 4px rgba(30, 58, 138, 0.3);
      }

      /* è­¦å‘Šç±»å‹å¼¹çª—çš„ç‰¹æ®Šæ ·å¼ */
      .el-message-box--warning .el-message-box__content {
        position: relative;
      }

      .el-message-box--warning .el-message-box__message::before {
        content: "âš ï¸";
        font-size: 18px !important;
        margin-right: 8px !important;
        vertical-align: -0.15em !important;
        display: inline-block !important;
      }

      /* æ‰¹é‡æ“ä½œæ  */
      .batch-bar {
        background: #eef2ff;
        border: 1px solid #1e3a8a;
        border-radius: 8px;
        padding: 12px 20px;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .batch-info {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .batch-count {
        font-size: 14px;
        color: #1e3a8a;
        font-weight: 500;
      }

      .batch-actions-bar {
        display: flex;
        gap: 8px;
      }

      .batch-btn {
        padding: 6px 12px;
        border: 1px solid #1e3a8a;
        border-radius: 4px;
        background: #ffffff;
        color: #1e3a8a;
        cursor: pointer;
        font-size: 12px;
        transition: all 0.2s;
      }

      .batch-btn:hover {
        background: #1e3a8a;
        color: #ffffff;
      }

      .batch-btn.danger {
        border-color: #dc2626;
        color: #dc2626;
      }

      .batch-btn.danger:hover {
        background: #dc2626;
        color: #ffffff;
      }

      /* å“åº”å¼è®¾è®¡ */
      @media (max-width: 1200px) {
        .card-grid {
          grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        }
      }

      @media (max-width: 768px) {
        .main-content {
          padding: 16px;
        }

        .page-header {
          padding: 16px;
          flex-direction: column;
          align-items: flex-start;
          gap: 16px;
        }

        .header-actions {
          width: 100%;
          justify-content: flex-end;
        }

        .filter-row {
          grid-template-columns: 1fr;
          gap: 16px;
        }

        .card-grid {
          grid-template-columns: 1fr;
        }

        .view-controls {
          flex-direction: column;
          align-items: flex-start;
          gap: 12px;
        }

        .card-meta {
          grid-template-columns: 1fr;
          text-align: left;
        }

        .card-actions {
          flex-direction: column;
        }

        .table-container {
          overflow-x: auto;
        }

        .report-table {
          min-width: 600px;
        }
      }

      /* åŠ è½½çŠ¶æ€ */
      .loading-container {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 60px 20px;
        background: #ffffff;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .loading-spinner {
        width: 32px;
        height: 32px;
        border: 3px solid #f3f4f6;
        border-top: 3px solid #1e3a8a;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div class="report-list-container">
        <!-- é¡µé¢æ ‡é¢˜å’Œæ“ä½œ -->
        <div class="page-header">
          <h1 class="page-title">æŠ¥å‘Šç®¡ç†</h1>
          <el-button type="primary" size="large" @click="goToGenerate">
            <!-- <el-icon><Plus /></el-icon> -->
            ç”Ÿæˆæ–°æŠ¥å‘Š
          </el-button>
        </div>

        <!-- æœç´¢ç­›é€‰åŒºåŸŸ -->
        <div class="search-card">
          <el-form :model="searchForm" class="search-form" label-width="100px">
            <el-form-item label="å…³é”®è¯æœç´¢">
              <el-input
                v-model="searchForm.keyword"
                placeholder="è¯·è¾“å…¥æŠ¥å‘Šåç§°æˆ–é¡¹ç›®åç§°"
                clearable
                style="width: 300px"
                @keyup.enter="handleSearch"
              >
                <template #prefix>
                  <el-icon><Search /></el-icon>
                </template>
              </el-input>
            </el-form-item>
            <el-form-item label="æŠ¥å‘Šç±»å‹">
              <el-select
                v-model="searchForm.reportType"
                placeholder="å…¨éƒ¨"
                clearable
                style="width: 150px"
                @change="handleFilterChange"
              >
                <el-option
                  v-for="option in reportTypeOptions"
                  :key="option.value"
                  :label="option.label"
                  :value="option.value"
                />
              </el-select>
            </el-form-item>
            <el-form-item label="æ—¶é—´ç­›é€‰">
              <el-date-picker
                v-model="searchForm.dateRange"
                type="daterange"
                range-separator="è‡³"
                start-placeholder="å¼€å§‹æ—¥æœŸ"
                end-placeholder="ç»“æŸæ—¥æœŸ"
                style="width: 240px"
                format="YYYY-MM-DD"
                value-format="YYYY-MM-DD"
                @change="handleDateChange"
              />
            </el-form-item>
          </el-form>

          <!-- æŒ‰é’®è¡Œ -->
          <div
            style="display: flex; justify-content: flex-end; margin-top: 16px"
          >
            <el-button
              type="primary"
              @click="handleSearch"
              style="margin-right: 8px"
            >
              <!-- <el-icon><Search /></el-icon> -->
              æœç´¢
            </el-button>
            <el-button @click="handleReset">
              <!-- <el-icon><Refresh /></el-icon> -->
              é‡ç½®
            </el-button>
          </div>
        </div>

        <!-- æŠ¥å‘Šåˆ—è¡¨è¡¨æ ¼ -->
        <div class="table-card">
          <!-- åŠ è½½çŠ¶æ€ -->
          <div v-if="loading" class="loading-container">
            <el-icon class="is-loading"><Loading /></el-icon>
            <span>åŠ è½½ä¸­...</span>
          </div>

          <!-- æŠ¥å‘Šåˆ—è¡¨ç»Ÿè®¡ -->
          <!-- <div v-if="!loading" class="result-count-bar">
            å…±æ‰¾åˆ° {{ pagination.total }} ä»½æŠ¥å‘Š
          </div> -->

          <!-- å¡ç‰‡è§†å›¾ -->
          <div v-if="!loading" class="card-grid">
            <div
              v-for="report in filteredReports"
              :key="report.id"
              class="report-card"
              :class="{ selected: selectedReports.includes(report.id) }"
              @click="toggleSelection(report.id)"
            >
              <div class="card-header">
                <div class="report-type-tag" :class="report.type">
                  <span>{{ report.type === 'tech' ? 'ğŸ“„' : 'ğŸ“Š' }}</span>
                  {{ report.typeText }}
                </div>
              </div>

              <div class="card-content">
                <h3 class="project-name">{{ report.projectName }}</h3>
                <p class="report-summary">{{ report.summary }}</p>
              </div>

              <div class="card-meta">
                <div class="meta-item">
                  <p class="meta-value">{{ formatDate(report.createdAt) }}</p>
                  <p class="meta-label">ç”Ÿæˆæ—¶é—´</p>
                </div>
                <div class="meta-item">
                  <p class="meta-value">{{ report.wordCount }}</p>
                  <p class="meta-label">æŠ¥å‘Šå­—æ•°</p>
                </div>
                <div class="meta-item">
                  <p class="meta-value">{{ report.refDocsCount }}</p>
                  <p class="meta-label">å¼•ç”¨æ–‡æ¡£</p>
                </div>
              </div>

              <div class="card-actions" @click.stop>
                <a class="action-btn primary" @click="handlePreview(report)">
                  é¢„è§ˆ
                </a>
                <el-dropdown
                  @command="(format) => handleDownload(report, format)"
                  trigger="click"
                >
                  <a class="action-btn primary"> ä¸‹è½½æŠ¥å‘Š </a>
                  <template #dropdown>
                    <el-dropdown-menu>
                      <el-dropdown-item command="pdf">PDF</el-dropdown-item>
                      <el-dropdown-item command="word">Word</el-dropdown-item>
                      <el-dropdown-item command="markdown"
                        >Markdown</el-dropdown-item
                      >
                    </el-dropdown-menu>
                  </template>
                </el-dropdown>
                <a class="action-btn primary" @click="handleRegenerate(report)">
                  é‡æ–°ç”Ÿæˆ
                </a>
                <a class="action-btn danger" @click="handleDelete(report)">
                  åˆ é™¤æŠ¥å‘Š
                </a>
              </div>
            </div>
          </div>

          <!-- ç©ºçŠ¶æ€ -->
          <div v-if="!loading && reports.length === 0" class="empty-state">
            <div class="empty-state-icon">ğŸ“„</div>
            <div class="empty-state-text">æš‚æ— æŠ¥å‘Šè®°å½•</div>
            <div class="empty-state-hint">
              ç‚¹å‡»"ç”Ÿæˆæ–°æŠ¥å‘Š"æŒ‰é’®å¼€å§‹æ‚¨çš„ç¬¬ä¸€ä»½æŠ¥å‘Š
            </div>
          </div>

          <!-- åˆ†é¡µ -->
          <div v-if="reports.length > 0" class="pagination-container">
            <!-- é€šç”¨åˆ†é¡µç»„ä»¶ -->
            <div id="pagination-component"></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const { createApp, ref, computed, onMounted, nextTick } = Vue;
      const { ElMessage, ElMessageBox } = ElementPlus;
      const {
        Plus,
        Search,
        Download,
        Delete,
        View,
        Refresh,
        ArrowDown,
        MoreFilled,
        Edit,
        Loading,
      } = ElementPlusIconsVue;

      createApp({
        components: {
          Plus,
          Search,
          Download,
          Delete,
          View,
          Refresh,
          ArrowDown,
          MoreFilled,
          Edit,
          Loading,
        },
        setup() {
          // æŠ¥å‘Šåˆ—è¡¨æ•°æ®
          const reports = ref([
            {
              id: "1",
              projectName: "åŸºäºæ·±åº¦å­¦ä¹ çš„å›¾åƒè¯†åˆ«æŠ€æœ¯ç ”ç©¶",
              projectCode: "AI2024001",
              type: "tech",
              typeText: "ç§‘æŠ€æŠ¥å‘Š",
              summary:
                "æœ¬é¡¹ç›®é€šè¿‡æ·±åº¦å­¦ä¹ ç®—æ³•ï¼Œå®ç°äº†é«˜ç²¾åº¦çš„å›¾åƒè¯†åˆ«æŠ€æœ¯ï¼Œåœ¨å¤šä¸ªåº”ç”¨åœºæ™¯ä¸­å–å¾—äº†æ˜¾è‘—æˆæœã€‚é¡¹ç›®å¼€å‘äº†åˆ›æ–°çš„ç¥ç»ç½‘ç»œæ¶æ„ï¼Œæ˜¾è‘—æå‡äº†è¯†åˆ«å‡†ç¡®ç‡å’Œå¤„ç†é€Ÿåº¦ã€‚",
              createdAt: new Date("2024-03-15"),
              wordCount: "8,500",
              refDocsCount: 45,
              content:
                "<h2>é¡¹ç›®æ¦‚è¿°</h2><p>æœ¬é¡¹ç›®æ˜¯ä¸€é¡¹é‡è¦çš„äººå·¥æ™ºèƒ½ç ”ç©¶é¡¹ç›®...</p>",
            },
            {
              id: "2",
              projectName: "æ™ºèƒ½ç‰©è”ç½‘ç³»ç»Ÿå…³é”®æŠ€æœ¯ç ”å‘",
              projectCode: "IOT2024002",
              type: "self",
              typeText: "è‡ªè¯„æŠ¥å‘Š",
              summary:
                "é¡¹ç›®åœ¨ç‰©è”ç½‘ç³»ç»Ÿæ¶æ„è®¾è®¡ã€æ•°æ®ä¼ è¾“ä¼˜åŒ–ã€å®‰å…¨é˜²æŠ¤ç­‰æ–¹é¢å–å¾—é‡è¦çªç ´ï¼Œå½¢æˆäº†å®Œæ•´çš„æŠ€æœ¯è§£å†³æ–¹æ¡ˆã€‚ç³»ç»Ÿåœ¨å®é™…éƒ¨ç½²ä¸­è¡¨ç°ä¼˜å¼‚ï¼Œè¾¾åˆ°äº†é¢„æœŸç›®æ ‡ã€‚",
              createdAt: new Date("2024-03-10"),
              wordCount: "7,200",
              refDocsCount: 32,
              content: "<h2>é¡¹ç›®æ‰§è¡Œæƒ…å†µ</h2><p>é¡¹ç›®ä¸¥æ ¼æŒ‰ç…§è®¡åˆ’æ‰§è¡Œ...</p>",
            },
            {
              id: "3",
              projectName: "åŒºå—é“¾æŠ€æœ¯åœ¨ä¾›åº”é“¾ç®¡ç†ä¸­çš„åº”ç”¨",
              projectCode: "BC2024003",
              type: "tech",
              typeText: "ç§‘æŠ€æŠ¥å‘Š",
              summary:
                "é¡¹ç›®æˆåŠŸå°†åŒºå—é“¾æŠ€æœ¯åº”ç”¨äºä¾›åº”é“¾ç®¡ç†ï¼Œå®ç°äº†å…¨é“¾è·¯å¯è¿½æº¯ã€æ•°æ®ä¸å¯ç¯¡æ”¹ç­‰å…³é”®åŠŸèƒ½ã€‚å¼€å‘çš„ç³»ç»Ÿå·²åœ¨å¤šå®¶ä¼ä¸šè¯•ç‚¹åº”ç”¨ï¼Œæ•ˆæœè‰¯å¥½ã€‚",
              createdAt: new Date("2024-03-05"),
              wordCount: "9,100",
              refDocsCount: 28,
              content: "<h2>æŠ€æœ¯åˆ›æ–°</h2><p>æœ¬é¡¹ç›®åœ¨åŒºå—é“¾åº”ç”¨æ–¹é¢...</p>",
            },
            {
              id: "4",
              projectName: "æ–°èƒ½æºæ±½è½¦ç”µæ± ç®¡ç†ç³»ç»Ÿä¼˜åŒ–",
              projectCode: "EV2024004",
              type: "self",
              typeText: "è‡ªè¯„æŠ¥å‘Š",
              summary:
                "é¡¹ç›®é’ˆå¯¹æ–°èƒ½æºæ±½è½¦ç”µæ± ç®¡ç†ç³»ç»Ÿè¿›è¡Œäº†æ·±åº¦ä¼˜åŒ–ï¼Œæå‡äº†ç”µæ± ä½¿ç”¨æ•ˆç‡å’Œå®‰å…¨æ€§ã€‚é€šè¿‡ç®—æ³•æ”¹è¿›å’Œç¡¬ä»¶å‡çº§ï¼Œç³»ç»Ÿæ€§èƒ½å¾—åˆ°æ˜¾è‘—æå‡ã€‚",
              createdAt: new Date("2024-02-28"),
              wordCount: "6,800",
              refDocsCount: 38,
              content: "<h2>é¡¹ç›®æˆæœ</h2><p>é¡¹ç›®åœ¨ç”µæ± ç®¡ç†æ–¹é¢...</p>",
            },
            {
              id: "5",
              projectName: "5Gç½‘ç»œåˆ‡ç‰‡æŠ€æœ¯ç ”ç©¶ä¸å®ç°",
              projectCode: "5G2024005",
              type: "tech",
              typeText: "ç§‘æŠ€æŠ¥å‘Š",
              summary:
                "é¡¹ç›®æ·±å…¥ç ”ç©¶äº†5Gç½‘ç»œåˆ‡ç‰‡æŠ€æœ¯ï¼Œå¼€å‘äº†é«˜æ•ˆçš„åˆ‡ç‰‡ç®¡ç†ç®—æ³•å’Œå®ç°æ–¹æ¡ˆã€‚æŠ€æœ¯æˆæœå·²åº”ç”¨äºå®é™…ç½‘ç»œç¯å¢ƒï¼ŒéªŒè¯äº†æ–¹æ¡ˆçš„å¯è¡Œæ€§å’Œå…ˆè¿›æ€§ã€‚",
              createdAt: new Date("2024-02-20"),
              wordCount: "10,200",
              refDocsCount: 52,
              content: "<h2>æŠ€æœ¯æ–¹æ¡ˆ</h2><p>5Gç½‘ç»œåˆ‡ç‰‡æŠ€æœ¯...</p>",
            },
          ]);

          const loading = ref(false);

          // æœç´¢ç­›é€‰
          const searchForm = ref({
            keyword: "",
            reportType: "", // é»˜è®¤é€‰ä¸­å…¨éƒ¨
            dateRange: [],
          });

          // æŠ¥å‘Šç±»å‹é€‰é¡¹
          const reportTypeOptions = ref([
            { label: "å…¨éƒ¨", value: "" },
            { label: "ç§‘æŠ€æŠ¥å‘Š", value: "tech" },
            { label: "è‡ªè¯„æŠ¥å‘Š", value: "self" },
          ]);

          // åˆ†é¡µ
          const pagination = ref({
            current: 1,
            size: 10,
            total: 0,
          });

          const jumpPage = ref(1);

          // é€‰æ‹©çŠ¶æ€
          const selectedReports = ref([]);

          // è®¡ç®—å±æ€§
          const filteredReports = computed(() => {
            let filtered = [...reports.value];

            // å…³é”®è¯ç­›é€‰
            if (searchForm.value.keyword) {
              const keyword = searchForm.value.keyword.toLowerCase();
              filtered = filtered.filter(
                (report) =>
                  report.projectName.toLowerCase().includes(keyword) ||
                  report.summary.toLowerCase().includes(keyword)
              );
            }

            // æŠ¥å‘Šç±»å‹ç­›é€‰
            if (searchForm.value.reportType) {
              filtered = filtered.filter(
                (report) => report.type === searchForm.value.reportType
              );
            }

            // æ—¶é—´ç­›é€‰ï¼ˆæ—¥æœŸèŒƒå›´ç­›é€‰ï¼‰
            if (
              searchForm.value.dateRange &&
              searchForm.value.dateRange.length === 2
            ) {
              const [startDate, endDate] = searchForm.value.dateRange;
              const start = new Date(startDate);
              const end = new Date(endDate);
              end.setHours(23, 59, 59, 999); // è®¾ç½®åˆ°å½“å¤©ç»“æŸ

              filtered = filtered.filter(
                (report) => report.createdAt >= start && report.createdAt <= end
              );
            }

            // æ›´æ–°åˆ†é¡µæ€»æ•°
            pagination.value.total = filtered.length;

            // åˆ†é¡µå¤„ç†
            const start =
              (pagination.value.current - 1) * pagination.value.size;
            const end = start + pagination.value.size;
            return filtered.slice(start, end);
          });

          const hasReports = computed(() => {
            return reports.value.length > 0;
          });

          const totalPages = computed(() => {
            return Math.ceil(pagination.value.total / pagination.value.size);
          });

          const visiblePages = computed(() => {
            const current = pagination.value.current;
            const total = totalPages.value;
            const pages = [];

            let start = Math.max(1, current - 2);
            let end = Math.min(total, current + 2);

            if (end - start < 4) {
              if (start === 1) {
                end = Math.min(total, start + 4);
              } else {
                start = Math.max(1, end - 4);
              }
            }

            for (let i = start; i <= end; i++) {
              pages.push(i);
            }

            return pages;
          });

          const isAllSelected = computed(() => {
            return (
              filteredReports.value.length > 0 &&
              selectedReports.value.length === filteredReports.value.length
            );
          });

          const isIndeterminate = computed(() => {
            return (
              selectedReports.value.length > 0 &&
              selectedReports.value.length < filteredReports.value.length
            );
          });

          // æ–¹æ³•
          const goToGenerate = () => {
            window.parent.postMessage(
              { type: "navigate", path: "acceptance/generate" },
              "*"
            );
          };

          const handleSearch = () => {
            pagination.value.current = 1;
            ElMessage.success("æœç´¢å®Œæˆ");
            // å¼ºåˆ¶è§¦å‘å“åº”å¼æ›´æ–°
            nextTick(() => {
              initPagination();
            });
          };

          const handleFilterChange = () => {
            pagination.value.current = 1;
            // å¼ºåˆ¶è§¦å‘å“åº”å¼æ›´æ–°
            nextTick(() => {
              initPagination();
            });
          };

          const handleDateChange = () => {
            pagination.value.current = 1;
            // å¼ºåˆ¶è§¦å‘å“åº”å¼æ›´æ–°
            nextTick(() => {
              initPagination();
            });
          };

          const handleReset = () => {
            searchForm.value.keyword = "";
            searchForm.value.reportType = "";
            searchForm.value.dateRange = [];
            pagination.value.current = 1;
            ElMessage.info("å·²é‡ç½®æœç´¢æ¡ä»¶");
            // å¼ºåˆ¶è§¦å‘å“åº”å¼æ›´æ–°
            nextTick(() => {
              initPagination();
            });
          };

          // åˆå§‹åŒ–åˆ†é¡µç»„ä»¶
          const initPagination = () => {
            const paginationContainer = document.getElementById(
              "pagination-component"
            );
            if (paginationContainer) {
              // åˆ›å»ºåˆ†é¡µç»„ä»¶HTML
              const paginationHTML = `
                <div class="pagination-container">
                  <!-- åˆ†é¡µä¿¡æ¯ -->
                  <div class="pagination-info">
                    å…± ${pagination.value.total} æ¡è®°å½•
                  </div>

                  <!-- æ¯é¡µæ˜¾ç¤ºæ•°é‡é€‰æ‹©å™¨ -->
                  <div class="page-size-selector">
                    æ¯é¡µæ˜¾ç¤º
                    <select id="page-size-select">
                      <option value="10" ${
                        pagination.value.size === 10 ? "selected" : ""
                      }>10 æ¡</option>
                      <option value="20" ${
                        pagination.value.size === 20 ? "selected" : ""
                      }>20 æ¡</option>
                      <option value="50" ${
                        pagination.value.size === 50 ? "selected" : ""
                      }>50 æ¡</option>
                    </select>
                  </div>

                  <!-- åˆ†é¡µæ§åˆ¶å™¨ -->
                  <div class="pagination-controls">
                    <!-- ä¸Šä¸€é¡µæŒ‰é’® -->
                    <a href="javascript:void(0)" class="page-btn ${
                      pagination.value.current === 1 ? "disabled" : ""
                    }" id="prev-btn">
                      ä¸Šä¸€é¡µ
                    </a>

                    <!-- é¡µç æŒ‰é’® -->
                    <div class="page-nav" id="page-nav">
                      ${generatePageButtons()}
                    </div>

                    <!-- ä¸‹ä¸€é¡µæŒ‰é’® -->
                    <a href="javascript:void(0)" class="page-btn ${
                      pagination.value.current ===
                      Math.ceil(pagination.value.total / pagination.value.size)
                        ? "disabled"
                        : ""
                    }" id="next-btn">
                      ä¸‹ä¸€é¡µ
                    </a>
                  </div>

                  <!-- å¿«é€Ÿè·³è½¬ -->
                  <div class="page-jumper">
                    è·³è‡³
                    <input type="number" id="jump-input" value="${
                      pagination.value.current
                    }" min="1" max="${Math.ceil(
                pagination.value.total / pagination.value.size
              )}">
                    é¡µ
                    <button class="jump-btn" id="jump-btn">ç¡®å®š</button>
                  </div>
                </div>
              `;

              paginationContainer.innerHTML = paginationHTML;

              // ç»‘å®šäº‹ä»¶
              bindPaginationEvents();
            }
          };

          // ç”Ÿæˆé¡µç æŒ‰é’®
          const generatePageButtons = () => {
            const totalPages = Math.ceil(
              pagination.value.total / pagination.value.size
            );
            const current = pagination.value.current;
            const pagerCount = 7; // æ˜¾ç¤ºçš„é¡µç æ•°é‡

            let buttons = "";

            if (totalPages <= pagerCount) {
              // æ€»é¡µæ•°å°äºç­‰äºæ˜¾ç¤ºæ•°é‡ï¼Œæ˜¾ç¤ºæ‰€æœ‰é¡µç 
              for (let i = 1; i <= totalPages; i++) {
                buttons += `<a href="javascript:void(0)" class="page-btn ${
                  i === current ? "active" : ""
                }" data-page="${i}">${i}</a>`;
              }
            } else {
              // è®¡ç®—ä¸­é—´é¡µç èŒƒå›´
              const half = Math.floor(pagerCount / 2);
              let start = Math.max(1, current - half);
              let end = Math.min(totalPages, start + pagerCount - 1);

              // è°ƒæ•´èµ·å§‹ä½ç½®
              if (end - start + 1 < pagerCount) {
                start = Math.max(1, end - pagerCount + 1);
              }

              // ç¬¬ä¸€é¡µ
              if (start > 1) {
                buttons += `<a href="javascript:void(0)" class="page-btn ${
                  1 === current ? "active" : ""
                }" data-page="1">1</a>`;
                if (start > 2) {
                  buttons += '<span class="page-ellipsis">...</span>';
                }
              }

              // ä¸­é—´é¡µç 
              for (let i = start; i <= end; i++) {
                buttons += `<a href="javascript:void(0)" class="page-btn ${
                  i === current ? "active" : ""
                }" data-page="${i}">${i}</a>`;
              }

              // æœ€åä¸€é¡µ
              if (end < totalPages) {
                if (end < totalPages - 1) {
                  buttons += '<span class="page-ellipsis">...</span>';
                }
                buttons += `<a href="javascript:void(0)" class="page-btn ${
                  totalPages === current ? "active" : ""
                }" data-page="${totalPages}">${totalPages}</a>`;
              }
            }

            return buttons;
          };

          // ç»‘å®šåˆ†é¡µäº‹ä»¶
          const bindPaginationEvents = () => {
            // æ¯é¡µæ˜¾ç¤ºæ•°é‡å˜åŒ–
            const pageSizeSelect = document.getElementById("page-size-select");
            if (pageSizeSelect) {
              pageSizeSelect.addEventListener("change", (e) => {
                pagination.value.size = parseInt(e.target.value);
                pagination.value.current = 1;
                initPagination(); // é‡æ–°åˆå§‹åŒ–åˆ†é¡µç»„ä»¶
              });
            }

            // ä¸Šä¸€é¡µ
            const prevBtn = document.getElementById("prev-btn");
            if (prevBtn) {
              prevBtn.addEventListener("click", () => {
                if (pagination.value.current > 1) {
                  pagination.value.current--;
                  initPagination();
                }
              });
            }

            // ä¸‹ä¸€é¡µ
            const nextBtn = document.getElementById("next-btn");
            if (nextBtn) {
              nextBtn.addEventListener("click", () => {
                const totalPages = Math.ceil(
                  pagination.value.total / pagination.value.size
                );
                if (pagination.value.current < totalPages) {
                  pagination.value.current++;
                  initPagination();
                }
              });
            }

            // é¡µç ç‚¹å‡»
            const pageNav = document.getElementById("page-nav");
            if (pageNav) {
              pageNav.addEventListener("click", (e) => {
                if (
                  e.target.classList.contains("page-btn") &&
                  !e.target.classList.contains("active")
                ) {
                  const page = parseInt(e.target.getAttribute("data-page"));
                  if (page && page !== pagination.value.current) {
                    pagination.value.current = page;
                    initPagination();
                  }
                }
              });
            }

            // å¿«é€Ÿè·³è½¬
            const jumpBtn = document.getElementById("jump-btn");
            const jumpInput = document.getElementById("jump-input");
            if (jumpBtn && jumpInput) {
              const handleJump = () => {
                const page = parseInt(jumpInput.value);
                const totalPages = Math.ceil(
                  pagination.value.total / pagination.value.size
                );
                if (
                  page &&
                  page >= 1 &&
                  page <= totalPages &&
                  page !== pagination.value.current
                ) {
                  pagination.value.current = page;
                  initPagination();
                } else {
                  jumpInput.value = pagination.value.current;
                }
              };

              jumpBtn.addEventListener("click", handleJump);
              jumpInput.addEventListener("keyup", (e) => {
                if (e.key === "Enter") {
                  handleJump();
                }
              });
            }
          };

          const handlePageChange = (page) => {
            if (page >= 1 && page <= totalPages.value) {
              pagination.value.current = page;
            }
          };

          const handlePageSizeChange = () => {
            pagination.value.current = 1;
          };

          const handleJumpPage = () => {
            if (jumpPage.value >= 1 && jumpPage.value <= totalPages.value) {
              pagination.value.current = jumpPage.value;
            }
          };

          const toggleSelection = (reportId) => {
            const index = selectedReports.value.indexOf(reportId);
            if (index > -1) {
              selectedReports.value.splice(index, 1);
            } else {
              selectedReports.value.push(reportId);
            }
          };

          const handleSelectAll = (checked) => {
            if (checked) {
              selectedReports.value = filteredReports.value.map(
                (report) => report.id
              );
            } else {
              selectedReports.value = [];
            }
          };

          const clearSelection = () => {
            selectedReports.value = [];
          };

          const handlePreview = (report) => {
            ElMessage.info(`é¢„è§ˆåŠŸèƒ½å¼€å‘ä¸­ï¼Œå°†é¢„è§ˆæŠ¥å‘Šï¼š${report.projectName}`);
            // TODO: å®ç°é¢„è§ˆåŠŸèƒ½
          };

          const handleEditReport = (report) => {
            // è·³è½¬åˆ°ç¼–è¾‘é¡µé¢æˆ–æ‰“å¼€ç¼–è¾‘æ¨¡å¼
            ElMessage.info("è·³è½¬åˆ°æŠ¥å‘Šç¼–è¾‘é¡µé¢");
          };

          const handleDownload = (report, format) => {
            ElMessage.info(
              `æ­£åœ¨ä¸‹è½½ ${
                report.projectName
              } çš„ ${format.toUpperCase()} æ ¼å¼æŠ¥å‘Š...`
            );

            // æ¨¡æ‹Ÿä¸‹è½½
            setTimeout(() => {
              ElMessage.success(`${format.toUpperCase()} æ ¼å¼æŠ¥å‘Šä¸‹è½½æˆåŠŸï¼`);
            }, 2000);
          };

          const handleRegenerate = async (report) => {
            try {
              await ElMessageBox.confirm(
                "é‡æ–°ç”Ÿæˆå°†è¦†ç›–å½“å‰æŠ¥å‘Šï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ",
                "é‡æ–°ç”Ÿæˆç¡®è®¤",
                {
                  confirmButtonText: "ç¡®å®š",
                  cancelButtonText: "å–æ¶ˆ",
                  type: "warning",
                }
              );

              ElMessage.success("å·²å¼€å§‹é‡æ–°ç”ŸæˆæŠ¥å‘Š");
              // è¿™é‡Œå¯ä»¥è·³è½¬åˆ°ç”Ÿæˆé¡µé¢æˆ–è°ƒç”¨ç”Ÿæˆæ¥å£
            } catch (error) {
              // ç”¨æˆ·å–æ¶ˆ
            }
          };

          const handleDelete = async (report) => {
            try {
              await ElMessageBox.confirm(
                `ç¡®å®šè¦åˆ é™¤æŠ¥å‘Š"${report.projectName} - ${report.typeText}"å—ï¼Ÿ`,
                "åˆ é™¤ç¡®è®¤",
                {
                  confirmButtonText: "ç¡®å®š",
                  cancelButtonText: "å–æ¶ˆ",
                  type: "warning",
                }
              );

              const index = reports.value.findIndex((r) => r.id === report.id);
              if (index > -1) {
                reports.value.splice(index, 1);
                ElMessage.success("æŠ¥å‘Šåˆ é™¤æˆåŠŸ");
              }
            } catch (error) {
              // ç”¨æˆ·å–æ¶ˆ
            }
          };

          const handleCardAction = (command, report) => {
            switch (command) {
              case "preview":
                handlePreview(report);
                break;
              case "edit":
                handleEditReport(report);
                break;
              case "download":
                // æ˜¾ç¤ºä¸‹è½½é€‰é¡¹
                ElMessage.info("è¯·é€‰æ‹©ä¸‹è½½æ ¼å¼");
                break;
              case "regenerate":
                handleRegenerate(report);
                break;
              case "delete":
                handleDelete(report);
                break;
            }
          };

          const handleBatchDownload = () => {
            if (selectedReports.value.length === 0) return;

            ElMessage.info(
              `æ­£åœ¨æ‰¹é‡ä¸‹è½½ ${selectedReports.value.length} ä»½æŠ¥å‘Š...`
            );

            setTimeout(() => {
              ElMessage.success("æ‰¹é‡ä¸‹è½½å®Œæˆï¼");
              clearSelection();
            }, 3000);
          };

          const handleBatchDelete = async () => {
            if (selectedReports.value.length === 0) return;

            try {
              await ElMessageBox.confirm(
                `ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${selectedReports.value.length} ä»½æŠ¥å‘Šå—ï¼Ÿ`,
                "æ‰¹é‡åˆ é™¤ç¡®è®¤",
                {
                  confirmButtonText: "ç¡®å®š",
                  cancelButtonText: "å–æ¶ˆ",
                  type: "warning",
                }
              );

              // åˆ é™¤é€‰ä¸­çš„æŠ¥å‘Š
              reports.value = reports.value.filter(
                (report) => !selectedReports.value.includes(report.id)
              );
              clearSelection();
              ElMessage.success("æ‰¹é‡åˆ é™¤æˆåŠŸ");
            } catch (error) {
              // ç”¨æˆ·å–æ¶ˆ
            }
          };

          // å·¥å…·å‡½æ•°
          const formatDate = (date) => {
            return date.toLocaleDateString("zh-CN");
          };

          const formatDateTime = (date) => {
            return date.toLocaleString("zh-CN");
          };

          // ç»„ä»¶æŒ‚è½½
          onMounted(() => {
            // åˆå§‹åŒ–åˆ†é¡µæ€»æ•°
            pagination.value.total = reports.value.length;
            console.log("æŠ¥å‘Šåˆ—è¡¨é¡µé¢å·²åŠ è½½");
            // æ•°æ®åŠ è½½å®Œæˆåé‡æ–°åˆå§‹åŒ–åˆ†é¡µç»„ä»¶
            setTimeout(() => {
              initPagination();
            }, 100);
          });

          return {
            // æ•°æ®
            reports,
            loading,
            searchForm,
            reportTypeOptions,
            pagination,
            jumpPage,
            selectedReports,

            // è®¡ç®—å±æ€§
            filteredReports,
            hasReports,
            totalPages,
            visiblePages,
            isAllSelected,
            isIndeterminate,

            // æ–¹æ³•
            goToGenerate,
            handleSearch,
            handleFilterChange,
            handleDateChange,
            handleReset,
            handlePageChange,
            handlePageSizeChange,
            handleJumpPage,
            toggleSelection,
            handleSelectAll,
            clearSelection,
            handlePreview,
            handleEditReport,
            handleDownload,
            handleRegenerate,
            handleDelete,
            handleCardAction,
            handleBatchDownload,
            handleBatchDelete,
            formatDate,
            formatDateTime,
            initPagination,
          };
        },
      })
        .use(ElementPlus, {
          locale: {
            name: "zh-cn",
            el: {
              datepicker: {
                now: "æ­¤åˆ»",
                today: "ä»Šå¤©",
                cancel: "å–æ¶ˆ",
                clear: "æ¸…ç©º",
                confirm: "ç¡®è®¤",
                selectDate: "é€‰æ‹©æ—¥æœŸ",
                selectTime: "é€‰æ‹©æ—¶é—´",
                startDate: "å¼€å§‹æ—¥æœŸ",
                startTime: "å¼€å§‹æ—¶é—´",
                endDate: "ç»“æŸæ—¥æœŸ",
                endTime: "ç»“æŸæ—¶é—´",
                prevYear: "å‰ä¸€å¹´",
                nextYear: "åä¸€å¹´",
                prevMonth: "ä¸Šä¸ªæœˆ",
                nextMonth: "ä¸‹ä¸ªæœˆ",
                year: "å¹´",
                month1: "1æœˆ",
                month2: "2æœˆ",
                month3: "3æœˆ",
                month4: "4æœˆ",
                month5: "5æœˆ",
                month6: "6æœˆ",
                month7: "7æœˆ",
                month8: "8æœˆ",
                month9: "9æœˆ",
                month10: "10æœˆ",
                month11: "11æœˆ",
                month12: "12æœˆ",
                weeks: {
                  sun: "æ—¥",
                  mon: "ä¸€",
                  tue: "äºŒ",
                  wed: "ä¸‰",
                  thu: "å››",
                  fri: "äº”",
                  sat: "å…­",
                },
                months: {
                  jan: "ä¸€æœˆ",
                  feb: "äºŒæœˆ",
                  mar: "ä¸‰æœˆ",
                  apr: "å››æœˆ",
                  may: "äº”æœˆ",
                  jun: "å…­æœˆ",
                  jul: "ä¸ƒæœˆ",
                  aug: "å…«æœˆ",
                  sep: "ä¹æœˆ",
                  oct: "åæœˆ",
                  nov: "åä¸€æœˆ",
                  dec: "åäºŒæœˆ",
                },
              },
            },
          },
        })
        .mount("#app");
    </script>
  </body>
</html>
