# 验收模块原型图设计提示词

## 🎯 设计目标

设计基于项目知识库的智能报告生成原型，通过 Dify AI 辅助生成科技报告和自评报告，为科研项目验收提供智能化的报告生成服务。重点突出报告生成的交互过程和用户体验。

## 💡 核心业务逻辑

### 业务背景

- **应用场景**：用户在项目结束后，需要生成验收所需的科技报告和自评报告
- **数据来源**：基于项目整个实施过程中产生的知识库内容
- **知识库关联**：一个项目对应一个知识库，生成报告时只能选择一个项目知识库
- **AI 生成**：结合 Dify AI 智能生成报告，支持实时预览和调整
- **最终产出**：科技报告 + 自评报告（2 个报告）

### 设计重点

本模块的核心价值在于**报告生成的交互体验**，而非传统的表单填写和流程审批：

1. **智能生成过程可视化** - 展示 AI 生成报告的实时过程
2. **交互式内容调整** - 支持用户与 AI 对话优化报告内容
3. **实时预览和编辑** - 边生成边预览，支持即时调整
4. **流畅的用户体验** - 类似 AI 助手的自然交互体验

## 📚 必读参考文件

### 通用规范文件

1. **`原型图/通用规范/样式与主题.md`** - 色彩和字体规范
2. **`原型图/通用规范/布局与导航.md`** - 布局设计规范
3. **`原型图/通用规范/表单与表格规范.md`** - 表单和表格设计规范
4. **`原型图/通用规范/样式.css`** - 统一样式规范
5. **`原型图/通用规范/页面跳转与交互规范.md`** - 页面跳转和交互规范
6. **`原型图/通用规范/原型图设计补充要求.md`** - 原型图设计补充要求

### 验收模块专用组件

7. **`原型图/通用规范/组件-通用表格.html`** - 报告历史列表
8. **`原型图/通用规范/分页组件使用说明.md`** - 分页组件使用方法
9. **`原型图/通用规范/组件-卡片与栅格示例.html`** - 报告生成界面卡片布局
10. **`原型图/通用规范/组件-面包屑与页面头.html`** - 页面导航组件
11. **`原型图/通用规范/组件-空状态与结果页.html`** - 空状态处理组件
12. **`原型图/通用规范/交互-加载与反馈.html`** - 报告生成加载状态和反馈

### 参考 AI 助手设计

13. **`原型图/AI助手/AI对话.html`** - 参考 AI 对话的交互体验设计
14. **`原型图/AI助手/原型图提示词.md`** - 参考 AI 交互的设计理念

### 模块特定文件

15. **`原型图/验收模块/说明.md`** - 验收模块功能说明
16. **`原型图/验收模块/字段与交互清单.md`** - 具体字段和交互要求

## 🎨 设计约束

### 色彩规范

- **主色调**：#1E3A8A（学术蓝）
- **辅色调**：#0EA5E9（科研活力蓝）
- **背景色**：#F7F9FC（页面背景）
- **卡片背景**：#FFFFFF（内容卡片）
- **AI 生成区域背景**：#F0F9FF（AI 生成内容背景）
- **预览区域背景**：#EEF2FF（报告预览背景）
- **成功色**：#16A34A（生成成功）
- **警告色**：#F59E0B（生成中）
- **错误色**：#DC2626（生成失败）
- **信息色**：#2563EB（待生成）

### 布局规范

- **页面布局**：24 栅格系统
- **卡片样式**：圆角 8px，阴影 Level 1，内边距 20px
- **生成界面布局**：上下分栏，上方配置区域，下方生成预览区域
- **预览布局**：左右分栏，左侧生成过程，右侧实时预览

### 组件规范

- **生成进度条**：展示报告生成进度
- **打字机效果**：模拟 AI 生成文字的实时效果
- **报告预览器**：支持实时预览报告内容
- **交互式编辑**：支持对生成内容的即时调整

## 📋 页面设计要求

### 🌟 报告生成页面设计（核心页面）

这是验收模块最重要的页面，提供基于项目知识库的智能报告生成服务。

#### 页面结构

1. **页面头部**：报告生成、返回按钮
2. **配置区域**：项目选择、报告类型选择、生成参数配置
3. **生成交互区域**：AI 生成过程展示（类似 AI 对话体验）
4. **预览区域**：实时预览生成的报告内容
5. **操作区域**：保存、下载、重新生成按钮

#### 配置区域设计

- **项目选择**：

  - **选择器样式**：下拉选择框
  - **显示内容**：项目名称 + 项目编号
  - **附加信息**：项目状态、项目进度、知识库文档数量
  - **限制说明**：一个项目对应一个知识库，只能选择一个项目
  - **空状态提示**：暂无可用项目，请先创建项目
  - **占位符**：请选择要生成报告的项目

- **报告类型选择**：

  - **选择方式**：单选卡片或 Radio 按钮组
  - **选项**：
    - 科技报告：描述项目的科研成果、技术创新、学术价值
    - 自评报告：对项目执行情况、完成质量进行自我评价
  - **默认值**：科技报告
  - **说明文字**：每种报告类型下方显示简短说明

- **生成参数配置（可选，可折叠区域）**：
  - **报告风格**：正式、学术、简洁（单选）
  - **详细程度**：简要、标准、详细（单选）
  - **特殊要求**：多行文本输入框，用户可补充特殊要求
  - **占位符**：您可以输入对报告的特殊要求，如侧重点、格式要求等...

#### 生成交互区域设计（重点）

**设计理念**：模仿 AI 对话体验，让用户清晰看到 AI 生成报告的每个步骤

- **生成前状态**：

  - 显示引导提示：请选择项目和报告类型，然后点击"开始生成"
  - 显示知识库信息预览：选中项目后显示知识库文档数量、文档类型分布

- **生成中状态（类似 AI 对话的打字机效果）**：

  - **整体布局**：卡片式消息列表，类似聊天界面
  - **进度步骤展示**：
    ```
    ✓ 正在读取项目知识库... (100%)
    ✓ 正在分析项目文档内容... (100%)
    ✓ 正在提取关键信息... (100%)
    ⟳ 正在生成报告大纲... (60%)
    ○ 正在生成报告内容...
    ○ 正在优化报告格式...
    ```
  - **实时生成内容展示**：
    - 使用消息气泡展示 AI 生成的内容
    - 打字机效果逐字显示
    - 按章节分段展示（如：标题、摘要、正文等）
  - **进度条**：顶部或底部显示整体生成进度（0-100%）
  - **估计时间**：预计还需 X 秒...
  - **取消按钮**：支持中途取消生成

- **生成完成状态**：

  - 显示成功提示：报告生成成功！
  - 显示完整的生成摘要：
    - 生成时间：X 秒
    - 引用文档数量：X 篇
    - 报告字数：X 字
  - 显示操作按钮：保存报告、下载报告、重新生成

- **生成失败状态**：
  - 显示错误信息：报告生成失败，原因...
  - 提供操作选项：重新生成、返回修改配置
  - 显示错误详情（可折叠）

#### 预览区域设计（右侧或下方）

- **布局方式**：

  - 大屏幕（>1440px）：右侧固定区域，占 40% 宽度
  - 中等屏幕：下方区域，可折叠
  - 移动端：独立标签页

- **预览内容展示**：

  - **报告标题**：显示报告名称
  - **报告元信息**：项目名称、报告类型、生成时间
  - **报告目录**：自动生成的报告目录，支持锚点跳转
  - **报告正文**：
    - 使用富文本格式展示
    - 支持标题、段落、列表、表格等格式
    - 关键内容高亮显示
  - **滚动同步**：生成区域和预览区域可以同步滚动

- **预览工具栏**：
  - **字体大小**：支持调整预览字体大小
  - **全屏预览**：支持全屏查看报告
  - **导出预览**：预览导出后的 PDF/Word 效果
  - **编辑模式**：支持切换到编辑模式（见下方）

#### 交互式编辑功能（生成后可用）

- **快速编辑**：

  - 点击报告内容进入编辑状态
  - 支持富文本编辑（粗体、斜体、列表等）
  - 自动保存编辑内容

- **AI 优化**：

  - 选中某段内容，可请求 AI 重新优化
  - 输入优化要求（如：更专业、更简洁）
  - AI 生成优化版本，用户可选择采用或放弃

- **补充内容**：
  - 在任意位置插入新内容
  - 可以让 AI 根据上下文生成建议内容
  - 支持手动输入补充内容

#### 操作按钮设计

- **开始生成**（配置完成后）：

  - 位置：配置区域下方，居中显示
  - 样式：大号 Primary 按钮
  - 文字：开始生成报告
  - 快捷键：Ctrl+Enter

- **保存报告**（生成完成后）：

  - 位置：操作区域
  - 样式：Primary 按钮
  - 功能：保存到报告列表
  - 提示：保存成功后跳转到报告列表

- **下载报告**（生成完成后）：

  - 位置：操作区域
  - 样式：边框 Primary 按钮
  - 支持格式：PDF、Word、Markdown
  - 下载提示：生成文件需要几秒钟...

- **重新生成**（生成完成后）：

  - 位置：操作区域
  - 样式：次要按钮
  - 功能：返回配置区域，可修改参数重新生成
  - 确认提示：当前内容将被覆盖，是否继续？

- **返回列表**：
  - 位置：页面头部
  - 样式：文字按钮或面包屑
  - 未保存提示：有未保存的报告，是否保存？

#### 响应式设计

- **桌面端（>1200px）**：

  - 配置区域在顶部（占 30% 高度）
  - 生成交互区域和预览区域左右分栏（各占 50%）

- **平板端（768px - 1200px）**：

  - 配置区域在顶部
  - 生成交互区域和预览区域上下分栏
  - 预览区域可折叠

- **移动端（<768px）**：
  - 配置区域、生成区域、预览区域独立标签页
  - 底部固定操作按钮

### 📝 报告列表页面设计（辅助页面）

用于查看历史生成的报告，支持快速访问和管理。

#### 页面结构

1. **页面标题**：报告管理
2. **操作区域**：生成新报告按钮（右上角）
3. **筛选区域**：关键词搜索、报告类型筛选、时间筛选
4. **列表区域**：报告卡片列表或表格列表
5. **分页区域**：分页组件

#### 筛选功能设计

- **关键词搜索**：

  - 输入框：支持项目名称、报告内容搜索
  - 占位符：请输入项目名称或关键词
  - 搜索按钮：立即搜索

- **报告类型筛选**：

  - 选项：全部、科技报告、自评报告
  - 默认值：全部
  - 样式：标签页或下拉选择

- **时间筛选**：
  - 快捷选择：最近一周、最近一月、最近三月、全部
  - 自定义范围：日期范围选择器
  - 默认值：全部

#### 列表展示设计

**建议使用卡片列表，更直观**

- **报告卡片**：

  - **卡片头部**：
    - 报告类型标签（左上角）：科技报告/自评报告
    - 操作菜单（右上角）：编辑、下载、删除
  - **卡片内容**：
    - 项目名称（大字体、粗体）
    - 报告摘要（2-3 行，超出省略）
    - 生成时间、报告字数、引用文档数
  - **卡片底部**：
    - 查看详情按钮
    - 重新生成按钮
    - 下载按钮

- **卡片布局**：
  - 桌面端：3 列网格
  - 平板端：2 列网格
  - 移动端：1 列列表

**或使用表格列表，更紧凑**

- **报告类型**：宽度 100px，标签显示
- **项目名称**：宽度 200px，左对齐，超长省略
- **生成时间**：宽度 150px，居中
- **报告字数**：宽度 100px，居中
- **操作**：宽度 180px，操作按钮组

#### 报告类型标签设计

- **科技报告**：主色调标签，图标 📄
- **自评报告**：辅助色标签，图标 📊

#### 操作按钮设计

- **查看详情**：

  - 点击进入报告详情页（或打开预览弹窗）
  - 显示完整报告内容
  - 支持编辑和重新生成

- **下载报告**：

  - 支持多种格式：PDF、Word、Markdown
  - 文件名：项目名称*报告类型*日期.格式

- **重新生成**：

  - 基于原项目和原配置重新生成
  - 确认提示：重新生成将覆盖当前报告，是否继续？

- **删除报告**：
  - 二次确认：删除后不可恢复，是否确认删除？
  - 删除成功提示

#### 空状态设计

- **无报告时**：
  - 显示空状态插图
  - 提示文字：暂无报告，快去生成第一份报告吧！
  - 操作按钮：立即生成报告

#### 批量操作（可选）

- **批量选择**：支持多选报告
- **批量下载**：批量下载选中的报告
- **批量删除**：批量删除选中的报告

## 🔧 技术实现要求

### Vue 组件结构

```javascript
// 报告生成组件结构
{
  data: {
    // 配置数据
    config: {
      projectId: '',
      projectInfo: null,
      reportType: 'tech',  // tech: 科技报告, self: 自评报告
      style: 'formal',     // formal: 正式, academic: 学术, concise: 简洁
      detail: 'standard',  // brief: 简要, standard: 标准, detailed: 详细
      specialRequirements: ''
    },

    // 项目列表
    projects: [],
    loadingProjects: false,

    // 生成状态
    generating: false,
    generateProgress: 0,
    generateSteps: [
      { name: '读取项目知识库', status: 'pending', progress: 0 },
      { name: '分析项目文档内容', status: 'pending', progress: 0 },
      { name: '提取关键信息', status: 'pending', progress: 0 },
      { name: '生成报告大纲', status: 'pending', progress: 0 },
      { name: '生成报告内容', status: 'pending', progress: 0 },
      { name: '优化报告格式', status: 'pending', progress: 0 }
    ],

    // 生成内容
    generateMessages: [],  // AI 生成过程消息列表
    reportContent: null,   // 最终生成的报告内容
    reportMetadata: {
      generatedTime: 0,
      wordCount: 0,
      refDocsCount: 0
    },

    // 预览状态
    previewVisible: true,
    previewFullscreen: false,
    editMode: false,

    // WebSocket 连接
    wsConnected: false,
    wsReconnectTimer: null
  },

  methods: {
    // 初始化和数据加载
    init(),
    loadProjects(),
    loadProjectInfo(projectId),

    // 项目选择
    handleProjectChange(projectId),
    getProjectKnowledgeBaseInfo(projectId),

    // 报告生成
    handleStartGenerate(),
    connectWebSocket(),
    handleGenerateMessage(message),
    handleGenerateComplete(report),
    handleGenerateError(error),
    handleCancelGenerate(),

    // 进度更新
    updateStepStatus(stepIndex, status, progress),
    addGenerateMessage(type, content),

    // 报告预览和编辑
    togglePreview(),
    toggleFullscreen(),
    enterEditMode(),
    exitEditMode(),
    handleContentEdit(section, newContent),

    // AI 优化
    handleAIOptimize(section, requirement),
    handleAISuggestion(position),

    // 报告保存和下载
    handleSaveReport(),
    handleDownloadReport(format),
    handleRegenerate(),

    // WebSocket 处理
    sendWSMessage(data),
    reconnectWebSocket(),
    closeWebSocket()
  },

  computed: {
    canGenerate() {
      return this.config.projectId && this.config.reportType && !this.generating
    },
    isGenerateComplete() {
      return this.reportContent !== null && !this.generating
    },
    reportTitle() {
      const typeMap = { tech: '科技报告', self: '自评报告' }
      return `${this.config.projectInfo?.name} - ${typeMap[this.config.reportType]}`
    }
  },

  watch: {
    'config.projectId'(val) {
      if (val) {
        this.loadProjectInfo(val)
        this.getProjectKnowledgeBaseInfo(val)
      }
    }
  }
}

// 报告列表组件结构
{
  data: {
    // 报告列表
    reports: [],
    loading: false,

    // 搜索筛选
    searchForm: {
      keyword: '',
      reportType: '',    // 全部, tech, self
      timeRange: 'all'   // all, week, month, quarter
    },

    // 分页
    pagination: {
      current: 1,
      size: 12,  // 卡片布局建议 12 个（3列*4行）
      total: 0
    },

    // 列表模式
    viewMode: 'card',  // card: 卡片, table: 表格

    // 操作状态
    downloadingId: null,
    deletingId: null,

    // 报告详情弹窗
    showDetailDialog: false,
    currentReport: null
  },

  methods: {
    // 数据加载
    loadReports(),
    handleSearch(),
    handleFilterChange(),
    handlePageChange(page),

    // 报告操作
    handleViewDetail(report),
    handleDownload(report, format),
    handleRegenerate(report),
    handleDelete(report),

    // 批量操作
    handleBatchSelect(reportIds),
    handleBatchDownload(),
    handleBatchDelete(),

    // 视图切换
    toggleViewMode(mode),

    // 跳转到生成页面
    goToGenerate(projectId)
  },

  computed: {
    filteredReports() {
      // 根据筛选条件过滤报告列表
    },
    hasReports() {
      return this.reports.length > 0
    }
  }
}
```

### Dify AI 集成实现

- **WebSocket 连接**：实时接收 Dify 生成的报告内容
- **流式输出**：支持流式接收报告内容，实现打字机效果
- **知识库调用**：自动关联项目知识库，调用 Dify 知识库 API
- **提示词模板**：预设科技报告和自评报告的提示词模板
- **错误重试**：网络异常时自动重试机制

### 报告生成流程实现

1. **用户配置阶段**：

   - 选择项目（加载项目信息和知识库信息）
   - 选择报告类型和生成参数
   - 验证配置完整性

2. **生成准备阶段**：

   - 建立 WebSocket 连接到 Dify
   - 构建生成请求参数
   - 发送生成请求

3. **实时生成阶段**：

   - 接收 WebSocket 消息
   - 更新生成步骤和进度
   - 实时展示生成内容（打字机效果）
   - 同步更新预览区域

4. **生成完成阶段**：
   - 整理完整报告内容
   - 显示生成摘要信息
   - 提供保存和下载选项

### 打字机效果实现

- **逐字显示**：使用定时器逐字显示 AI 生成的文本
- **速度控制**：可调节显示速度（默认 30ms/字）
- **暂停和继续**：支持暂停和继续播放
- **跳过动画**：支持直接显示完整内容

### 报告预览实现

- **实时渲染**：使用 Markdown 或富文本组件实时渲染报告
- **目录导航**：自动提取标题生成目录，支持锚点跳转
- **格式化展示**：支持标题、段落、列表、表格等格式
- **响应式布局**：适配不同屏幕尺寸

### 报告编辑实现

- **富文本编辑器**：集成 TinyMCE 或 Quill 富文本编辑器
- **实时保存**：编辑内容自动保存到本地
- **版本对比**：支持查看原始版本和编辑后版本
- **AI 辅助优化**：选中内容可调用 AI 重新优化

### 报告导出实现

- **PDF 导出**：使用 jsPDF 或服务端生成 PDF
- **Word 导出**：使用 docx.js 或服务端生成 Word 文档
- **Markdown 导出**：直接导出 Markdown 格式
- **自定义模板**：支持使用自定义报告模板

## ✅ 质量检查标准

### 功能完整性

- [ ] 项目选择功能正常
- [ ] 报告类型选择功能正常
- [ ] 报告生成功能正常
- [ ] 生成进度实时更新
- [ ] 打字机效果流畅
- [ ] 报告预览功能正常
- [ ] 报告编辑功能正常
- [ ] AI 优化功能正常
- [ ] 报告保存功能正常
- [ ] 报告下载功能正常（PDF、Word、Markdown）
- [ ] 报告列表显示完整
- [ ] 报告搜索筛选正常
- [ ] WebSocket 连接稳定

### 视觉一致性

- [ ] 颜色使用符合规范
- [ ] 配置区域样式统一
- [ ] 生成消息气泡样式美观
- [ ] 预览区域样式专业
- [ ] 按钮样式统一
- [ ] 卡片样式统一
- [ ] 间距使用符合规范
- [ ] 响应式布局适配良好

### 交互体验

- [ ] 项目选择交互流畅
- [ ] 生成过程可视化清晰
- [ ] 打字机效果自然
- [ ] 预览滚动同步流畅
- [ ] 编辑模式切换自然
- [ ] 操作反馈及时明确
- [ ] 加载状态处理正确
- [ ] 错误提示友好
- [ ] 成功提示清晰

### AI 生成体验

- [ ] 生成步骤展示清晰
- [ ] 进度更新实时准确
- [ ] 内容生成流畅自然
- [ ] 可以中途取消生成
- [ ] 生成失败有重试机制
- [ ] 生成结果质量可预览
- [ ] AI 优化功能好用

### 数据处理

- [ ] 知识库数据加载正常
- [ ] 项目信息显示完整
- [ ] 报告内容保存完整
- [ ] 分页功能正常
- [ ] 搜索筛选准确
- [ ] 数据加载状态处理
- [ ] 错误状态处理
- [ ] 空状态处理

### 性能优化

- [ ] 页面加载速度快
- [ ] 生成过程不卡顿
- [ ] 预览渲染流畅
- [ ] 大文档编辑不卡顿
- [ ] WebSocket 性能良好
- [ ] 内存使用合理

## 🚀 输出要求

### 文件命名

- 报告生成页面：`报告生成.html`
- 报告列表页面：`报告列表.html`

### 保存位置

- `原型图/验收模块/报告生成.html`
- `原型图/验收模块/报告列表.html`

### 代码要求

- 完整的 HTML 文档结构
- Vue 3 Composition API 语法
- Element Plus 组件使用
- WebSocket 实时通信集成
- 打字机效果实现
- 富文本编辑器集成
- 报告导出功能集成
- 格式化良好的代码
- 详细的注释说明

### 功能演示

- 包含完整的交互逻辑
- 模拟真实的 AI 生成体验
- 展示各种生成状态效果
- 实现实时预览功能
- 支持报告编辑和优化
- 展示报告下载功能

### 特殊要求

- **AI 生成体验**：流畅自然的 AI 生成过程展示
- **实时交互**：类似 AI 对话的交互体验
- **打字机效果**：逐字显示 AI 生成内容
- **实时预览**：边生成边预览报告内容
- **交互式编辑**：支持对生成内容的即时调整
- **多格式导出**：支持 PDF、Word、Markdown 格式导出
- **响应式设计**：适配桌面端、平板端、移动端

## 📝 设计参考和灵感

### 参考 AI 助手模块

报告生成页面的交互体验应该参考 AI 助手模块的对话界面：

- **消息气泡设计**：参考 AI 对话的消息气泡样式
- **打字机效果**：参考 AI 回复的逐字显示效果
- **加载动画**：参考 AI 思考时的加载动画
- **实时反馈**：参考 AI 对话的实时反馈机制

### 关键差异点

虽然参考 AI 对话，但报告生成有其特殊性：

- **进度可视化**：需要明确显示生成的各个步骤和进度
- **结构化输出**：报告内容是结构化的（标题、章节、段落）
- **预览和编辑**：需要支持实时预览和后续编辑
- **多格式导出**：需要支持多种格式的导出功能

## 💡 实现建议

### 技术栈推荐

- **前端框架**：Vue 3 + Element Plus
- **状态管理**：Pinia（如果需要）
- **实时通信**：WebSocket（连接 Dify）
- **富文本编辑**：Quill 或 TinyMCE
- **Markdown 渲染**：marked.js + highlight.js
- **PDF 导出**：jsPDF 或服务端生成
- **Word 导出**：docx.js

### 开发优先级

1. **第一阶段**：报告生成核心功能

   - 项目选择和配置
   - WebSocket 连接和通信
   - 生成过程展示和进度更新
   - 基本预览功能

2. **第二阶段**：交互优化

   - 打字机效果实现
   - 实时预览同步
   - 编辑功能实现
   - AI 优化功能

3. **第三阶段**：导出和列表

   - 多格式导出功能
   - 报告保存功能
   - 报告列表页面
   - 报告管理功能

4. **第四阶段**：体验优化
   - 响应式适配
   - 性能优化
   - 错误处理优化
   - 用户体验细节打磨

## 🎯 总结

验收模块的核心是**智能报告生成**，而非传统的表单填写和流程审批。设计时应该：

1. **聚焦核心价值**：报告生成的智能化和自动化
2. **优化交互体验**：类似 AI 对话的自然流畅体验
3. **简化页面结构**：只需 2 个核心页面即可满足需求
4. **突出实时反馈**：让用户清晰看到 AI 工作的每个步骤
5. **支持后续调整**：生成后支持编辑和优化

通过这样的设计，用户可以快速、高效、智能地完成项目验收报告的生成工作，大大提升工作效率和用户体验。
