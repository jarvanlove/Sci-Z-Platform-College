<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>é¡¹ç›®åˆ—è¡¨ - é«˜æ ¡ç§‘ç ”é¡¹ç›®ç®¡ç†å¹³å°</title>
    <link rel="icon" href="../images/favicon.ico" type="image/x-icon" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/element-plus@2.3.14/dist/index.css"
    />
    <script src="https://unpkg.com/vue@3.2.47/dist/vue.global.prod.js"></script>
    <script src="https://unpkg.com/element-plus@2.3.14"></script>
    <script src="https://unpkg.com/dayjs@1.11.10/locale/zh-cn.js"></script>
    <link rel="stylesheet" href="../é€šç”¨è§„èŒƒ/æ ·å¼.css" />
    <style>
      .project-list-container {
        padding: 20px;
        background: #f7f9fc;
        min-height: calc(100vh - 56px);
      }

      .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .page-title {
        font-size: 24px;
        font-weight: 600;
        color: #1e3a8a;
        margin: 0;
      }

      .search-card {
        background: #ffffff;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
        border: 1px solid #e5e7eb;
      }

      .search-form {
        display: flex;
        gap: 16px;
        align-items: end;
      }

      .search-form .el-form-item {
        margin-bottom: 0;
      }

      .table-card {
        background: #ffffff;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
        border: 1px solid #e5e7eb;
      }

      .status-tag {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 500;
      }

      .status-planned {
        background-color: #dbeafe;
        color: #1e40af;
      }

      .status-progress {
        background-color: #fef3c7;
        color: #f59e0b;
      }

      .status-completed {
        background-color: #dcfce7;
        color: #16a34a;
      }

      .status-delayed {
        background-color: #fee2e2;
        color: #dc2626;
      }

      .operation-buttons {
        display: flex;
        gap: 8px;
      }

      .operation-buttons .el-button {
        padding: 4px 8px;
        font-size: 12px;
      }

      .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #6b7280;
      }

      .empty-state-icon {
        font-size: 48px;
        margin-bottom: 16px;
        opacity: 0.5;
      }

      .empty-state-text {
        font-size: 16px;
        margin-bottom: 8px;
      }

      .empty-state-hint {
        font-size: 14px;
        color: #9ca3af;
      }

      /* åŠ è½½çŠ¶æ€æ ·å¼ */
      .loading-container {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 40px;
        color: #6b7280;
        font-size: 14px;
      }

      .loading-container .el-icon {
        margin-right: 8px;
        font-size: 16px;
      }

      /* åŸç”ŸHTMLè¡¨æ ¼æ ·å¼ */
      .table-wrapper {
        overflow-x: auto;
      }

      .native-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
        color: #374151;
        background-color: #ffffff;
        border: 1px solid #e5e7eb;
      }

      /* è¡¨å¤´æ ·å¼ */
      .native-table thead th {
        background-color: #f5f5f5;
        color: #374151;
        font-weight: 600;
        padding: 12px 8px;
        border-right: 1px solid #e5e7eb;
        border-bottom: 1px solid #e5e7eb;
        text-align: left;
        white-space: nowrap;
      }

      /* è¡¨æ ¼å†…å®¹æ ·å¼ */
      .native-table tbody td {
        padding: 12px 8px;
        border-right: 1px solid #e5e7eb;
        border-bottom: 1px solid #e5e7eb;
        vertical-align: top;
      }

      /* æ–‘é©¬çº¹æ•ˆæœ */
      .native-table tbody tr:nth-child(even) {
        background-color: #f9fafb;
      }

      /* æ‚¬åœæ•ˆæœ */
      .native-table tbody tr:hover {
        background-color: #f3f4f6;
      }

      /* åˆ—å®½åº¦è®¾ç½® */
      .native-table .col-number {
        width: 150px;
        min-width: 120px;
      }

      .native-table .col-name {
        width: 250px;
        min-width: 200px;
      }

      .native-table .col-manager {
        width: 120px;
        min-width: 100px;
        text-align: center;
      }

      .native-table .col-status {
        width: 100px;
        text-align: center;
      }

      .native-table .col-progress {
        width: 120px;
      }

      .native-table .col-start-time {
        width: 140px;
        min-width: 120px;
        text-align: center;
      }

      .native-table .col-end-time {
        width: 140px;
        min-width: 120px;
        text-align: center;
      }

      .native-table .col-actions {
        width: 120px;
        text-align: center;
      }

      /* æœ€åä¸€åˆ—ä¸æ˜¾ç¤ºå³è¾¹æ¡† */
      .native-table thead th:last-child,
      .native-table tbody td:last-child {
        border-right: none;
      }

      /* è¿›åº¦æ¡æ ·å¼ */
      .progress-container {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .progress-bar {
        flex: 1;
        height: 6px;
        background-color: #e5e7eb;
        border-radius: 3px;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        border-radius: 3px;
        transition: width 0.3s ease;
      }

      .progress-fill.low {
        background-color: #dc2626;
      }

      .progress-fill.medium {
        background-color: #f59e0b;
      }

      .progress-fill.high {
        background-color: #16a34a;
      }

      .progress-text {
        font-size: 12px;
        color: #6b7280;
        min-width: 35px;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div class="project-list-container">
        <!-- é¡µé¢æ ‡é¢˜å’Œæ“ä½œ -->
        <div class="page-header">
          <h1 class="page-title">é¡¹ç›®ç®¡ç†</h1>
          <el-button type="primary" size="large" @click="handleNewProject">
            <el-icon><Plus /></el-icon>
            æ–°å»ºé¡¹ç›®
          </el-button>
        </div>

        <!-- æœç´¢ç­›é€‰åŒºåŸŸ -->
        <div class="search-card">
          <el-form :model="searchForm" class="search-form" label-width="100px">
            <el-form-item label="å…³é”®è¯æœç´¢">
              <el-input
                v-model="searchForm.keyword"
                placeholder="è¯·è¾“å…¥é¡¹ç›®åç§°æˆ–ç¼–å·"
                clearable
                style="width: 300px"
                @keyup.enter="handleSearch"
              >
                <template #prefix>
                  <el-icon><Search /></el-icon>
                </template>
              </el-input>
            </el-form-item>
            <el-form-item label="çŠ¶æ€ç­›é€‰">
              <el-select
                v-model="searchForm.status"
                placeholder="è¯·é€‰æ‹©çŠ¶æ€"
                clearable
                style="width: 150px"
                @change="handleStatusChange"
              >
                <el-option
                  v-for="option in statusOptions"
                  :key="option.value"
                  :label="option.label"
                  :value="option.value"
                />
              </el-select>
            </el-form-item>
            <el-form-item label="æ—¶é—´ç­›é€‰">
              <el-date-picker
                v-model="searchForm.dateRange"
                type="daterange"
                range-separator="è‡³"
                start-placeholder="å¼€å§‹æ—¥æœŸ"
                end-placeholder="ç»“æŸæ—¥æœŸ"
                style="width: 240px"
                format="YYYY-MM-DD"
                value-format="YYYY-MM-DD"
                @change="handleDateChange"
              />
            </el-form-item>
          </el-form>

          <!-- æŒ‰é’®è¡Œ -->
          <div
            style="display: flex; justify-content: flex-end; margin-top: 16px"
          >
            <el-button
              type="primary"
              @click="handleSearch"
              style="margin-right: 8px"
            >
              <el-icon><Search /></el-icon>
              æœç´¢
            </el-button>
            <el-button @click="handleReset">
              <el-icon><Refresh /></el-icon>
              é‡ç½®
            </el-button>
          </div>
        </div>

        <!-- é¡¹ç›®åˆ—è¡¨è¡¨æ ¼ -->
        <div class="table-card">
          <!-- åŠ è½½çŠ¶æ€ -->
          <div v-if="loading" class="loading-container">
            <el-icon class="is-loading"><Loading /></el-icon>
            <span>åŠ è½½ä¸­...</span>
          </div>

          <!-- åŸç”ŸHTMLè¡¨æ ¼ -->
          <div v-else class="table-wrapper">
            <table class="native-table">
              <thead>
                <tr>
                  <th class="col-number">é¡¹ç›®ç¼–å·</th>
                  <th class="col-name">é¡¹ç›®åç§°</th>
                  <th class="col-manager">é¡¹ç›®è´Ÿè´£äºº</th>
                  <th class="col-status">é¡¹ç›®çŠ¶æ€</th>
                  <th class="col-progress">è¿›åº¦</th>
                  <th class="col-start-time">å¼€å§‹æ—¶é—´</th>
                  <th class="col-end-time">é¢„è®¡å®Œæˆæ—¶é—´</th>
                  <th class="col-actions">æ“ä½œ</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="project in projects" :key="project.id">
                  <td class="col-number">{{ project.number }}</td>
                  <td class="col-name" :title="project.name">
                    {{ project.name }}
                  </td>
                  <td class="col-manager">{{ project.manager }}</td>
                  <td class="col-status">
                    <span
                      class="status-tag"
                      :class="`status-${project.status}`"
                    >
                      {{ getStatusText(project.status) }}
                    </span>
                  </td>
                  <td class="col-progress">
                    <div class="progress-container">
                      <div class="progress-bar">
                        <div
                          class="progress-fill"
                          :class="getProgressClass(project.progress)"
                          :style="{ width: project.progress + '%' }"
                        ></div>
                      </div>
                      <span class="progress-text">{{ project.progress }}%</span>
                    </div>
                  </td>
                  <td class="col-start-time">{{ project.startTime }}</td>
                  <td class="col-end-time">{{ project.endTime }}</td>
                  <td class="col-actions">
                    <div class="operation-buttons">
                      <el-button
                        type="primary"
                        size="small"
                        link
                        @click="handleView(project.id)"
                      >
                        æŸ¥çœ‹è¯¦æƒ…
                      </el-button>
                      <el-button
                        type="default"
                        size="small"
                        link
                        @click="handleEdit(project.id)"
                      >
                        ç¼–è¾‘
                      </el-button>
                      <el-button
                        v-if="project.canDelete"
                        type="danger"
                        size="small"
                        link
                        @click="handleDelete(project.id)"
                      >
                        åˆ é™¤
                      </el-button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- ç©ºçŠ¶æ€ -->
          <div v-if="!loading && projects.length === 0" class="empty-state">
            <div class="empty-state-icon">ğŸ“</div>
            <div class="empty-state-text">æš‚æ— é¡¹ç›®è®°å½•</div>
            <div class="empty-state-hint">
              ç‚¹å‡»"æ–°å»ºé¡¹ç›®"æŒ‰é’®å¼€å§‹æ‚¨çš„ç¬¬ä¸€ä¸ªé¡¹ç›®
            </div>
          </div>

          <!-- åˆ†é¡µ -->
          <div v-if="projects.length > 0" class="pagination-container">
            <!-- é€šç”¨åˆ†é¡µç»„ä»¶ -->
            <div id="pagination-component"></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const { createApp, ref, reactive, onMounted } = Vue;
      const { ElMessage, ElMessageBox } = ElementPlus;

      // æ³¨å†ŒLoadingå›¾æ ‡
      const Loading = {
        template:
          '<svg class="el-icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="currentColor" d="M512 64a32 32 0 0 1 32 32v192a32 32 0 0 1-64 0V96a32 32 0 0 1 32-32zm0 896a32 32 0 0 1-32-32V736a32 32 0 0 1 64 0v192a32 32 0 0 1-32 32zm448-480a32 32 0 0 1-32 32H736a32 32 0 0 1 0-64h192a32 32 0 0 1 32 32zM96 512a32 32 0 0 1 32-32h192a32 32 0 0 1 0 64H128a32 32 0 0 1-32-32zm778.24-200.96a32 32 0 0 1 45.248 45.248l-135.68 135.68a32 32 0 1 1-45.248-45.248l135.68-135.68zm-636.48 636.48a32 32 0 0 1 45.248 45.248l-135.68 135.68a32 32 0 1 1-45.248-45.248l135.68-135.68zM778.24 712.96a32 32 0 0 1-45.248 45.248l-135.68-135.68a32 32 0 1 1 45.248-45.248l135.68 135.68zM141.76 311.04a32 32 0 0 1-45.248-45.248l135.68-135.68a32 32 0 1 1 45.248 45.248l-135.68 135.68z"/></svg>',
      };

      createApp({
        components: {
          Loading,
        },
        setup() {
          // æ•°æ®çŠ¶æ€
          const loading = ref(false);

          // æœç´¢è¡¨å•
          const searchForm = reactive({
            keyword: "",
            status: "",
            dateRange: [],
          });

          // é¡¹ç›®åˆ—è¡¨æ•°æ®
          const projects = ref([]);

          // åˆ†é¡µä¿¡æ¯
          const pagination = reactive({
            current: 1,
            size: 10,
            total: 0,
          });

          // çŠ¶æ€é€‰é¡¹
          const statusOptions = ref([
            { label: "å…¨éƒ¨", value: "" },
            { label: "è®¡åˆ’ä¸­", value: "planned" },
            { label: "è¿›è¡Œä¸­", value: "progress" },
            { label: "å·²å®Œæˆ", value: "completed" },
            { label: "å·²å»¶æœŸ", value: "delayed" },
          ]);

          // æ¨¡æ‹Ÿé¡¹ç›®æ•°æ®
          const mockProjects = [
            {
              id: 1,
              number: "PRJ-2024-001",
              name: "åŸºäºäººå·¥æ™ºèƒ½çš„æ™ºèƒ½è¯Šæ–­ç³»ç»Ÿç ”ç©¶",
              manager: "å¼ æ•™æˆ",
              status: "progress",
              progress: 65,
              startTime: "2024-01-15",
              endTime: "2024-06-30",
              canDelete: true,
            },
            {
              id: 2,
              number: "PRJ-2024-002",
              name: "åŒºå—é“¾æŠ€æœ¯åœ¨ä¾›åº”é“¾ç®¡ç†ä¸­çš„åº”ç”¨",
              manager: "æåšå£«",
              status: "planned",
              progress: 0,
              startTime: "2024-02-01",
              endTime: "2024-08-31",
              canDelete: true,
            },
            {
              id: 3,
              number: "PRJ-2024-003",
              name: "å¤§æ•°æ®åˆ†æåœ¨åŒ»ç–—å¥åº·é¢†åŸŸçš„åº”ç”¨ç ”ç©¶",
              manager: "ç‹æ•™æˆ",
              status: "completed",
              progress: 100,
              startTime: "2023-09-01",
              endTime: "2024-01-31",
              canDelete: false,
            },
            {
              id: 4,
              number: "PRJ-2024-004",
              name: "ç‰©è”ç½‘æŠ€æœ¯åœ¨æ™ºæ…§åŸå¸‚å»ºè®¾ä¸­çš„åº”ç”¨",
              manager: "èµµåšå£«",
              status: "delayed",
              progress: 45,
              startTime: "2023-12-01",
              endTime: "2024-03-31",
              canDelete: true,
            },
            {
              id: 5,
              number: "PRJ-2024-005",
              name: "æœºå™¨å­¦ä¹ ç®—æ³•ä¼˜åŒ–ç ”ç©¶",
              manager: "é™ˆæ•™æˆ",
              status: "progress",
              progress: 80,
              startTime: "2024-01-01",
              endTime: "2024-05-31",
              canDelete: true,
            },
          ];

          // è·å–çŠ¶æ€æ–‡æœ¬
          const getStatusText = (status) => {
            const statusMap = {
              planned: "è®¡åˆ’ä¸­",
              progress: "è¿›è¡Œä¸­",
              completed: "å·²å®Œæˆ",
              delayed: "å·²å»¶æœŸ",
            };
            return statusMap[status] || "æœªçŸ¥";
          };

          // è·å–è¿›åº¦æ¡é¢œè‰²ç±»
          const getProgressClass = (progress) => {
            if (progress <= 30) return "low";
            if (progress <= 70) return "medium";
            return "high";
          };

          // åŠ è½½é¡¹ç›®åˆ—è¡¨
          const loadProjects = async () => {
            try {
              loading.value = true;

              // æ¨¡æ‹ŸAPIè°ƒç”¨å»¶è¿Ÿ
              await new Promise((resolve) => setTimeout(resolve, 1000));

              // åº”ç”¨ç­›é€‰æ¡ä»¶
              let filteredProjects = [...mockProjects];

              if (searchForm.keyword) {
                filteredProjects = filteredProjects.filter(
                  (project) =>
                    project.name.includes(searchForm.keyword) ||
                    project.number.includes(searchForm.keyword)
                );
              }

              if (searchForm.status) {
                filteredProjects = filteredProjects.filter(
                  (project) => project.status === searchForm.status
                );
              }

              // åº”ç”¨åˆ†é¡µ
              const start = (pagination.current - 1) * pagination.size;
              const end = start + pagination.size;

              projects.value = filteredProjects.slice(start, end);
              pagination.total = filteredProjects.length;
            } catch (error) {
              ElMessage.error("åŠ è½½é¡¹ç›®åˆ—è¡¨å¤±è´¥ï¼Œè¯·é‡è¯•");
            } finally {
              loading.value = false;
              // æ•°æ®åŠ è½½å®Œæˆåé‡æ–°åˆå§‹åŒ–åˆ†é¡µç»„ä»¶
              setTimeout(() => {
                initPagination();
              }, 100);
            }
          };

          // æœç´¢å¤„ç†
          const handleSearch = () => {
            pagination.current = 1;
            loadProjects();
            ElMessage.info("æœç´¢å®Œæˆ");
          };

          // çŠ¶æ€ç­›é€‰å¤„ç†
          const handleStatusChange = () => {
            pagination.current = 1;
            loadProjects();
          };

          // æ—¶é—´ç­›é€‰å¤„ç†
          const handleDateChange = () => {
            pagination.current = 1;
            loadProjects();
          };

          // é‡ç½®æœç´¢
          const handleReset = () => {
            searchForm.keyword = "";
            searchForm.status = "";
            searchForm.dateRange = [];
            pagination.current = 1;
            loadProjects();
            ElMessage.info("å·²é‡ç½®æœç´¢æ¡ä»¶");
          };

          // æ–°å»ºé¡¹ç›®
          const handleNewProject = () => {
            ElMessage.info("è·³è½¬åˆ°æ–°å»ºé¡¹ç›®é¡µé¢");
            // æ£€æŸ¥æ˜¯å¦åœ¨iframeä¸­
            if (window.parent !== window) {
              window.parent.postMessage(
                {
                  type: "navigate",
                  path: "project/create",
                },
                "*"
              );
            } else {
              window.location.href = "æ–°å»ºé¡¹ç›®.html";
            }
          };

          // æŸ¥çœ‹è¯¦æƒ…
          const handleView = (id) => {
            ElMessage.info(`æŸ¥çœ‹é¡¹ç›®è¯¦æƒ…ï¼šID ${id}`);
            // æ£€æŸ¥æ˜¯å¦åœ¨iframeä¸­
            if (window.parent !== window) {
              window.parent.postMessage(
                {
                  type: "navigate",
                  path: "project/detail",
                  params: { id },
                },
                "*"
              );
            } else {
              window.location.href = "é¡¹ç›®è¯¦æƒ….html";
            }
          };

          // ç¼–è¾‘é¡¹ç›®
          const handleEdit = (id) => {
            ElMessage.info(`ç¼–è¾‘é¡¹ç›®ï¼šID ${id}`);
            // è¿™é‡Œåº”è¯¥è·³è½¬åˆ°é¡¹ç›®ç¼–è¾‘é¡µé¢
          };

          // åˆ é™¤é¡¹ç›®
          const handleDelete = async (id) => {
            try {
              await ElMessageBox.confirm(
                "ç¡®å®šè¦åˆ é™¤æ­¤é¡¹ç›®å—ï¼Ÿåˆ é™¤åå°†æ— æ³•æ¢å¤ã€‚",
                "ç¡®è®¤åˆ é™¤",
                {
                  confirmButtonText: "ç¡®å®šåˆ é™¤",
                  cancelButtonText: "å–æ¶ˆ",
                  type: "warning",
                }
              );
              ElMessage.success("é¡¹ç›®å·²åˆ é™¤");
              loadProjects();
            } catch {
              ElMessage.info("å·²å–æ¶ˆåˆ é™¤");
            }
          };

          // åˆå§‹åŒ–åˆ†é¡µç»„ä»¶
          const initPagination = () => {
            const paginationContainer = document.getElementById(
              "pagination-component"
            );
            if (paginationContainer) {
              // åˆ›å»ºåˆ†é¡µç»„ä»¶HTML
              const paginationHTML = `
                <div class="pagination-container">
                  <!-- åˆ†é¡µä¿¡æ¯ -->
                  <div class="pagination-info">
                    å…± ${pagination.total} æ¡è®°å½•
                  </div>

                  <!-- æ¯é¡µæ˜¾ç¤ºæ•°é‡é€‰æ‹©å™¨ -->
                  <div class="page-size-selector">
                    æ¯é¡µæ˜¾ç¤º
                    <select id="page-size-select">
                      <option value="10" ${
                        pagination.size === 10 ? "selected" : ""
                      }>10 æ¡</option>
                      <option value="20" ${
                        pagination.size === 20 ? "selected" : ""
                      }>20 æ¡</option>
                      <option value="50" ${
                        pagination.size === 50 ? "selected" : ""
                      }>50 æ¡</option>
                    </select>
                  </div>

                  <!-- åˆ†é¡µæ§åˆ¶å™¨ -->
                  <div class="pagination-controls">
                    <!-- ä¸Šä¸€é¡µæŒ‰é’® -->
                    <a href="javascript:void(0)" class="page-btn ${
                      pagination.current === 1 ? "disabled" : ""
                    }" id="prev-btn">
                      ä¸Šä¸€é¡µ
                    </a>

                    <!-- é¡µç æŒ‰é’® -->
                    <div class="page-nav" id="page-nav">
                      ${generatePageButtons()}
                    </div>

                    <!-- ä¸‹ä¸€é¡µæŒ‰é’® -->
                    <a href="javascript:void(0)" class="page-btn ${
                      pagination.current ===
                      Math.ceil(pagination.total / pagination.size)
                        ? "disabled"
                        : ""
                    }" id="next-btn">
                      ä¸‹ä¸€é¡µ
                    </a>
                  </div>

                  <!-- å¿«é€Ÿè·³è½¬ -->
                  <div class="page-jumper">
                    è·³è‡³
                    <input type="number" id="jump-input" value="${
                      pagination.current
                    }" min="1" max="${Math.ceil(
                pagination.total / pagination.size
              )}">
                    é¡µ
                    <button class="jump-btn" id="jump-btn">ç¡®å®š</button>
                  </div>
                </div>
              `;

              paginationContainer.innerHTML = paginationHTML;

              // ç»‘å®šäº‹ä»¶
              bindPaginationEvents();
            }
          };

          // ç”Ÿæˆé¡µç æŒ‰é’®
          const generatePageButtons = () => {
            const totalPages = Math.ceil(pagination.total / pagination.size);
            const current = pagination.current;
            const pagerCount = 7; // æ˜¾ç¤ºçš„é¡µç æ•°é‡

            let buttons = "";

            if (totalPages <= pagerCount) {
              // æ€»é¡µæ•°å°äºç­‰äºæ˜¾ç¤ºæ•°é‡ï¼Œæ˜¾ç¤ºæ‰€æœ‰é¡µç 
              for (let i = 1; i <= totalPages; i++) {
                buttons += `<a href="javascript:void(0)" class="page-btn ${
                  i === current ? "active" : ""
                }" data-page="${i}">${i}</a>`;
              }
            } else {
              // è®¡ç®—ä¸­é—´é¡µç èŒƒå›´
              const half = Math.floor(pagerCount / 2);
              let start = Math.max(1, current - half);
              let end = Math.min(totalPages, start + pagerCount - 1);

              // è°ƒæ•´èµ·å§‹ä½ç½®
              if (end - start + 1 < pagerCount) {
                start = Math.max(1, end - pagerCount + 1);
              }

              // ç¬¬ä¸€é¡µ
              if (start > 1) {
                buttons += `<a href="javascript:void(0)" class="page-btn ${
                  1 === current ? "active" : ""
                }" data-page="1">1</a>`;
                if (start > 2) {
                  buttons += '<span class="page-ellipsis">...</span>';
                }
              }

              // ä¸­é—´é¡µç 
              for (let i = start; i <= end; i++) {
                buttons += `<a href="javascript:void(0)" class="page-btn ${
                  i === current ? "active" : ""
                }" data-page="${i}">${i}</a>`;
              }

              // æœ€åä¸€é¡µ
              if (end < totalPages) {
                if (end < totalPages - 1) {
                  buttons += '<span class="page-ellipsis">...</span>';
                }
                buttons += `<a href="javascript:void(0)" class="page-btn ${
                  totalPages === current ? "active" : ""
                }" data-page="${totalPages}">${totalPages}</a>`;
              }
            }

            return buttons;
          };

          // ç»‘å®šåˆ†é¡µäº‹ä»¶
          const bindPaginationEvents = () => {
            // æ¯é¡µæ˜¾ç¤ºæ•°é‡å˜åŒ–
            const pageSizeSelect = document.getElementById("page-size-select");
            if (pageSizeSelect) {
              pageSizeSelect.addEventListener("change", (e) => {
                pagination.size = parseInt(e.target.value);
                pagination.current = 1;
                loadProjects();
                initPagination(); // é‡æ–°åˆå§‹åŒ–åˆ†é¡µç»„ä»¶
              });
            }

            // ä¸Šä¸€é¡µ
            const prevBtn = document.getElementById("prev-btn");
            if (prevBtn) {
              prevBtn.addEventListener("click", () => {
                if (pagination.current > 1) {
                  pagination.current--;
                  loadProjects();
                  initPagination();
                }
              });
            }

            // ä¸‹ä¸€é¡µ
            const nextBtn = document.getElementById("next-btn");
            if (nextBtn) {
              nextBtn.addEventListener("click", () => {
                const totalPages = Math.ceil(
                  pagination.total / pagination.size
                );
                if (pagination.current < totalPages) {
                  pagination.current++;
                  loadProjects();
                  initPagination();
                }
              });
            }

            // é¡µç ç‚¹å‡»
            const pageNav = document.getElementById("page-nav");
            if (pageNav) {
              pageNav.addEventListener("click", (e) => {
                if (
                  e.target.classList.contains("page-btn") &&
                  !e.target.classList.contains("active")
                ) {
                  const page = parseInt(e.target.getAttribute("data-page"));
                  if (page && page !== pagination.current) {
                    pagination.current = page;
                    loadProjects();
                    initPagination();
                  }
                }
              });
            }

            // å¿«é€Ÿè·³è½¬
            const jumpBtn = document.getElementById("jump-btn");
            const jumpInput = document.getElementById("jump-input");
            if (jumpBtn && jumpInput) {
              const handleJump = () => {
                const page = parseInt(jumpInput.value);
                const totalPages = Math.ceil(
                  pagination.total / pagination.size
                );
                if (
                  page &&
                  page >= 1 &&
                  page <= totalPages &&
                  page !== pagination.current
                ) {
                  pagination.current = page;
                  loadProjects();
                  initPagination();
                } else {
                  jumpInput.value = pagination.current;
                }
              };

              jumpBtn.addEventListener("click", handleJump);
              jumpInput.addEventListener("keyup", (e) => {
                if (e.key === "Enter") {
                  handleJump();
                }
              });
            }
          };

          // ç»„ä»¶æŒ‚è½½æ—¶åŠ è½½æ•°æ®
          onMounted(() => {
            console.log("é¡¹ç›®åˆ—è¡¨é¡µé¢åŠ è½½ä¸­...");
            loadProjects();
          });

          return {
            loading,
            searchForm,
            projects,
            pagination,
            statusOptions,
            getStatusText,
            getProgressClass,
            handleSearch,
            handleStatusChange,
            handleDateChange,
            handleReset,
            handleNewProject,
            handleView,
            handleEdit,
            handleDelete,
          };
        },
      })
        .use(ElementPlus, {
          locale: {
            name: "zh-cn",
            el: {
              datepicker: {
                now: "æ­¤åˆ»",
                today: "ä»Šå¤©",
                cancel: "å–æ¶ˆ",
                clear: "æ¸…ç©º",
                confirm: "ç¡®è®¤",
                selectDate: "é€‰æ‹©æ—¥æœŸ",
                selectTime: "é€‰æ‹©æ—¶é—´",
                startDate: "å¼€å§‹æ—¥æœŸ",
                startTime: "å¼€å§‹æ—¶é—´",
                endDate: "ç»“æŸæ—¥æœŸ",
                endTime: "ç»“æŸæ—¶é—´",
                prevYear: "å‰ä¸€å¹´",
                nextYear: "åä¸€å¹´",
                prevMonth: "ä¸Šä¸ªæœˆ",
                nextMonth: "ä¸‹ä¸ªæœˆ",
                year: "å¹´",
                month1: "1æœˆ",
                month2: "2æœˆ",
                month3: "3æœˆ",
                month4: "4æœˆ",
                month5: "5æœˆ",
                month6: "6æœˆ",
                month7: "7æœˆ",
                month8: "8æœˆ",
                month9: "9æœˆ",
                month10: "10æœˆ",
                month11: "11æœˆ",
                month12: "12æœˆ",
                weeks: {
                  sun: "æ—¥",
                  mon: "ä¸€",
                  tue: "äºŒ",
                  wed: "ä¸‰",
                  thu: "å››",
                  fri: "äº”",
                  sat: "å…­",
                },
                months: {
                  jan: "ä¸€æœˆ",
                  feb: "äºŒæœˆ",
                  mar: "ä¸‰æœˆ",
                  apr: "å››æœˆ",
                  may: "äº”æœˆ",
                  jun: "å…­æœˆ",
                  jul: "ä¸ƒæœˆ",
                  aug: "å…«æœˆ",
                  sep: "ä¹æœˆ",
                  oct: "åæœˆ",
                  nov: "åä¸€æœˆ",
                  dec: "åäºŒæœˆ",
                },
              },
            },
          },
        })
        .mount("#app");
    </script>
  </body>
</html>
