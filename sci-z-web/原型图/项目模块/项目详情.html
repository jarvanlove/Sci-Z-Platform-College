<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>项目详情 - 高校科研项目管理平台</title>
    <link rel="icon" href="../images/favicon.ico" type="image/x-icon" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/element-plus@2.3.14/dist/index.css"
    />
    <script src="https://unpkg.com/vue@3.2.47/dist/vue.global.prod.js"></script>
    <script src="https://unpkg.com/element-plus@2.3.14"></script>
    <link rel="stylesheet" href="../通用规范/样式.css" />
    <style>
      .project-detail-container {
        padding: 20px;
        background: #f7f9fc;
        min-height: calc(100vh - 56px);
      }

      .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .page-title {
        font-size: 24px;
        font-weight: 600;
        color: #1e3a8a;
        margin: 0;
      }

      .content-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
      }

      .main-content {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .sidebar-content {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .card {
        background: #ffffff;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
        border: 1px solid #e5e7eb;
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 1px solid #e5e7eb;
      }

      .card-title {
        font-size: 16px;
        font-weight: 600;
        color: #111827;
        margin: 0;
      }

      .info-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
      }

      .info-item {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .info-label {
        font-size: 14px;
        color: #6b7280;
        font-weight: 500;
      }

      .info-value {
        font-size: 14px;
        color: #374151;
      }

      .status-tag {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 500;
      }

      .status-progress {
        background-color: #fef3c7;
        color: #f59e0b;
      }

      /* 成员管理样式 */
      .member-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .member-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        background: #f8fafc;
        border-radius: 6px;
      }

      .member-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: #e5e7eb;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #6b7280;
        font-weight: 600;
      }

      .member-info {
        flex: 1;
      }

      .member-name {
        font-size: 14px;
        font-weight: 500;
        color: #374151;
        margin-bottom: 2px;
      }

      .member-role {
        font-size: 12px;
        color: #6b7280;
      }

      .member-actions {
        display: flex;
        gap: 8px;
      }

      .add-member-section {
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid #e5e7eb;
      }

      .search-member {
        display: flex;
        gap: 8px;
        margin-bottom: 12px;
      }

      .search-results {
        max-height: 200px;
        overflow-y: auto;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        background: #ffffff;
      }

      .search-result-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 8px 12px;
        cursor: pointer;
        border-bottom: 1px solid #f3f4f6;
      }

      .search-result-item:hover {
        background: #f8fafc;
      }

      .search-result-item:last-child {
        border-bottom: none;
      }

      /* 文档管理样式 */
      .document-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .document-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        background: #f8fafc;
        border-radius: 6px;
      }

      .document-icon {
        width: 32px;
        height: 32px;
        border-radius: 4px;
        background: #dbeafe;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #1e40af;
      }

      .document-info {
        flex: 1;
      }

      .document-name {
        font-size: 14px;
        font-weight: 500;
        color: #374151;
        margin-bottom: 2px;
      }

      .document-meta {
        font-size: 12px;
        color: #6b7280;
      }

      .document-actions {
        display: flex;
        gap: 8px;
      }

      .upload-section {
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid #e5e7eb;
      }

      .upload-area {
        border: 2px dashed #d1d5db;
        border-radius: 6px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
        transition: border-color 0.3s;
      }

      .upload-area:hover {
        border-color: #1e3a8a;
      }

      .upload-area.dragover {
        border-color: #1e3a8a;
        background: #f0f9ff;
      }

      .upload-icon {
        font-size: 24px;
        color: #9ca3af;
        margin-bottom: 8px;
      }

      .upload-text {
        font-size: 14px;
        color: #6b7280;
        margin-bottom: 4px;
      }

      .upload-hint {
        font-size: 12px;
        color: #9ca3af;
      }

      /* 操作按钮区域 */
      .action-buttons {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid #e5e7eb;
      }

      .loading-container {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 40px;
        color: #6b7280;
        font-size: 14px;
      }

      .loading-container .el-icon {
        margin-right: 8px;
        font-size: 16px;
      }

      .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #6b7280;
      }

      .empty-state-icon {
        font-size: 48px;
        margin-bottom: 16px;
        opacity: 0.5;
      }

      .empty-state-text {
        font-size: 16px;
        margin-bottom: 8px;
      }

      .empty-state-hint {
        font-size: 14px;
        color: #9ca3af;
      }

      /* 响应式设计 */
      @media (max-width: 768px) {
        .content-grid {
          grid-template-columns: 1fr;
        }

        .info-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div class="project-detail-container">
        <!-- 页面头部 -->
        <div class="page-header">
          <h1 class="page-title">项目详情</h1>
          <div>
            <el-button @click="handleBack">
              <el-icon><ArrowLeft /></el-icon>
              返回列表
            </el-button>
            <el-button type="primary" @click="handleEdit">
              <el-icon><Edit /></el-icon>
              编辑项目
            </el-button>
          </div>
        </div>

        <!-- 加载状态 -->
        <div v-if="loading" class="loading-container">
          <el-icon class="is-loading"><Loading /></el-icon>
          <span>加载中...</span>
        </div>

        <!-- 主要内容 -->
        <div v-else class="content-grid">
          <!-- 左侧主要内容 -->
          <div class="main-content">
            <!-- 基本信息 -->
            <div class="card">
              <div class="card-header">
                <h2 class="card-title">基本信息</h2>
              </div>
              <div class="info-grid">
                <div class="info-item">
                  <span class="info-label">项目编号</span>
                  <span class="info-value">{{ project.number }}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">项目名称</span>
                  <span class="info-value">{{ project.name }}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">项目负责人</span>
                  <span class="info-value">{{ project.manager }}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">项目状态</span>
                  <span class="status-tag status-progress"
                    >{{ getStatusText(project.status) }}</span
                  >
                </div>
                <div class="info-item">
                  <span class="info-label">创建时间</span>
                  <span class="info-value">{{ project.createTime }}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">更新时间</span>
                  <span class="info-value">{{ project.updateTime }}</span>
                </div>
              </div>
              <div class="info-item" style="margin-top: 16px">
                <span class="info-label">项目描述</span>
                <span class="info-value">{{ project.description }}</span>
              </div>
            </div>

            <!-- 成员管理 -->
            <div class="card">
              <div class="card-header">
                <h2 class="card-title">成员管理</h2>
                <el-button
                  type="primary"
                  size="small"
                  @click="showAddMember = !showAddMember"
                >
                  <el-icon><Plus /></el-icon>
                  添加成员
                </el-button>
              </div>

              <!-- 成员列表 -->
              <div class="member-list">
                <div
                  v-for="member in members"
                  :key="member.id"
                  class="member-item"
                >
                  <div class="member-avatar">{{ member.name.charAt(0) }}</div>
                  <div class="member-info">
                    <div class="member-name">{{ member.name }}</div>
                    <div class="member-role">
                      {{ member.role }} · 加入时间：{{ member.joinTime }}
                    </div>
                  </div>
                  <div class="member-actions">
                    <el-button
                      size="small"
                      @click="handleEditMember(member.id)"
                    >
                      编辑
                    </el-button>
                    <el-button
                      size="small"
                      type="danger"
                      @click="handleRemoveMember(member.id)"
                    >
                      移除
                    </el-button>
                  </div>
                </div>
              </div>

              <!-- 添加成员区域 -->
              <div v-if="showAddMember" class="add-member-section">
                <div class="search-member">
                  <el-input
                    v-model="searchMemberKeyword"
                    placeholder="搜索用户姓名或学工号"
                    style="flex: 1"
                  >
                    <template #append>
                      <el-button @click="searchMembers">
                        <el-icon><Search /></el-icon>
                      </el-button>
                    </template>
                  </el-input>
                </div>

                <div v-if="searchResults.length > 0" class="search-results">
                  <div
                    v-for="user in searchResults"
                    :key="user.id"
                    class="search-result-item"
                    @click="handleAddMember(user)"
                  >
                    <div
                      class="member-avatar"
                      style="width: 32px; height: 32px"
                    >
                      {{ user.name.charAt(0) }}
                    </div>
                    <div class="member-info">
                      <div class="member-name">{{ user.name }}</div>
                      <div class="member-role">{{ user.studentId }}</div>
                    </div>
                    <el-button size="small" type="primary">添加</el-button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- 右侧边栏 -->
          <div class="sidebar-content">
            <!-- 文档管理 -->
            <div class="card">
              <div class="card-header">
                <h2 class="card-title">文档管理</h2>
              </div>

              <!-- 文档列表 -->
              <div v-if="documents.length > 0" class="document-list">
                <div
                  v-for="doc in documents"
                  :key="doc.id"
                  class="document-item"
                >
                  <div class="document-icon">
                    <el-icon><Document /></el-icon>
                  </div>
                  <div class="document-info">
                    <div class="document-name">{{ doc.name }}</div>
                    <div class="document-meta">
                      {{ doc.type }} · {{ doc.uploader }} · {{ doc.uploadTime }}
                      · {{ doc.size }}
                    </div>
                  </div>
                  <div class="document-actions">
                    <el-button size="small" @click="handleDownload(doc.id)">
                      下载
                    </el-button>
                    <el-button
                      size="small"
                      type="danger"
                      @click="handleDeleteDoc(doc.id)"
                    >
                      删除
                    </el-button>
                  </div>
                </div>
              </div>

              <!-- 空状态 -->
              <div v-else class="empty-state">
                <div class="empty-state-icon">📄</div>
                <div class="empty-state-text">暂无文档</div>
                <div class="empty-state-hint">上传项目相关文档</div>
              </div>

              <!-- 上传区域 -->
              <div class="upload-section">
                <div
                  class="upload-area"
                  @click="triggerUpload"
                  @dragover.prevent="handleDragOver"
                  @dragleave.prevent="handleDragLeave"
                  @drop.prevent="handleDrop"
                  :class="{ dragover: isDragOver }"
                >
                  <div class="upload-icon">
                    <el-icon><Upload /></el-icon>
                  </div>
                  <div class="upload-text">点击上传或拖拽文件到此处</div>
                  <div class="upload-hint">
                    支持 PDF、DOC、DOCX、XLS、XLSX 等格式
                  </div>
                </div>
                <input
                  ref="fileInput"
                  type="file"
                  multiple
                  style="display: none"
                  @change="handleFileSelect"
                  accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx"
                />
              </div>
            </div>
          </div>
        </div>

        <!-- 操作按钮区域 -->
        <div class="action-buttons">
          <el-button @click="handleExport">
            <el-icon><Download /></el-icon>
            导出报告
          </el-button>
          <el-button type="danger" @click="handleDeleteProject">
            <el-icon><Delete /></el-icon>
            删除项目
          </el-button>
        </div>
      </div>
    </div>

    <script>
      const { createApp, ref, onMounted } = Vue;
      const { ElMessage, ElMessageBox } = ElementPlus;

      // 注册Loading图标
      const Loading = {
        template:
          '<svg class="el-icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="currentColor" d="M512 64a32 32 0 0 1 32 32v192a32 32 0 0 1-64 0V96a32 32 0 0 1 32-32zm0 896a32 32 0 0 1-32-32V736a32 32 0 0 1 64 0v192a32 32 0 0 1-32 32zm448-480a32 32 0 0 1-32 32H736a32 32 0 0 1 0-64h192a32 32 0 0 1 32 32zM96 512a32 32 0 0 1 32-32h192a32 32 0 0 1 0 64H128a32 32 0 0 1-32-32zm778.24-200.96a32 32 0 0 1 45.248 45.248l-135.68 135.68a32 32 0 1 1-45.248-45.248l135.68-135.68zm-636.48 636.48a32 32 0 0 1 45.248 45.248l-135.68 135.68a32 32 0 1 1-45.248-45.248l135.68-135.68zM778.24 712.96a32 32 0 0 1-45.248 45.248l-135.68-135.68a32 32 0 1 1 45.248-45.248l135.68 135.68zM141.76 311.04a32 32 0 0 1-45.248-45.248l135.68-135.68a32 32 0 1 1 45.248 45.248l-135.68 135.68z"/></svg>',
      };

      createApp({
        components: {
          Loading,
        },
        setup() {
          // 响应式数据
          const loading = ref(false);
          const project = ref({});
          const members = ref([]);
          const documents = ref([]);
          const showAddMember = ref(false);
          const searchMemberKeyword = ref("");
          const searchResults = ref([]);
          const isDragOver = ref(false);
          const fileInput = ref(null);

          // 模拟项目数据
          const mockProject = {
            id: 1,
            number: "PRJ-2024-001",
            name: "基于人工智能的智能诊断系统研究",
            description:
              "本项目旨在开发一套基于深度学习的智能诊断系统，能够自动分析医学影像数据，为医生提供辅助诊断建议。系统将采用卷积神经网络和循环神经网络相结合的方法，提高诊断准确率和效率。",
            manager: "张教授",
            status: "progress",
            createTime: "2024-01-15 09:00:00",
            updateTime: "2024-01-20 14:30:00",
          };

          // 模拟成员数据
          const mockMembers = [
            {
              id: 1,
              name: "张教授",
              role: "项目负责人",
              joinTime: "2024-01-15",
            },
            {
              id: 2,
              name: "李博士",
              role: "核心成员",
              joinTime: "2024-01-16",
            },
            {
              id: 3,
              name: "王硕士",
              role: "普通成员",
              joinTime: "2024-01-18",
            },
          ];

          // 模拟文档数据
          const mockDocuments = [
            {
              id: 1,
              name: "项目需求分析报告.pdf",
              type: "PDF",
              uploader: "张教授",
              uploadTime: "2024-01-15",
              size: "2.3MB",
            },
            {
              id: 2,
              name: "技术方案设计.docx",
              type: "DOCX",
              uploader: "李博士",
              uploadTime: "2024-01-18",
              size: "1.8MB",
            },
            {
              id: 3,
              name: "测试数据.xlsx",
              type: "XLSX",
              uploader: "王硕士",
              uploadTime: "2024-01-20",
              size: "856KB",
            },
          ];

          // 模拟搜索结果
          const mockSearchResults = [
            {
              id: 4,
              name: "赵博士",
              studentId: "2021001",
            },
            {
              id: 5,
              name: "陈硕士",
              studentId: "2021002",
            },
          ];

          // 获取状态文本
          const getStatusText = (status) => {
            const statusMap = {
              planned: "计划中",
              progress: "进行中",
              completed: "已完成",
              delayed: "已延期",
            };
            return statusMap[status] || "未知";
          };

          // 加载项目详情
          const loadProjectDetail = async () => {
            loading.value = true;
            try {
              // 模拟API调用
              await new Promise((resolve) => setTimeout(resolve, 1000));

              project.value = mockProject;
              members.value = mockMembers;
              documents.value = mockDocuments;
            } catch (error) {
              ElMessage.error("加载项目详情失败");
            } finally {
              loading.value = false;
            }
          };

          // 返回列表
          const handleBack = () => {
            ElMessage.info("返回项目列表");
            // 检查是否在iframe中
            if (window.parent !== window) {
              window.parent.postMessage(
                {
                  type: "navigate",
                  path: "project/list",
                },
                "*"
              );
            } else {
              window.location.href = "项目列表.html";
            }
          };

          // 编辑项目
          const handleEdit = () => {
            ElMessage.info("编辑项目");
            // 这里应该跳转到项目编辑页面
          };

          // 搜索成员
          const searchMembers = () => {
            if (searchMemberKeyword.value.trim()) {
              searchResults.value = mockSearchResults.filter(
                (user) =>
                  user.name.includes(searchMemberKeyword.value) ||
                  user.studentId.includes(searchMemberKeyword.value)
              );
            } else {
              searchResults.value = [];
            }
          };

          // 添加成员
          const handleAddMember = (user) => {
            ElMessage.success(`添加成员: ${user.name}`);
            // 这里应该调用API添加成员
            showAddMember.value = false;
            searchMemberKeyword.value = "";
            searchResults.value = [];
          };

          // 编辑成员
          const handleEditMember = (memberId) => {
            ElMessage.info(`编辑成员: ${memberId}`);
            // 这里应该打开编辑成员对话框
          };

          // 移除成员
          const handleRemoveMember = async (memberId) => {
            try {
              await ElMessageBox.confirm("确定要移除这个成员吗？", "确认移除", {
                confirmButtonText: "确定",
                cancelButtonText: "取消",
                type: "warning",
              });

              ElMessage.success("成员移除成功");
              // 这里应该调用API移除成员
            } catch (error) {
              // 用户取消操作
            }
          };

          // 下载文档
          const handleDownload = (docId) => {
            ElMessage.info(`下载文档: ${docId}`);
            // 这里应该触发文档下载
          };

          // 删除文档
          const handleDeleteDoc = async (docId) => {
            try {
              await ElMessageBox.confirm("确定要删除这个文档吗？", "确认删除", {
                confirmButtonText: "确定",
                cancelButtonText: "取消",
                type: "warning",
              });

              ElMessage.success("文档删除成功");
              // 这里应该调用API删除文档
            } catch (error) {
              // 用户取消操作
            }
          };

          // 触发文件上传
          const triggerUpload = () => {
            fileInput.value.click();
          };

          // 处理文件选择
          const handleFileSelect = (event) => {
            const files = event.target.files;
            if (files.length > 0) {
              uploadFiles(files);
            }
          };

          // 处理拖拽事件
          const handleDragOver = (event) => {
            event.preventDefault();
            isDragOver.value = true;
          };

          const handleDragLeave = (event) => {
            event.preventDefault();
            isDragOver.value = false;
          };

          const handleDrop = (event) => {
            event.preventDefault();
            isDragOver.value = false;
            const files = event.dataTransfer.files;
            if (files.length > 0) {
              uploadFiles(files);
            }
          };

          // 上传文件
          const uploadFiles = (files) => {
            ElMessage.info(`开始上传 ${files.length} 个文件`);
            // 这里应该实现文件上传逻辑
            // 模拟上传进度
            setTimeout(() => {
              ElMessage.success("文件上传成功");
            }, 2000);
          };

          // 导出报告
          const handleExport = () => {
            ElMessage.info("导出项目报告");
            // 这里应该触发报告导出
          };

          // 删除项目
          const handleDeleteProject = async () => {
            try {
              await ElMessageBox.confirm(
                "确定要删除这个项目吗？删除后无法恢复。",
                "确认删除",
                {
                  confirmButtonText: "确定",
                  cancelButtonText: "取消",
                  type: "warning",
                }
              );

              ElMessage.success("项目删除成功");
              handleBack();
            } catch (error) {
              // 用户取消删除
            }
          };

          // 组件挂载时加载数据
          onMounted(() => {
            console.log("项目详情页面加载中...");
            loadProjectDetail();
          });

          return {
            loading,
            project,
            members,
            documents,
            showAddMember,
            searchMemberKeyword,
            searchResults,
            isDragOver,
            fileInput,
            getStatusText,
            handleBack,
            handleEdit,
            searchMembers,
            handleAddMember,
            handleEditMember,
            handleRemoveMember,
            handleDownload,
            handleDeleteDoc,
            triggerUpload,
            handleFileSelect,
            handleDragOver,
            handleDragLeave,
            handleDrop,
            handleExport,
            handleDeleteProject,
          };
        },
      })
        .use(ElementPlus)
        .mount("#app");
    </script>
  </body>
</html>
