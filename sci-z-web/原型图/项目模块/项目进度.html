<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>é¡¹ç›®è¿›åº¦ - é«˜æ ¡ç§‘ç ”é¡¹ç›®ç®¡ç†å¹³å°</title>
    <link rel="icon" href="../images/favicon.ico" type="image/x-icon" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/element-plus@2.3.14/dist/index.css"
    />
    <script src="https://unpkg.com/vue@3.2.47/dist/vue.global.prod.js"></script>
    <script src="https://unpkg.com/element-plus@2.3.14"></script>
    <link rel="stylesheet" href="../é€šç”¨è§„èŒƒ/æ ·å¼.css" />
    <style>
      .project-progress-container {
        padding: 20px;
        background: #f7f9fc;
        min-height: calc(100vh - 56px);
      }

      .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .page-title {
        font-size: 24px;
        font-weight: 600;
        color: #1e3a8a;
        margin: 0;
      }

      .content-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
      }

      .card {
        background: #ffffff;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
        border: 1px solid #e5e7eb;
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 1px solid #e5e7eb;
      }

      .card-title {
        font-size: 16px;
        font-weight: 600;
        color: #111827;
        margin: 0;
      }

      /* è¿›åº¦æ¦‚è§ˆæ ·å¼ */
      .progress-overview {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .overall-progress {
        text-align: center;
        padding: 20px;
        background: #f8fafc;
        border-radius: 8px;
      }

      .progress-percentage {
        font-size: 48px;
        font-weight: 700;
        color: #1e3a8a;
        margin-bottom: 8px;
      }

      .progress-label {
        font-size: 16px;
        color: #6b7280;
        margin-bottom: 16px;
      }

      .progress-bar-large {
        width: 100%;
        height: 12px;
        background: #e5e7eb;
        border-radius: 6px;
        overflow: hidden;
        margin-bottom: 16px;
      }

      .progress-fill-large {
        height: 100%;
        background: linear-gradient(90deg, #1e3a8a 0%, #0ea5e9 100%);
        border-radius: 6px;
        transition: width 0.5s ease;
      }

      .progress-time {
        display: flex;
        justify-content: space-between;
        font-size: 14px;
        color: #6b7280;
      }

      .progress-stats {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 16px;
      }

      .stat-item {
        text-align: center;
        padding: 16px;
        background: #f8fafc;
        border-radius: 8px;
      }

      .stat-number {
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 4px;
      }

      .stat-label {
        font-size: 12px;
        color: #6b7280;
      }

      .stat-completed .stat-number {
        color: #16a34a;
      }

      .stat-progress .stat-number {
        color: #f59e0b;
      }

      .stat-planned .stat-number {
        color: #2563eb;
      }

      .stat-delayed .stat-number {
        color: #dc2626;
      }

      /* é‡Œç¨‹ç¢‘åˆ—è¡¨æ ·å¼ */
      .milestone-list {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .milestone-item {
        padding: 16px;
        background: #f8fafc;
        border-radius: 8px;
        border-left: 4px solid #e5e7eb;
      }

      .milestone-item.completed {
        border-left-color: #16a34a;
        background: #f0fdf4;
      }

      .milestone-item.progress {
        border-left-color: #f59e0b;
        background: #fffbeb;
      }

      .milestone-item.planned {
        border-left-color: #2563eb;
        background: #eff6ff;
      }

      .milestone-item.delayed {
        border-left-color: #dc2626;
        background: #fef2f2;
      }

      .milestone-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }

      .milestone-name {
        font-size: 16px;
        font-weight: 600;
        color: #111827;
      }

      .milestone-status {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 500;
      }

      .status-completed {
        background: #d1fae5;
        color: #059669;
      }

      .status-progress {
        background: #fef3c7;
        color: #d97706;
      }

      .status-planned {
        background: #dbeafe;
        color: #1e40af;
      }

      .status-delayed {
        background: #fee2e2;
        color: #dc2626;
      }

      .milestone-description {
        font-size: 14px;
        color: #6b7280;
        margin-bottom: 12px;
      }

      .milestone-progress {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 8px;
      }

      .milestone-progress-bar {
        flex: 1;
        height: 6px;
        background: #e5e7eb;
        border-radius: 3px;
        overflow: hidden;
      }

      .milestone-progress-fill {
        height: 100%;
        border-radius: 3px;
        transition: width 0.3s ease;
      }

      .milestone-progress-fill.completed {
        background: #16a34a;
      }

      .milestone-progress-fill.progress {
        background: #f59e0b;
      }

      .milestone-progress-fill.planned {
        background: #2563eb;
      }

      .milestone-progress-fill.delayed {
        background: #dc2626;
      }

      .milestone-progress-text {
        font-size: 12px;
        color: #6b7280;
        min-width: 35px;
      }

      .milestone-time {
        display: flex;
        justify-content: space-between;
        font-size: 12px;
        color: #9ca3af;
      }

      .milestone-actions {
        display: flex;
        gap: 8px;
        margin-top: 12px;
      }

      /* æ—¶é—´è½´è§†å›¾æ ·å¼ */
      .timeline-container {
        position: relative;
        padding-left: 24px;
      }

      .timeline-line {
        position: absolute;
        left: 12px;
        top: 0;
        bottom: 0;
        width: 2px;
        background: #e5e7eb;
      }

      .timeline-item {
        position: relative;
        margin-bottom: 24px;
        padding-left: 24px;
      }

      .timeline-dot {
        position: absolute;
        left: -6px;
        top: 8px;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        border: 3px solid #ffffff;
        box-shadow: 0 0 0 2px #e5e7eb;
      }

      .timeline-dot.completed {
        background: #16a34a;
        box-shadow: 0 0 0 2px #16a34a;
      }

      .timeline-dot.progress {
        background: #f59e0b;
        box-shadow: 0 0 0 2px #f59e0b;
      }

      .timeline-dot.planned {
        background: #2563eb;
        box-shadow: 0 0 0 2px #2563eb;
      }

      .timeline-dot.delayed {
        background: #dc2626;
        box-shadow: 0 0 0 2px #dc2626;
      }

      .timeline-content {
        background: #ffffff;
        border-radius: 8px;
        padding: 16px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
      }

      .timeline-title {
        font-size: 16px;
        font-weight: 600;
        color: #111827;
        margin-bottom: 4px;
      }

      .timeline-time {
        font-size: 12px;
        color: #6b7280;
        margin-bottom: 8px;
      }

      .timeline-description {
        font-size: 14px;
        color: #374151;
        line-height: 1.5;
      }

      /* æ·»åŠ é‡Œç¨‹ç¢‘å¯¹è¯æ¡† */
      .milestone-form {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
      }

      .loading-container {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 40px;
        color: #6b7280;
        font-size: 14px;
      }

      .loading-container .el-icon {
        margin-right: 8px;
        font-size: 16px;
      }

      .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #6b7280;
      }

      .empty-state-icon {
        font-size: 48px;
        margin-bottom: 16px;
        opacity: 0.5;
      }

      .empty-state-text {
        font-size: 16px;
        margin-bottom: 8px;
      }

      .empty-state-hint {
        font-size: 14px;
        color: #9ca3af;
      }

      /* æ–°å¢æ ·å¼ */
      .info-section {
        padding: 16px;
        background: #f8fafc;
        border-radius: 8px;
        border: 1px solid #e5e7eb;
      }

      .stat-card {
        text-align: center;
        padding: 12px;
        background: #ffffff;
        border-radius: 6px;
        border: 1px solid #e5e7eb;
      }

      .timeline-progress {
        margin-top: 8px;
      }

      /* å“åº”å¼è®¾è®¡ */
      @media (max-width: 768px) {
        .content-grid {
          grid-template-columns: 1fr;
        }

        .progress-stats {
          grid-template-columns: repeat(2, 1fr);
        }

        .form-row {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div class="project-progress-container">
        <!-- é¡µé¢å¤´éƒ¨ -->
        <div class="page-header">
          <div style="display: flex; align-items: center; gap: 16px">
            <el-button @click="handleBack">
              <el-icon><ArrowLeft /></el-icon>
              è¿”å›åˆ—è¡¨
            </el-button>
            <h1 class="page-title">é¡¹ç›®è¿›åº¦</h1>
          </div>
        </div>

        <!-- åŠ è½½çŠ¶æ€ -->
        <div v-if="loading" class="loading-container">
          <el-icon class="is-loading"><Loading /></el-icon>
          <span>åŠ è½½ä¸­...</span>
        </div>

        <!-- ä¸»è¦å†…å®¹ -->
        <div v-else>
          <!-- é¡¹ç›®æ¦‚è§ˆ -->
          <div class="card" style="margin-bottom: 20px">
            <div class="card-header">
              <h2 class="card-title">é¡¹ç›®æ¦‚è§ˆ</h2>
            </div>

            <div
              style="
                display: grid;
                grid-template-columns: 1fr 1fr 1fr;
                gap: 20px;
              "
            >
              <!-- é¡¹ç›®åŸºæœ¬ä¿¡æ¯ -->
              <div class="info-section">
                <h3
                  style="
                    font-size: 16px;
                    font-weight: 600;
                    color: #374151;
                    margin-bottom: 12px;
                  "
                >
                  é¡¹ç›®ä¿¡æ¯
                </h3>
                <div style="display: flex; flex-direction: column; gap: 8px">
                  <div style="display: flex; justify-content: space-between">
                    <span style="color: #6b7280">é¡¹ç›®åç§°ï¼š</span>
                    <span style="color: #111827; font-weight: 500"
                      >{{ projectInfo.name }}</span
                    >
                  </div>
                  <div style="display: flex; justify-content: space-between">
                    <span style="color: #6b7280">é¡¹ç›®ç¼–å·ï¼š</span>
                    <span style="color: #111827; font-weight: 500"
                      >{{ projectInfo.number }}</span
                    >
                  </div>
                  <div style="display: flex; justify-content: space-between">
                    <span style="color: #6b7280">é¡¹ç›®è´Ÿè´£äººï¼š</span>
                    <span style="color: #111827; font-weight: 500"
                      >{{ projectInfo.manager }}</span
                    >
                  </div>
                  <div style="display: flex; justify-content: space-between">
                    <span style="color: #6b7280">é¡¹ç›®çŠ¶æ€ï¼š</span>
                    <span
                      class="status-tag"
                      :class="`status-${projectInfo.status}`"
                      >{{ getStatusText(projectInfo.status) }}</span
                    >
                  </div>
                </div>
              </div>

              <!-- è¿›åº¦ç»Ÿè®¡ -->
              <div class="info-section">
                <h3
                  style="
                    font-size: 16px;
                    font-weight: 600;
                    color: #374151;
                    margin-bottom: 12px;
                  "
                >
                  è¿›åº¦ç»Ÿè®¡
                </h3>
                <div
                  style="
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 12px;
                  "
                >
                  <div class="stat-card">
                    <div
                      style="font-size: 24px; font-weight: 700; color: #16a34a"
                    >
                      {{ stats.completed }}
                    </div>
                    <div style="font-size: 12px; color: #6b7280">å·²å®Œæˆ</div>
                  </div>
                  <div class="stat-card">
                    <div
                      style="font-size: 24px; font-weight: 700; color: #f59e0b"
                    >
                      {{ stats.progress }}
                    </div>
                    <div style="font-size: 12px; color: #6b7280">è¿›è¡Œä¸­</div>
                  </div>
                  <div class="stat-card">
                    <div
                      style="font-size: 24px; font-weight: 700; color: #2563eb"
                    >
                      {{ stats.planned }}
                    </div>
                    <div style="font-size: 12px; color: #6b7280">æœªå¼€å§‹</div>
                  </div>
                  <div class="stat-card">
                    <div
                      style="font-size: 24px; font-weight: 700; color: #dc2626"
                    >
                      {{ stats.delayed }}
                    </div>
                    <div style="font-size: 12px; color: #6b7280">å·²å»¶æœŸ</div>
                  </div>
                </div>
              </div>

              <!-- æ•´ä½“è¿›åº¦ -->
              <div class="info-section">
                <h3
                  style="
                    font-size: 16px;
                    font-weight: 600;
                    color: #374151;
                    margin-bottom: 12px;
                  "
                >
                  æ•´ä½“è¿›åº¦
                </h3>
                <div style="text-align: center">
                  <div
                    style="
                      font-size: 36px;
                      font-weight: 700;
                      color: #1e3a8a;
                      margin-bottom: 8px;
                    "
                  >
                    {{ overallProgress }}%
                  </div>
                  <div class="progress-bar-large" style="margin-bottom: 12px">
                    <div
                      class="progress-fill-large"
                      :style="{ width: overallProgress + '%' }"
                    ></div>
                  </div>
                  <div style="font-size: 12px; color: #6b7280">
                    <div>å¼€å§‹æ—¶é—´ï¼š{{ projectStartTime }}</div>
                    <div>é¢„è®¡å®Œæˆï¼š{{ projectEndTime }}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- æ—¶é—´è½´è§†å›¾ -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">æ—¶é—´è½´è§†å›¾</h2>
          </div>

          <div v-if="milestones.length > 0" class="timeline-container">
            <div class="timeline-line"></div>
            <div
              v-for="milestone in milestones"
              :key="milestone.id"
              class="timeline-item"
            >
              <div :class="`timeline-dot ${milestone.status}`"></div>
              <div class="timeline-content">
                <div class="timeline-title">{{ milestone.name }}</div>
                <div class="timeline-time">
                  {{ milestone.startTime }} - {{ milestone.endTime }}
                </div>
                <div class="timeline-description">
                  {{ milestone.description }}
                </div>
                <div class="timeline-progress">
                  <div
                    style="
                      display: flex;
                      align-items: center;
                      gap: 8px;
                      margin-top: 8px;
                    "
                  >
                    <div
                      style="
                        flex: 1;
                        height: 6px;
                        background: #e5e7eb;
                        border-radius: 3px;
                        overflow: hidden;
                      "
                    >
                      <div
                        :class="`milestone-progress-fill ${milestone.status}`"
                        :style="{ width: milestone.progress + '%' }"
                      ></div>
                    </div>
                    <span
                      style="font-size: 12px; color: #6b7280; min-width: 35px"
                      >{{ milestone.progress }}%</span
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- ç©ºçŠ¶æ€ -->
          <div v-else class="empty-state">
            <div class="empty-state-icon">ğŸ“…</div>
            <div class="empty-state-text">æš‚æ— æ—¶é—´è½´æ•°æ®</div>
            <div class="empty-state-hint">é¡¹ç›®é‡Œç¨‹ç¢‘å°†åœ¨æ­¤æ˜¾ç¤º</div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const { createApp, ref, onMounted } = Vue;
      const { ElMessage, ElMessageBox } = ElementPlus;

      // æ³¨å†ŒLoadingå›¾æ ‡
      const Loading = {
        template:
          '<svg class="el-icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="currentColor" d="M512 64a32 32 0 0 1 32 32v192a32 32 0 0 1-64 0V96a32 32 0 0 1 32-32zm0 896a32 32 0 0 1-32-32V736a32 32 0 0 1 64 0v192a32 32 0 0 1-32 32zm448-480a32 32 0 0 1-32 32H736a32 32 0 0 1 0-64h192a32 32 0 0 1 32 32zM96 512a32 32 0 0 1 32-32h192a32 32 0 0 1 0 64H128a32 32 0 0 1-32-32zm778.24-200.96a32 32 0 0 1 45.248 45.248l-135.68 135.68a32 32 0 1 1-45.248-45.248l135.68-135.68zm-636.48 636.48a32 32 0 0 1 45.248 45.248l-135.68 135.68a32 32 0 1 1-45.248-45.248l135.68-135.68zM778.24 712.96a32 32 0 0 1-45.248 45.248l-135.68-135.68a32 32 0 1 1 45.248-45.248l135.68 135.68zM141.76 311.04a32 32 0 0 1-45.248-45.248l135.68-135.68a32 32 0 1 1 45.248 45.248l-135.68 135.68z"/></svg>',
      };

      createApp({
        components: {
          Loading,
        },
        setup() {
          // å“åº”å¼æ•°æ®
          const loading = ref(false);
          const milestones = ref([]);

          // è®¡ç®—å±æ€§
          const overallProgress = ref(0);
          const projectStartTime = ref("2024-01-15");
          const projectEndTime = ref("2024-06-30");
          const stats = ref({
            completed: 0,
            progress: 0,
            planned: 0,
            delayed: 0,
          });

          // é¡¹ç›®ä¿¡æ¯ï¼ˆä»å¤–éƒ¨ä¼ å…¥ï¼‰
          const projectInfo = ref({
            name: "åŸºäºäººå·¥æ™ºèƒ½çš„æ™ºèƒ½è¯Šæ–­ç³»ç»Ÿç ”ç©¶",
            number: "PRJ-2024-001",
            manager: "å¼ æ•™æˆ",
            status: "progress",
          });

          // ç”Ÿæˆé‡Œç¨‹ç¢‘æ•°æ®ï¼ˆåŸºäºä¼ å…¥çš„è¿›åº¦ç™¾åˆ†æ¯”åŠ¨æ€ç”Ÿæˆï¼‰
          const generateMilestonesFromProgress = (progress) => {
            const baseMilestones = [
              {
                id: 1,
                name: "é¡¹ç›®å¯åŠ¨ï¼šå»ºè®¾æ–¹æ¡ˆé€šè¿‡å®¡æ ¸å¹¶å¤‡æ¡ˆ",
                description:
                  "é¡¹ç›®å¯åŠ¨é˜¶æ®µï¼Œå®Œæˆå»ºè®¾æ–¹æ¡ˆçš„åˆ¶å®šã€å®¡æ ¸å’Œå¤‡æ¡ˆå·¥ä½œï¼Œç¡®ä¿é¡¹ç›®åˆæ³•åˆè§„è¿›è¡Œ",
                startTime: "2024-01-15",
                endTime: "2024-01-31",
              },
              {
                id: 2,
                name: "ä»»åŠ¡åˆ†è§£ä¸èµ„æºå‡†å¤‡ï¼šé¡¹ç›®ä»»åŠ¡ä¹¦ä¸‹è¾¾ï¼Œèµ„æºé…ç½®å®Œæˆï¼Œè¿›å…¥å®æ–½é˜¶æ®µ",
                description:
                  "å®Œæˆé¡¹ç›®ä»»åŠ¡åˆ†è§£ï¼Œä¸‹è¾¾é¡¹ç›®ä»»åŠ¡ä¹¦ï¼Œå®Œæˆäººå‘˜ã€è®¾å¤‡ç­‰èµ„æºé…ç½®ï¼Œæ­£å¼è¿›å…¥é¡¹ç›®å®æ–½é˜¶æ®µ",
                startTime: "2024-02-01",
                endTime: "2024-02-15",
              },
              {
                id: 3,
                name: "é¡¹ç›®å®æ–½ä¸è¿‡ç¨‹ç®¡ç†ï¼šä¸­æœŸæ£€æŸ¥",
                description:
                  "é¡¹ç›®å®æ–½é˜¶æ®µï¼Œè¿›è¡Œä¸­æœŸæ£€æŸ¥ï¼Œè¯„ä¼°é¡¹ç›®è¿›å±•ï¼Œç¡®ä¿é¡¹ç›®æŒ‰è®¡åˆ’æ¨è¿›",
                startTime: "2024-02-16",
                endTime: "2024-04-15",
              },
              {
                id: 4,
                name: "æˆæœæ•´åˆä¸ç»“é¢˜å‡†å¤‡ï¼šç»“é¢˜éªŒæ”¶",
                description: "æ•´åˆé¡¹ç›®æˆæœï¼Œå‡†å¤‡ç»“é¢˜ææ–™ï¼Œè¿›è¡Œé¡¹ç›®ç»“é¢˜éªŒæ”¶å·¥ä½œ",
                startTime: "2024-04-16",
                endTime: "2024-05-31",
              },
              {
                id: 5,
                name: "åç»­ç®¡ç†ä¸æˆæœè½¬åŒ–ï¼šé¡¹ç›®å½’æ¡£å®Œæˆï¼Œæˆæœè½¬åŒ–",
                description:
                  "å®Œæˆé¡¹ç›®å½’æ¡£å·¥ä½œï¼Œæ¨è¿›æˆæœè½¬åŒ–åº”ç”¨ï¼Œç¡®ä¿é¡¹ç›®ä»·å€¼çš„æœ€å¤§åŒ–å®ç°",
                startTime: "2024-06-01",
                endTime: "2024-06-30",
              },
            ];

            // æ ¹æ®è¿›åº¦ç™¾åˆ†æ¯”åˆ†é…é‡Œç¨‹ç¢‘çŠ¶æ€å’Œè¿›åº¦
            return baseMilestones.map((milestone, index) => {
              let status, milestoneProgress;

              if (progress >= 80) {
                // 80%ä»¥ä¸Šï¼šå‰4ä¸ªå·²å®Œæˆï¼Œç¬¬5ä¸ªè¿›è¡Œä¸­
                if (index < 4) {
                  status = "completed";
                  milestoneProgress = 100;
                } else {
                  status = "progress";
                  milestoneProgress = Math.min(100, (progress - 80) * 5);
                }
              } else if (progress >= 60) {
                // 60-80%ï¼šå‰3ä¸ªå·²å®Œæˆï¼Œç¬¬4ä¸ªè¿›è¡Œä¸­ï¼Œç¬¬5ä¸ªæœªå¼€å§‹
                if (index < 3) {
                  status = "completed";
                  milestoneProgress = 100;
                } else if (index === 3) {
                  status = "progress";
                  milestoneProgress = Math.min(100, (progress - 60) * 5);
                } else {
                  status = "planned";
                  milestoneProgress = 0;
                }
              } else if (progress >= 40) {
                // 40-60%ï¼šå‰2ä¸ªå·²å®Œæˆï¼Œç¬¬3ä¸ªè¿›è¡Œä¸­ï¼Œå2ä¸ªæœªå¼€å§‹
                if (index < 2) {
                  status = "completed";
                  milestoneProgress = 100;
                } else if (index === 2) {
                  status = "progress";
                  milestoneProgress = Math.min(100, (progress - 40) * 5);
                } else {
                  status = "planned";
                  milestoneProgress = 0;
                }
              } else if (progress >= 20) {
                // 20-40%ï¼šç¬¬1ä¸ªå·²å®Œæˆï¼Œç¬¬2ä¸ªè¿›è¡Œä¸­ï¼Œå3ä¸ªæœªå¼€å§‹
                if (index === 0) {
                  status = "completed";
                  milestoneProgress = 100;
                } else if (index === 1) {
                  status = "progress";
                  milestoneProgress = Math.min(100, (progress - 20) * 5);
                } else {
                  status = "planned";
                  milestoneProgress = 0;
                }
              } else {
                // 20%ä»¥ä¸‹ï¼šç¬¬1ä¸ªè¿›è¡Œä¸­ï¼Œå…¶ä»–æœªå¼€å§‹
                if (index === 0) {
                  status = "progress";
                  milestoneProgress = Math.min(100, progress * 5);
                } else {
                  status = "planned";
                  milestoneProgress = 0;
                }
              }

              return {
                ...milestone,
                status,
                progress: milestoneProgress,
              };
            });
          };

          // æ¨¡æ‹Ÿé‡Œç¨‹ç¢‘æ•°æ®ï¼ˆåŸºäºæ–°å»ºé¡¹ç›®.htmlä¸­çš„5ä¸ªé‡Œç¨‹ç¢‘ï¼‰
          const mockMilestones = [
            {
              id: 1,
              name: "é¡¹ç›®å¯åŠ¨ï¼šå»ºè®¾æ–¹æ¡ˆé€šè¿‡å®¡æ ¸å¹¶å¤‡æ¡ˆ",
              description:
                "é¡¹ç›®å¯åŠ¨é˜¶æ®µï¼Œå®Œæˆå»ºè®¾æ–¹æ¡ˆçš„åˆ¶å®šã€å®¡æ ¸å’Œå¤‡æ¡ˆå·¥ä½œï¼Œç¡®ä¿é¡¹ç›®åˆæ³•åˆè§„è¿›è¡Œ",
              status: "completed",
              progress: 100,
              startTime: "2024-01-15",
              endTime: "2024-01-31",
            },
            {
              id: 2,
              name: "ä»»åŠ¡åˆ†è§£ä¸èµ„æºå‡†å¤‡ï¼šé¡¹ç›®ä»»åŠ¡ä¹¦ä¸‹è¾¾ï¼Œèµ„æºé…ç½®å®Œæˆï¼Œè¿›å…¥å®æ–½é˜¶æ®µ",
              description:
                "å®Œæˆé¡¹ç›®ä»»åŠ¡åˆ†è§£ï¼Œä¸‹è¾¾é¡¹ç›®ä»»åŠ¡ä¹¦ï¼Œå®Œæˆäººå‘˜ã€è®¾å¤‡ç­‰èµ„æºé…ç½®ï¼Œæ­£å¼è¿›å…¥é¡¹ç›®å®æ–½é˜¶æ®µ",
              status: "completed",
              progress: 100,
              startTime: "2024-02-01",
              endTime: "2024-02-15",
            },
            {
              id: 3,
              name: "é¡¹ç›®å®æ–½ä¸è¿‡ç¨‹ç®¡ç†ï¼šä¸­æœŸæ£€æŸ¥",
              description:
                "é¡¹ç›®å®æ–½é˜¶æ®µï¼Œè¿›è¡Œä¸­æœŸæ£€æŸ¥ï¼Œè¯„ä¼°é¡¹ç›®è¿›å±•ï¼Œç¡®ä¿é¡¹ç›®æŒ‰è®¡åˆ’æ¨è¿›",
              status: "progress",
              progress: 75,
              startTime: "2024-02-16",
              endTime: "2024-04-15",
            },
            {
              id: 4,
              name: "æˆæœæ•´åˆä¸ç»“é¢˜å‡†å¤‡ï¼šç»“é¢˜éªŒæ”¶",
              description: "æ•´åˆé¡¹ç›®æˆæœï¼Œå‡†å¤‡ç»“é¢˜ææ–™ï¼Œè¿›è¡Œé¡¹ç›®ç»“é¢˜éªŒæ”¶å·¥ä½œ",
              status: "planned",
              progress: 0,
              startTime: "2024-04-16",
              endTime: "2024-05-31",
            },
            {
              id: 5,
              name: "åç»­ç®¡ç†ä¸æˆæœè½¬åŒ–ï¼šé¡¹ç›®å½’æ¡£å®Œæˆï¼Œæˆæœè½¬åŒ–",
              description:
                "å®Œæˆé¡¹ç›®å½’æ¡£å·¥ä½œï¼Œæ¨è¿›æˆæœè½¬åŒ–åº”ç”¨ï¼Œç¡®ä¿é¡¹ç›®ä»·å€¼çš„æœ€å¤§åŒ–å®ç°",
              status: "planned",
              progress: 0,
              startTime: "2024-06-01",
              endTime: "2024-06-30",
            },
          ];

          // è·å–çŠ¶æ€æ–‡æœ¬
          const getStatusText = (status) => {
            const statusMap = {
              planned: "æœªå¼€å§‹",
              progress: "è¿›è¡Œä¸­",
              completed: "å·²å®Œæˆ",
              delayed: "å·²å»¶æœŸ",
            };
            return statusMap[status] || "æœªçŸ¥";
          };

          // è®¡ç®—æ•´ä½“è¿›åº¦ï¼ˆåŸºäºä¼ å…¥çš„è¿›åº¦ç™¾åˆ†æ¯”ï¼‰
          const calculateOverallProgress = () => {
            // å¦‚æœå·²ç»æœ‰è¿›åº¦å€¼ï¼Œä¸è¦è¦†ç›–
            if (overallProgress.value > 0) {
              console.log("ä½¿ç”¨å·²æœ‰çš„è¿›åº¦å€¼:", overallProgress.value);
              return;
            }

            // æ£€æŸ¥URLå‚æ•°
            const params = new URLSearchParams(window.location.search);
            const progressFromURL = params.get("progress");

            if (progressFromURL) {
              // å¦‚æœå·²ç»æœ‰URLä¼ å…¥çš„è¿›åº¦å€¼ï¼Œä¸è¦è¦†ç›–
              console.log("ä½¿ç”¨URLä¼ å…¥çš„è¿›åº¦å€¼:", overallProgress.value);
              return;
            } else {
              // å¦åˆ™æ ¹æ®é‡Œç¨‹ç¢‘è®¡ç®—
              if (milestones.value.length === 0) {
                overallProgress.value = 0;
                return;
              }

              const totalProgress = milestones.value.reduce(
                (sum, milestone) => {
                  return sum + milestone.progress;
                },
                0
              );

              overallProgress.value = Math.round(
                totalProgress / milestones.value.length
              );
            }
          };

          // è®¡ç®—ç»Ÿè®¡æ•°æ®ï¼ˆåŸºäºä¼ å…¥çš„è¿›åº¦ç™¾åˆ†æ¯”åŠ¨æ€è®¡ç®—ï¼‰
          const calculateStats = () => {
            // ç›´æ¥ä½¿ç”¨å½“å‰çš„overallProgresså€¼
            const progress = overallProgress.value;
            console.log("æ ¹æ®å½“å‰è¿›åº¦è®¡ç®—ç»Ÿè®¡æ•°æ®:", progress);

            if (progress >= 80) {
              stats.value = {
                completed: 4,
                progress: 1,
                planned: 0,
                delayed: 0,
              };
            } else if (progress >= 60) {
              stats.value = {
                completed: 3,
                progress: 1,
                planned: 2,
                delayed: 0,
              };
            } else if (progress >= 40) {
              stats.value = {
                completed: 2,
                progress: 1,
                planned: 2,
                delayed: 0,
              };
            } else if (progress >= 20) {
              stats.value = {
                completed: 1,
                progress: 1,
                planned: 3,
                delayed: 0,
              };
            } else {
              stats.value = {
                completed: 0,
                progress: 1,
                planned: 4,
                delayed: 0,
              };
            }
          };

          // å­˜å‚¨ä»å¤–éƒ¨ä¼ å…¥çš„é¡¹ç›®æ•°æ®
          // ç§»é™¤externalProjectDataå˜é‡ï¼Œç›´æ¥ä½¿ç”¨Vueå“åº”å¼æ•°æ®

          // è§£æURLå‚æ•°è·å–é¡¹ç›®æ•°æ®
          const getProjectDataFromURL = () => {
            const params = new URLSearchParams(window.location.search);
            const projectId = params.get("id");
            const progress = params.get("progress");
            const name = params.get("name");
            const number = params.get("number");
            const manager = params.get("manager");
            const status = params.get("status");

            if (projectId && progress) {
              // ç›´æ¥æ›´æ–°Vueå“åº”å¼æ•°æ®
              projectInfo.value = {
                name: name || "åŸºäºäººå·¥æ™ºèƒ½çš„æ™ºèƒ½è¯Šæ–­ç³»ç»Ÿç ”ç©¶",
                number: number || "PRJ-2024-001",
                manager: manager || "å¼ æ•™æˆ",
                status: status || "progress",
              };

              // ç›´æ¥è®¾ç½®æ•´ä½“è¿›åº¦
              overallProgress.value = parseInt(progress) || 0;
              console.log("ä»URLè®¾ç½®è¿›åº¦:", overallProgress.value);

              return true; // è¡¨ç¤ºæœ‰URLå‚æ•°
            }
            return false; // è¡¨ç¤ºæ²¡æœ‰URLå‚æ•°
          };

          // ç›‘å¬iframeæ¶ˆæ¯
          const handleIframeMessage = (event) => {
            console.log("æ”¶åˆ°iframeæ¶ˆæ¯:", event.data);
            if (
              event.data &&
              event.data.type === "navigate" &&
              event.data.path === "project/progress"
            ) {
              const params = event.data.params;
              if (params) {
                console.log("æ”¶åˆ°iframeå‚æ•°:", params);

                // ç›´æ¥æ›´æ–°Vueå“åº”å¼æ•°æ®
                projectInfo.value = {
                  name: params.name || "åŸºäºäººå·¥æ™ºèƒ½çš„æ™ºèƒ½è¯Šæ–­ç³»ç»Ÿç ”ç©¶",
                  number: params.number || "PRJ-2024-001",
                  manager: params.manager || "å¼ æ•™æˆ",
                  status: params.status || "progress",
                };

                // ç›´æ¥è®¾ç½®æ•´ä½“è¿›åº¦
                overallProgress.value = parseInt(params.progress) || 0;
                console.log("ç›´æ¥è®¾ç½®è¿›åº¦:", overallProgress.value);

                // æ ¹æ®è¿›åº¦ç”Ÿæˆé‡Œç¨‹ç¢‘æ•°æ®
                milestones.value = generateMilestonesFromProgress(
                  overallProgress.value
                );

                // è®¡ç®—ç»Ÿè®¡æ•°æ®
                calculateStats();

                console.log("æœ€ç»ˆè¿›åº¦å€¼:", overallProgress.value);
                console.log("æœ€ç»ˆç»Ÿè®¡æ•°æ®:", stats.value);
              }
            }
          };

          // åŠ è½½é‡Œç¨‹ç¢‘æ•°æ®ï¼ˆä¸é‡æ–°è®¡ç®—æ•´ä½“è¿›åº¦ï¼‰
          const loadMilestonesWithoutRecalculatingProgress = async () => {
            loading.value = true;
            try {
              // æ¨¡æ‹ŸAPIè°ƒç”¨
              await new Promise((resolve) => setTimeout(resolve, 1000));

              // æ£€æŸ¥URLå‚æ•°
              const params = new URLSearchParams(window.location.search);
              const progressFromURL = params.get("progress");

              if (progressFromURL) {
                const progress = parseInt(progressFromURL);
                console.log("ä»URLåŠ¨æ€ç”Ÿæˆé‡Œç¨‹ç¢‘æ•°æ®ï¼Œè¿›åº¦:", progress);
                milestones.value = generateMilestonesFromProgress(progress);
                overallProgress.value = progress;
              } else {
                console.log("ä½¿ç”¨é»˜è®¤é‡Œç¨‹ç¢‘æ•°æ®");
                milestones.value = mockMilestones;
              }

              // åªè®¡ç®—ç»Ÿè®¡æ•°æ®ï¼Œä¸é‡æ–°è®¡ç®—æ•´ä½“è¿›åº¦
              calculateStats();

              console.log("æœ€ç»ˆè¿›åº¦å€¼:", overallProgress.value);
              console.log("æœ€ç»ˆç»Ÿè®¡æ•°æ®:", stats.value);
              console.log("æœ€ç»ˆé‡Œç¨‹ç¢‘æ•°æ®:", milestones.value);
            } catch (error) {
              ElMessage.error("åŠ è½½é‡Œç¨‹ç¢‘æ•°æ®å¤±è´¥");
            } finally {
              loading.value = false;
            }
          };

          // åŠ è½½é‡Œç¨‹ç¢‘æ•°æ®
          const loadMilestones = async () => {
            loading.value = true;
            try {
              // æ¨¡æ‹ŸAPIè°ƒç”¨
              await new Promise((resolve) => setTimeout(resolve, 1000));

              // æ£€æŸ¥URLå‚æ•°
              const params = new URLSearchParams(window.location.search);
              const progressFromURL = params.get("progress");

              if (progressFromURL) {
                const progress = parseInt(progressFromURL);
                console.log("ä»URLåŠ¨æ€ç”Ÿæˆé‡Œç¨‹ç¢‘æ•°æ®ï¼Œè¿›åº¦:", progress);
                milestones.value = generateMilestonesFromProgress(progress);
                overallProgress.value = progress;
              } else {
                console.log("ä½¿ç”¨é»˜è®¤é‡Œç¨‹ç¢‘æ•°æ®");
                milestones.value = mockMilestones;
              }

              // å…ˆè®¡ç®—ç»Ÿè®¡æ•°æ®ï¼Œå†è®¡ç®—æ•´ä½“è¿›åº¦
              calculateStats();
              calculateOverallProgress();

              console.log("æœ€ç»ˆè¿›åº¦å€¼:", overallProgress.value);
              console.log("æœ€ç»ˆç»Ÿè®¡æ•°æ®:", stats.value);
              console.log("æœ€ç»ˆé‡Œç¨‹ç¢‘æ•°æ®:", milestones.value);
            } catch (error) {
              console.error("åŠ è½½é‡Œç¨‹ç¢‘æ•°æ®å¤±è´¥:", error);
              ElMessage.error("åŠ è½½é‡Œç¨‹ç¢‘æ•°æ®å¤±è´¥");
            } finally {
              loading.value = false;
            }
          };

          // è¿”å›åˆ—è¡¨é¡µ
          const handleBack = () => {
            ElMessage.info("è¿”å›é¡¹ç›®åˆ—è¡¨");
            // æ£€æŸ¥æ˜¯å¦åœ¨iframeä¸­
            if (window.parent !== window) {
              window.parent.postMessage(
                {
                  type: "navigate",
                  path: "project/list",
                },
                "*"
              );
            } else {
              window.location.href = "é¡¹ç›®åˆ—è¡¨.html";
            }
          };

          // ç»„ä»¶æŒ‚è½½æ—¶åŠ è½½æ•°æ®
          onMounted(() => {
            console.log("é¡¹ç›®è¿›åº¦é¡µé¢åŠ è½½ä¸­...");
            console.log("å½“å‰URL:", window.location.href);
            console.log(
              "URLå‚æ•°:",
              new URLSearchParams(window.location.search).toString()
            );

            // ç›‘å¬iframeæ¶ˆæ¯
            window.addEventListener("message", handleIframeMessage);

            // å…ˆå°è¯•è·å–URLå‚æ•°
            const hasURLParams = getProjectDataFromURL();

            // å¦‚æœæ²¡æœ‰URLå‚æ•°ï¼Œå»¶è¿ŸåŠ è½½é»˜è®¤æ•°æ®ï¼Œç»™iframeæ¶ˆæ¯ç•™å‡ºæ—¶é—´
            if (!hasURLParams) {
              console.log("æ²¡æœ‰URLå‚æ•°ï¼Œå»¶è¿ŸåŠ è½½é»˜è®¤æ•°æ®");
              setTimeout(() => {
                // æ£€æŸ¥æ˜¯å¦å·²ç»é€šè¿‡iframeæ¶ˆæ¯è®¾ç½®äº†æ•°æ®
                if (overallProgress.value === 0) {
                  console.log("iframeæ¶ˆæ¯æœªåˆ°è¾¾ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®");
                  loadMilestones();
                } else {
                  console.log("iframeæ¶ˆæ¯å·²å¤„ç†ï¼Œè·³è¿‡é»˜è®¤æ•°æ®");
                }
              }, 200);
            }
          });

          return {
            loading,
            milestones,
            overallProgress,
            projectStartTime,
            projectEndTime,
            stats,
            projectInfo,
            getStatusText,
            handleBack,
          };
        },
      })
        .use(ElementPlus)
        .mount("#app");
    </script>
  </body>
</html>
